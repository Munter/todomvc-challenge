!function(){"use strict";function e(){"tastejs.github.io"===location.hostname&&(location.href=location.href.replace("tastejs.github.io/todomvc","todomvc.com"))}function t(){var e;return[/labs/,/\w*-examples/].forEach(function(t){var n=location.href.match(t);!e&&n&&(e=location.href.indexOf(n))}),location.href.substr(0,e)}function n(e,n){if(!location.host)return console.info("Miss the info bar? Run TodoMVC from a server to avoid a cross-origin error.");var r=new XMLHttpRequest;r.open("GET",t()+e,!0),r.send(),r.onload=function(){200===r.status&&n&&n(r.responseText)}}function r(e,t){if(!(this instanceof r))return new r(e,t);var n,i;if("object"!=typeof e)try{e=JSON.parse(e)}catch(s){return}t&&(n=t.template,i=t.framework),!n&&e.templates&&(n=e.templates.todomvc),!i&&document.querySelector("[data-framework]")&&(i=document.querySelector("[data-framework]").getAttribute("data-framework")),n&&e[i]&&(this.frameworkJSON=e[i],this.template=n,this.append())}var i=function(e){e.defaults=function(e){if(!e)return e;for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t];if(r)for(var i in r)null==e[i]&&(e[i]=r[i])}return e},e.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var t=/(.)^/,n={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},r=/\\|'|\r|\n|\t|\u2028|\u2029/g;return e.template=function(i,s,o){var a;o=e.defaults({},o,e.templateSettings);var l=new RegExp([(o.escape||t).source,(o.interpolate||t).source,(o.evaluate||t).source].join("|")+"|$","g"),c=0,u="__p+='";i.replace(l,function(e,t,s,o,a){return u+=i.slice(c,a).replace(r,function(e){return"\\"+n[e]}),t&&(u+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'"),s&&(u+="'+\n((__t=("+s+"))==null?'':__t)+\n'"),o&&(u+="';\n"+o+"\n__p+='"),c=a+e.length,e}),u+="';\n",o.variable||(u="with(obj||{}){\n"+u+"}\n"),u="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+u+"return __p;\n";try{a=new Function(o.variable||"obj","_",u)}catch(h){throw h.source=u,h}if(s)return a(s,e);var f=function(t){return a.call(this,t,e)};return f.source="function("+(o.variable||"obj")+"){\n"+u+"}",f},e}({});"todomvc.com"===location.hostname&&(window._gaq=[["_setAccount","UA-31081062-1"],["_trackPageview"]],function(e,t){var n=e.createElement(t),r=e.getElementsByTagName(t)[0];n.src="//www.google-analytics.com/ga.js",r.parentNode.insertBefore(n,r)}(document,"script")),r.prototype.append=function(){var e=document.createElement("aside");e.innerHTML=i.template(this.template,this.frameworkJSON),e.className="learn";var n=e.querySelectorAll(".demo-link");Array.prototype.forEach.call(n,function(e){e.setAttribute("href",t()+e.getAttribute("href"))}),document.body.className=(document.body.className+" learn-bar").trim(),document.body.insertAdjacentHTML("afterBegin",e.outerHTML)},e(),n("learn.json",r)}();/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.0.0 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */
/*!
 * flow.js JavaScript Library v0.2.2
 * https://github.com/it-ony/flow.js
 *
 * Copyright 2012, Tony Findeisen
 * Licensed under the MIT license.
 * https://raw.github.com/it-ony/flow.js/master/LICENSE
 *
 * Date: Mon Mar 12 2012 12:36:34 GMT+0100 (CET)
 */
var requirejs,require,define;!function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var n;for(n=0;n<e.length&&!t(e[n],n,e);n+=1);}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1&&!t(e[n],n,e);n-=1);}}function hasProp(e,t){return e.hasOwnProperty(t)}function eachProp(e,t){var n;for(n in e)if(e.hasOwnProperty(n)&&t(e[n],n))break}function mixin(e,t,n){t&&eachProp(t,function(t,r){(n||!hasProp(e,r))&&(e[r]=t)})}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeContextModuleFunc(e,t,n){return function(){var r,i=aps.call(arguments,0);return n&&isFunction(r=i[i.length-1])&&(r.__requireJsBuild=!0),i.push(t),e.apply(null,i)}}function addRequireMethods(e,t,n){each([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(r){e[r[0]]=makeContextModuleFunc(t[r[1]||r[0]],n)})}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function t(e){var t,n;for(t=0;e[t];t+=1)if(n=e[t],"."===n)e.splice(t,1),t-=1;else if(".."===n){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function n(e,n,r){var i,s,o,a,l,c,u,h,f=n&&n.split("/"),d=w.map,p=d&&d["*"];if(e&&"."===e.charAt(0)&&(n?(f=w.pkgs[n]?[n]:f.slice(0,f.length-1),e=f.concat(e.split("/")),t(e),s=w.pkgs[i=e[0]],e=e.join("/"),s&&e===i+"/"+s.main&&(e=i)):0===e.indexOf("./")&&(e=e.substring(2))),r&&(f||p)&&d)for(a=e.split("/"),l=a.length;l>0;l-=1){if(u=a.slice(0,l).join("/"),f)for(c=f.length;c>0;c-=1)if(o=d[f.slice(0,c).join("/")],o&&(o=o[u])){h=o;break}if(!h&&p&&p[u]&&(h=p[u]),h){a.splice(0,l,h),e=a.join("/");break}}return e}function r(e){isBrowser&&each(scripts(),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===x.contextName?(t.parentNode.removeChild(t),!0):void 0})}function i(e){var t=w.paths[e];return t&&isArray(t)&&t.length>1?(r(e),t.shift(),x.undef(e),x.require([e]),!0):void 0}function s(e,t,r,i){var s,o,a,l,c=e?e.indexOf("!"):-1,u=null,h=t?t.name:null,f=e,d=!0;return e||(d=!1,e="_@r"+(I+=1)),-1!==c&&(u=e.substring(0,c),e=e.substring(c+1,e.length)),u&&(u=n(u,h,i)),e&&(u?(a=A[u],s=a&&a.normalize?a.normalize(e,function(e){return n(e,h,i)}):n(e,h,i)):(s=n(e,h,i),o=F[s],o||(o=x.nameToUrl(e,null,t),F[s]=o))),l=!u||a||r?"":"_unnormalized"+(M+=1),{prefix:u,name:s,parentMap:t,unnormalized:!!l,url:o,originalName:f,isDefine:d,id:(u?u+"!"+(s||""):s)+l}}function o(e){var t=e.id,n=j[t];return n||(n=j[t]=new x.Module(e)),n}function a(e,t,n){var r=e.id,i=j[r];!hasProp(A,r)||i&&!i.defineEmitComplete?o(e).on(t,n):"defined"===t&&n(A[r])}function l(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=j[t];n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function c(){globalDefQueue.length&&(apsp.apply(S,[S.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function u(e,t,n){var r=e&&e.map,i=makeContextModuleFunc(n||x.require,r,t);return addRequireMethods(i,x,r),i}function h(e){delete j[e],each(N,function(t,n){return t.map.id===e?(N.splice(n,1),t.defined||(x.waitCount-=1),!0):void 0})}function f(e,t){var n,r=e.map.id,i=e.depMaps;if(e.inited)return t[r]?e:(t[r]=!0,each(i,function(e){var i=e.id,s=j[i];if(s)return s.inited&&s.enabled?n=f(s,t):(n=null,delete t[r],!0)}),n)}function d(e,t,n){var r=e.map.id,i=e.depMaps;if(e.inited&&e.map.isDefine)return t[r]?A[r]:(t[r]=e,each(i,function(i){var s,o=i.id,a=j[o];if(!C[o]&&a){if(!a.inited||!a.enabled)return n[r]=!0,void 0;s=d(a,t,n),n[o]||e.defineDepById(o,s)}}),e.check(!0),A[r])}function p(e){e.check()}function v(){var e,t,n,s,o=1e3*w.waitSeconds,a=o&&x.startTime+o<(new Date).getTime(),c=[],u=!1,h=!0;if(!y)return y=!0,eachProp(j,function(n){if(e=n.map,t=e.id,n.enabled&&!n.error)if(!n.inited&&a)i(t)?(s=!0,u=!0):(c.push(t),r(t));else if(!n.inited&&n.fetched&&e.isDefine&&(u=!0,!e.prefix))return h=!1}),a&&c.length?(n=makeError("timeout","Load timeout for modules: "+c,null,c),n.contextName=x.contextName,l(n)):(h&&(each(N,function(e){if(!e.defined){var t=f(e,{}),n={};t&&(d(t,n,{}),eachProp(n,p))}}),eachProp(j,p)),(!a||s)&&u&&(isBrowser||isWebWorker)&&!_&&(_=setTimeout(function(){_=0,v()},50)),y=!1,void 0)}function m(e){o(s(e[0],null,!0)).init(e[1],e[2])}function g(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function $(e){var t=e.currentTarget||e.srcElement;return g(t,x.onScriptLoad,"load","onreadystatechange"),g(t,x.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}var y,b,x,C,_,w={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},j={},E={},S=[],A={},F={},P={},I=1,M=1,N=[];return C={require:function(e){return u(e)},exports:function(e){return e.usingExports=!0,e.map.isDefine?e.exports=A[e.map.id]={}:void 0},module:function(e){return e.module={id:e.map.id,uri:e.map.url,config:function(){return w.config&&w.config[e.map.id]||{}},exports:A[e.map.id]}}},b=function(e){this.events=E[e.id]||{},this.map=e,this.shim=w.shim[e.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,n,r){r=r||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),each(e,bind(this,function(e,t){"string"==typeof e&&(e=s(e,this.map.isDefine?this.map:this.map.parentMap,!1,!0),this.depMaps.push(e));var r=C[e.id];return r?(this.depExports[t]=r(this),void 0):(this.depCount+=1,a(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),n&&a(e,"error",n),void 0)})),this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check())},defineDepById:function(e,t){var n;return each(this.depMaps,function(t,r){return t.id===e?(n=r,!0):void 0}),this.defineDep(n,t)},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,x.startTime=(new Date).getTime();var e=this.map;e.prefix?this.callPlugin():this.shim?u(this,!0)(this.shim.deps||[],bind(this,function(){this.load()})):this.load()}},load:function(){var e=this.map.url;P[e]||(P[e]=!0,x.load(this.map.id,e))},check:function(e){if(this.enabled){var t,n,r=this.map.id,i=this.depExports,s=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error)try{s=x.execCb(r,o,i,s)}catch(a){t=a}else s=x.execCb(r,o,i,s);if(this.map.isDefine&&(n=this.module,n&&void 0!==n.exports&&n.exports!==this.exports?s=n.exports:void 0===s&&this.usingExports&&(s=this.exports)),t)return t.requireMap=this.map,t.requireModules=[this.map.id],t.requireType="define",l(this.error=t)}else s=o;this.exports=s,this.map.isDefine&&!this.ignore&&(A[r]=s,req.onResourceLoad&&req.onResourceLoad(x,this.map,this.depMaps)),delete j[r],this.defined=!0,x.waitCount-=1,0===x.waitCount&&(N=[])}this.defining=!1,e||this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,r=s(e.prefix,null,!1,!0);a(r,"defined",bind(this,function(r){var i,o,c,f=this.map.name,d=this.map.parentMap?this.map.parentMap.name:null;return this.map.unnormalized?(r.normalize&&(f=r.normalize(f,function(e){return n(e,d,!0)})),o=s(e.prefix+"!"+f),a(o,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),c=j[o.id],c&&(this.events.error&&c.on("error",bind(this,function(e){this.emit("error",e)})),c.enable()),void 0):(i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(j,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&h(e.map.id)}),l(e)}),i.fromText=function(e,t){var n=useInteractive;n&&(useInteractive=!1),req.exec(t),n&&(useInteractive=!0),x.completeLoad(e)},r.load(e.name,u(e.parentMap,!0,function(e,t){return x.require(e,t)}),i,w),void 0)})),x.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){this.enabled=!0,this.waitPushed||(N.push(this),x.waitCount+=1,this.waitPushed=!0),each(this.depMaps,bind(this,function(e){var t=e.id,n=j[t];!C[t]&&n&&!n.enabled&&x.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=j[e.id];t&&!t.enabled&&x.enable(e,this)})),this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},x={config:w,contextName:e,registry:j,defined:A,urlMap:F,urlFetched:P,waitCount:0,defQueue:S,Module:b,makeModuleMap:s,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=w.paths,n=w.pkgs,r=w.shim,i=w.map||{};mixin(w,e,!0),mixin(t,e.paths,!0),w.paths=t,e.map&&(mixin(i,e.map,!0),w.map=i),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),e.exports&&!e.exports.__buildReady&&(e.exports=x.makeShimExports(e.exports)),r[t]=e}),w.shim=r),e.packages&&(each(e.packages,function(e){var t;e="string"==typeof e?{name:e}:e,t=e.location,n[e.name]={name:e.name,location:t||e.name,main:(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),w.pkgs=n),(e.deps||e.callback)&&x.require(e.deps||[],e.callback)},makeShimExports:function(e){var t;return"string"==typeof e?(t=function(){return getGlobal(e)},t.exports=e,t):function(){return e.apply(global,arguments)}},requireDefined:function(e,t){return hasProp(A,s(e,t,!1,!0).id)},requireSpecified:function(e,t){return e=s(e,t,!1,!0).id,hasProp(A,e)||hasProp(j,e)},require:function(t,n,r,i){var a,u,h,f,d;if("string"==typeof t)return isFunction(n)?l(makeError("requireargs","Invalid require call"),r):req.get?req.get(x,t,n):(a=t,i=n,h=s(a,i,!1,!0),u=h.id,hasProp(A,u)?A[u]:l(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e)));for(r&&!isFunction(r)&&(i=r,r=void 0),n&&!isFunction(n)&&(i=n,n=void 0),c();S.length;){if(d=S.shift(),null===d[0])return l(makeError("mismatch","Mismatched anonymous define() module: "+d[d.length-1]));m(d)}return f=o(s(null,i)),f.init(t,n,r,{enabled:!0}),v(),x.require},undef:function(e){var t=s(e,null,!0),n=j[e];delete A[e],delete F[e],delete P[t.url],delete E[e],n&&(n.events.defined&&(E[e]=n.events),h(e))},enable:function(e){var t=j[e.id];t&&o(e).enable()},completeLoad:function(e){var t,n,r,s=w.shim[e]||{},o=s.exports&&s.exports.exports;for(c();S.length;){if(n=S.shift(),null===n[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);m(n)}if(r=j[e],!t&&!A[e]&&r&&!r.inited){if(w.enforceDefine&&(!o||!getGlobal(o))){if(i(e))return;return l(makeError("nodefine","No define call for "+e,null,[e]))}m([e,s.deps||[],s.exports])}v()},toUrl:function(e,t){var n=e.lastIndexOf("."),r=null;return-1!==n&&(r=e.substring(n,e.length),e=e.substring(0,n)),x.nameToUrl(e,r,t)},nameToUrl:function(e,t,r){var i,s,o,a,l,c,u,h,f;if(e=n(e,r&&r.id,!0),req.jsExtRegExp.test(e))h=e+(t||"");else{for(i=w.paths,s=w.pkgs,l=e.split("/"),c=l.length;c>0;c-=1){if(u=l.slice(0,c).join("/"),o=s[u],f=i[u],f){isArray(f)&&(f=f[0]),l.splice(0,c,f);break}if(o){a=e===o.name?o.location+"/"+o.main:o.location,l.splice(0,c,a);break}}h=l.join("/")+(t||".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":w.baseUrl)+h}return w.urlArgs?h+((-1===h.indexOf("?")?"?":"&")+w.urlArgs):h},load:function(e,t){req.load(x,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=$(e);x.completeLoad(t.id)}},onScriptError:function(e){var t=$(e);return i(t.id)?void 0:l(makeError("scripterror","Script error",e,[t.id]))}}}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){return"interactive"===e.readyState?interactiveScript=e:void 0}),interactiveScript)}var version="2.0.0",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,ostring=Object.prototype.toString,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser="undefined"!=typeof window&&!!navigator&&!!document,isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1,req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"!=typeof require&&!isFunction(require)&&(cfg=require,require=void 0),req=requirejs=function(e,t,n,r){var i,s,o=defContextName;return!isArray(e)&&"string"!=typeof e&&(s=e,isArray(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),i=contexts[o],i||(i=contexts[o]=req.s.newContext(o)),s&&i.configure(s),i.require(e,t,n)},req.config=function(e){return req(e)},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),addRequireMethods(req,contexts[defContextName]),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(e){throw e},req.load=function(e,t,n){var r,i=e&&e.config||{};return isBrowser?(r=i.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),r.type=i.scriptType||"text/javascript",r.charset="utf-8",r.setAttribute("data-requirecontext",e.contextName),r.setAttribute("data-requiremodule",t),!r.attachEvent||r.attachEvent.toString&&r.attachEvent.toString().indexOf("[native code")<0||isOpera?(r.addEventListener("load",e.onScriptLoad,!1),r.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,r.attachEvent("onreadystatechange",e.onScriptLoad)),r.src=n,currentlyAddingScript=r,baseElement?head.insertBefore(r,baseElement):head.appendChild(r),currentlyAddingScript=null,r):(isWebWorker&&(importScripts(n),e.completeLoad(t)),void 0)},isBrowser&&eachReverse(scripts(),function(e){return head||(head=e.parentNode),dataMain=e.getAttribute("data-main"),dataMain?(cfg.baseUrl||(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath,dataMain=mainScript.replace(jsSuffixRegExp,"")),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0):void 0}),define=function(e,t,n){var r,i;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=[]),!t.length&&isFunction(n)&&n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t)),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")])),(i?i.defQueue:globalDefQueue).push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("js/lib/require.js",function(){});var exports="undefined"==typeof exports?this:exports;exports.parser=function(){var e={parse:function(e,t){function n(e,t,n){for(var r=e,i=n-e.length,s=0;i>s;s++)r=t+r;return r}function r(e){var t=e.charCodeAt(0);if(255>=t)var r="x",i=2;else var r="u",i=4;return"\\"+r+n(t.toString(16).toUpperCase(),"0",i)}function i(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,r)+'"'}function s(e){S>j||(j>S&&(S=j,A=[]),A.push(e))}function o(){var t="varName@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j;if(null!==e.substr(j).match(/^[a-zA-Z$_]/)){var o=e.charAt(j);j++}else{var o=null;E&&s("[a-zA-Z$_]")}if(null!==o){var a=[];if(null!==e.substr(j).match(/^[a-zA-Z0-9$_\- ]/)){var l=e.charAt(j);j++}else{var l=null;E&&s("[a-zA-Z0-9$_\\- ]")}for(;null!==l;)if(a.push(l),null!==e.substr(j).match(/^[a-zA-Z0-9$_\- ]/)){var l=e.charAt(j);j++}else{var l=null;E&&s("[a-zA-Z0-9$_\\- ]")}if(null!==a)var c=[o,a];else{var c=null;j=i}}else{var c=null;j=i}var u=null!==c?function(e,t){return e?e+t.join(""):!1}(c[0],c[1]):null;if(null!==u)var h=u;else{var h=null;j=r}if(null!==h)var f=h;else{var d=[];if(null!==d)var f=d;else var f=null}return F[t]={nextPos:j,result:f},f}function a(){var t="string@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j;if("'"===e.substr(j,1)){var o="'";j+=1}else{var o=null;E&&s('"\'"')}if(null!==o){var a=[],l=j;if(e.length>j){var c=e.charAt(j);j++}else{var c=null;E&&s("any character")}var u=null!==c?function(e){return"'"===e?null:e}(c):null;if(null!==u)var h=u;else{var h=null;j=l}for(;null!==h;){a.push(h);var l=j;if(e.length>j){var c=e.charAt(j);j++}else{var c=null;E&&s("any character")}var u=null!==c?function(e){return"'"===e?null:e}(c):null;if(null!==u)var h=u;else{var h=null;j=l}}if(null!==a){if("'"===e.substr(j,1)){var f="'";j+=1}else{var f=null;E&&s('"\'"')}if(null!==f)var d=[o,a,f];else{var d=null;j=i}}else{var d=null;j=i}}else{var d=null;j=i}var p=null!==d?function(e){return e.join("")}(d[1]):null;if(null!==p)var v=p;else{var v=null;j=r}return F[t]={nextPos:j,result:v},v}function l(){var t="number@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j;if("-"===e.substr(j,1)){var o="-";j+=1}else{var o=null;E&&s('"-"')}var a=null!==o?o:"";if(null!==a){if(null!==e.substr(j).match(/^[0-9]/)){var l=e.charAt(j);j++}else{var l=null;E&&s("[0-9]")}if(null!==l)for(var c=[];null!==l;)if(c.push(l),null!==e.substr(j).match(/^[0-9]/)){var l=e.charAt(j);j++}else{var l=null;E&&s("[0-9]")}else var c=null;if(null!==c)var u=[a,c];else{var u=null;j=i}}else{var u=null;j=i}var h=null!==u?function(e,t){return parseInt(t.join(""),10)*(e?-1:1)}(u[0],u[1]):null;if(null!==h)var f=h;else{var f=null;j=r}return F[t]={nextPos:j,result:f},f}function c(){var t="float@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j,o=l();if(null!==o){if("."===e.substr(j,1)){var a=".";j+=1}else{var a=null;E&&s('"."')}if(null!==a){if(null!==e.substr(j).match(/^[0-9]/)){var c=e.charAt(j);j++}else{var c=null;E&&s("[0-9]")}if(null!==c)for(var u=[];null!==c;)if(u.push(c),null!==e.substr(j).match(/^[0-9]/)){var c=e.charAt(j);j++}else{var c=null;E&&s("[0-9]")}else var u=null;if(null!==u)var h=[o,a,u];else{var h=null;j=i}}else{var h=null;j=i}}else{var h=null;j=i}var f=null!==h?function(e,t){return parseFloat(e+"."+t.join(""),10)}(h[0],h[2]):null;if(null!==f)var d=f;else{var d=null;j=r}return F[t]={nextPos:j,result:d},d}function u(){var t="boolean@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j;if("true"===e.substr(j,4)){var i="true";j+=4}else{var i=null;E&&s('"true"')}var o=null!==i?function(){return!0}():null;if(null!==o)var a=o;else{var a=null;j=r}if(null!==a)var l=a;else{var c=j;if("false"===e.substr(j,5)){var u="false";j+=5}else{var u=null;E&&s('"false"')}var h=null!==u?function(){return!1}():null;if(null!==h)var f=h;else{var f=null;j=c}if(null!==f)var l=f;else var l=null}return F[t]={nextPos:j,result:l},l}function h(){var t="index@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j;if("["===e.substr(j,1)){var o="[";j+=1}else{var o=null;E&&s('"["')}if(null!==o){var a=l();if(null!==a){if("]"===e.substr(j,1)){var c="]";j+=1}else{var c=null;E&&s('"]"')}if(null!==c)var u=[o,a,c];else{var u=null;j=i}}else{var u=null;j=i}}else{var u=null;j=i}var h=null!==u?function(e){return e}(u[1]):null;if(null!==h)var f=h;else{var f=null;j=r}return F[t]={nextPos:j,result:f},f}function f(){var e="parameter@"+j,t=F[e];if(t)return j=t.nextPos,t.result;var n=a();if(null!==n)var r=n;else{var i=u();if(null!==i)var r=i;else{var s=c();if(null!==s)var r=s;else{var o=l();if(null!==o)var r=o;else{var h=b();if(null!==h)var r=h;else{var f=$();if(null!==f)var r=f;else var r=null}}}}}return F[e]={nextPos:j,result:r},r}function d(){var t="parameterArray@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j,o=f(),a=null!==o?o:"";if(null!==a){var l=[],c=j,u=j;if(","===e.substr(j,1)){var h=",";j+=1}else{var h=null;E&&s('","')}if(null!==h){var d=f();if(null!==d)var p=[h,d];else{var p=null;j=u}}else{var p=null;j=u}var v=null!==p?function(e){return e}(p[1]):null;if(null!==v)var m=v;else{var m=null;j=c}for(;null!==m;){l.push(m);var c=j,u=j;if(","===e.substr(j,1)){var h=",";j+=1}else{var h=null;E&&s('","')}if(null!==h){var d=f();if(null!==d)var p=[h,d];else{var p=null;j=u}}else{var p=null;j=u}var v=null!==p?function(e){return e}(p[1]):null;if(null!==v)var m=v;else{var m=null;j=c}}if(null!==l)var g=[a,l];else{var g=null;j=i}}else{var g=null;j=i}var $=null!==g?function(e,t){return e?[e].concat(t):[]}(g[0],g[1]):null;if(null!==$)var y=$;else{var y=null;j=r}return F[t]={nextPos:j,result:y},y}function p(){var e="var@"+j,t=F[e];if(t)return j=t.nextPos,t.result;var n=j,r=j,i=o();if(null!==i){var s=h(),a=null!==s?s:"";if(null!==a)var l=[i,a];else{var l=null;j=r}}else{var l=null;j=r}var c=null!==l?function(e,t){return{name:e,type:"var",index:t}}(l[0],l[1]):null;if(null!==c)var u=c;else{var u=null;j=n}return F[e]={nextPos:j,result:u},u}function v(){var t="fnc@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j,a=o();if(null!==a){if("("===e.substr(j,1)){var l="(";j+=1}else{var l=null;E&&s('"("')}if(null!==l){var c=d(),u=null!==c?c:"";if(null!==u){if(")"===e.substr(j,1)){var f=")";j+=1}else{var f=null;E&&s('")"')}if(null!==f){var p=h(),v=null!==p?p:"";if(null!==v)var m=[a,l,u,f,v];else{var m=null;j=i}}else{var m=null;j=i}}else{var m=null;j=i}}else{var m=null;j=i}}else{var m=null;j=i}var g=null!==m?function(e,t,n){return{name:e,type:"fnc",parameter:t,index:n}}(m[0],m[2],m[4]):null;if(null!==g)var $=g;else{var $=null;j=r}return F[t]={nextPos:j,result:$},$}function m(){var e="pathElement@"+j,t=F[e];if(t)return j=t.nextPos,t.result;var n=j,r=h(),i=null!==r?function(e){return{type:"index",index:e}}(r):null;if(null!==i)var s=i;else{var s=null;j=n}if(null!==s)var o=s;else{var a=v();if(null!==a)var o=a;else{var l=p();if(null!==l)var o=l;else var o=null}}return F[e]={nextPos:j,result:o},o}function g(){var t="path@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j,o=m();if(null!==o){var a=[],l=j,c=j;if("."===e.substr(j,1)){var u=".";j+=1}else{var u=null;E&&s('"."')}if(null!==u){var h=m();if(null!==h)var f=[u,h];else{var f=null;j=c}}else{var f=null;j=c}var d=null!==f?function(e){return e}(f[1]):null;if(null!==d)var p=d;else{var p=null;j=l}for(;null!==p;){a.push(p);var l=j,c=j;if("."===e.substr(j,1)){var u=".";j+=1}else{var u=null;E&&s('"."')}if(null!==u){var h=m();if(null!==h)var f=[u,h];else{var f=null;j=c}}else{var f=null;j=c}var d=null!==f?function(e){return e}(f[1]):null;if(null!==d)var p=d;else{var p=null;j=l}}if(null!==a)var v=[o,a];else{var v=null;j=i}}else{var v=null;j=i}var g=null!==v?function(e,t){return[e].concat(t)}(v[0],v[1]):null;if(null!==g)var $=g;else{var $=null;j=r}return F[t]={nextPos:j,result:$},$}function $(){var t="binding@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j;if("{"===e.substr(j,1)){var o="{";j+=1}else{var o=null;E&&s('"{"')}if(null!==o){var a=g();if(null!==a){if("}"===e.substr(j,1)){var l="}";j+=1}else{var l=null;E&&s('"}"')}if(null!==l)var c=[o,a,l];else{var c=null;j=i}}else{var c=null;j=i}}else{var c=null;j=i}var u=null!==c?function(e){return e?{path:e,type:"normal"}:!1}(c[1]):null;if(null!==u)var h=u;else{var h=null;j=r}return F[t]={nextPos:j,result:h},h}function y(){var t="twoWayBinding@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j;if("{{"===e.substr(j,2)){var o="{{";j+=2}else{var o=null;E&&s('"{{"')}if(null!==o){var a=g();if(null!==a){var l=j,c=j;if("|"===e.substr(j,1)){var u="|";j+=1}else{var u=null;E&&s('"|"')}if(null!==u){var h=g();if(null!==h)var f=[u,h];else{var f=null;j=c}}else{var f=null;j=c}var d=null!==f?function(e){return e}(f[1]):null;if(null!==d)var p=d;else{var p=null;j=l}var v=null!==p?p:"";if(null!==v){var m=j,$=j;if("|"===e.substr(j,1)){var y="|";j+=1}else{var y=null;E&&s('"|"')}if(null!==y){var b=g();if(null!==b)var x=[y,b];else{var x=null;j=$}}else{var x=null;j=$}var C=null!==x?function(e){return e}(x[1]):null;if(null!==C)var _=C;else{var _=null;j=m}var w=null!==_?_:"";if(null!==w){if("}}"===e.substr(j,2)){var S="}}";j+=2}else{var S=null;E&&s('"}}"')}if(null!==S)var A=[o,a,v,w,S];else{var A=null;j=i}}else{var A=null;j=i}}else{var A=null;j=i}}else{var A=null;j=i}}else{var A=null;j=i}var P=null!==A?function(e,t,n){return e?{path:e,type:"twoWay",transformBack:t||!1,transform:n||!1}:!1}(A[1],A[2],A[3]):null;if(null!==P)var I=P;else{var I=null;j=r}return F[t]={nextPos:j,result:I},I}function b(){var t="staticBinding@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=j;if("$"===e.substr(j,1)){var o="$";j+=1}else{var o=null;E&&s('"$"')}if(null!==o){var a=$();if(null!==a)var l=[o,a];else{var l=null;j=i}}else{var l=null;j=i}var c=null!==l?function(e){return e.type="static",e}(l[1]):null;if(null!==c)var u=c;else{var u=null;j=r}return F[t]={nextPos:j,result:u},u}function x(){var t="text@"+j,n=F[t];if(n)return j=n.nextPos,n.result;var r=j,i=y(),o=null!==i?function(e){return[e]}(i):null;if(null!==o)var a=o;else{var a=null;j=r}if(null!==a)var l=a;else{var c=[],u=b();if(null!==u)var h=u;else{var f=$();if(null!==f)var h=f;else{if(e.length>j){var d=e.charAt(j);j++}else{var d=null;E&&s("any character")}if(null!==d)var h=d;else var h=null}}for(;null!==h;){c.push(h);var u=b();if(null!==u)var h=u;else{var f=$();if(null!==f)var h=f;else{if(e.length>j){var d=e.charAt(j);j++}else{var d=null;E&&s("any character")}if(null!==d)var h=d;else var h=null}}}if(null!==c)var l=c;else var l=null}return F[t]={nextPos:j,result:l},l}function C(){function t(e){e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);switch(n.length){case 0:return"end of input";case 1:return n[0];default:return n.slice(0,n.length-1).join(", ")+" or "+n[n.length-1]}}var n=t(A),r=Math.max(j,S),s=r<e.length?i(e.charAt(r)):"end of input";return"Expected "+n+" but "+s+" found."}function _(){for(var t=1,n=1,r=!1,i=0;S>i;i++){var s=e.charAt(i);"\n"===s?(r||t++,n=1,r=!1):"\r"===s|"\u2028"===s||"\u2029"===s?(t++,n=1,r=!0):(n++,r=!1)}return{line:t,column:n}}var w={binding:$,"boolean":u,"float":c,fnc:v,index:h,number:l,parameter:f,parameterArray:d,path:g,pathElement:m,staticBinding:b,string:a,text:x,twoWayBinding:y,"var":p,varName:o};if(void 0!==t){if(void 0===w[t])throw new Error("Invalid rule name: "+i(t)+".")}else t="text";var j=0,E=!0,S=0,A=[],F={},P=w[t]();if(null===P||j!==e.length){var I=_();throw new this.SyntaxError(C(),I.line,I.column)}return P},toSource:function(){return this._source}};return e.SyntaxError=function(e,t,n){this.name="SyntaxError",this.message=e,this.line=t,this.column=n},e.SyntaxError.prototype=Error.prototype,e}(),define("js/lib/parser",function(){return exports.parser}),define("js/lib/parser",function(){});var inherit;!function(e,t){inherit=function(e,t,n,r){function i(){}var s=Array.prototype.slice.call(arguments);s[0]instanceof Object&&s.unshift(null),s[2]instanceof Function&&s.splice(2,0,null),e=s[0],t=s[1]||{},n=s[2]||{},r=s[3]||Object;var o=function(){return this.ctor?this.ctor.apply(this,arguments):void 0};r.constructor instanceof Function?(i.prototype=r.prototype,o.prototype=new i,o.prototype.constructor=t,t&&e&&(o.prototype.constructor.name=e),o.prototype.base=r.prototype):(o.prototype=r,o.prototype.constructor=t,o.prototype.base=r);for(var a in t)if(t.hasOwnProperty(a)){var l=o.prototype[a];o.prototype[a]=t[a],l instanceof Function&&(o.prototype[a].baseImplementation=l)}for(var c in n)n.hasOwnProperty(c)&&(o[c]=n[c]);return o.prototype.callBase=inherit.callBase,o},inherit.callBase=function(){var e=Array.prototype.slice.call(arguments);return 0==e.length&&(e=Array.prototype.slice.call(arguments.callee.caller.arguments)),arguments.callee.caller.baseImplementation.apply(this,e)},Function.prototype.inherit=function(){var e=Array.prototype.slice.call(arguments);return e[0]instanceof Object&&e.unshift(null),inherit(e[0],e[1],e[2],this)},Function.prototype.callBase=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(t&&t.base){var n=arguments.callee.caller;return this==n?this.baseImplementation.apply(t,e):this.apply(t,e)}throw"base not definied"},Function.prototype.classof=function(e){if(!e)return!1;if(e instanceof Function)return e===this||this.prototype instanceof e;throw new Error("factory must be a function")},inherit.Base=inherit({ctor:function(){}}),t.inherit=inherit}(this,"undefined"==typeof exports?this:exports),define("inherit",function(){return inherit}),define("inherit",function(){}),define("js/core/Base",["inherit"],function(e){var t=e.Base.inherit("js.core.Base",{ctor:function(){},runsInBrowser:function(){return"undefined"!=typeof window},log:function(e,n){if(n=n||t.LOGLEVEL.INFO,e instanceof Error&&(e=e.toString()),t.logger.length)for(var r=0;r<t.logger.length;r++)t.logger[r].log(e,n);else"undefined"!=typeof console&&(console[n]||console.log).call(console,e)}});return t.logger=[],t.LOGLEVEL={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error"},t}),define("js/core/EventDispatcher",["js/core/Base"],function(e){Function.prototype.on=function(){var e=Array.prototype.slice.call(arguments,0);this._events=this._events||[];for(var t=0;t<e.length;t++){var n=e[t];this._events.push(n)}return this},Function.prototype.onChange=function(){var e=Array.prototype.slice.call(arguments,0);this._events=this._events||[],this._attributes=this._attributes||[];for(var t=0;t<e.length;t++){var n=e[t];this._attributes.push(n),n="change:"+n,this._events.push(n)}return this};var t,n=e.inherit("js.core.EventDispatcher",{ctor:function(){this.callBase(),this._eventHandlers={}},bind:function(e,t,r){if(t){r=r||this;var i=this._eventHandlers[e]||(this._eventHandlers[e]=[]),s=new n.EventHandler(t,r);return i.push(s),s}return console.warn('no eventHandler for "'+e+'"'),null},trigger:function(e,r,i){if(this._eventHandlers[e]){r instanceof n.Event||(r=new n.Event(r)),i||(i=arguments.callee.caller),r.target=i,r.type=e;for(var s=this._eventHandlers[e],o=0;o<s.length;o++)if(s[o]){var a=s[o].trigger(r,i);if(a!==t&&(ret=a,a===!1&&(r.preventDefault(),r.stopPropagation())),r.isImmediatePropagationStopped)break}}return r},unbind:function(e,t,n){if(e)if(t){if(this._eventHandlers[e])for(var r=this._eventHandlers[e],i=r.length-1;i>=0;i--)r[i].$callback==t&&(!n||n===r[i].scope)&&r.splice(i,1)}else this._eventHandlers[e]=[];else this._eventHandlers={}},destroy:function(){this._eventHandlers={}}});return n.Event=e.inherit({ctor:function(e,t){this.$=e,this.target=t,this.isDefaultPrevented=!1,this.isPropagationStopped=!1,this.isImmediatePropagationStopped=!1},preventDefault:function(){this.isDefaultPrevented=!0;var e=this.$.orginalEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=!0,this.stopPropagation()}}),n.EventHandler=e.inherit({ctor:function(e,t){this.scope=t,this.$callback=e},trigger:function(e,t){return this.$callback.call(this.scope,e,t),!e.isPropagationStopped}}),n}),function(){function e(t,n,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;if(t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped),t.isEqual&&_.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&_.isFunction(n.isEqual))return n.isEqual(t);var i=c.call(t);if(i!=c.call(n))return!1;switch(i){case"[object String]":return t==String(n);
case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var s=r.length;s--;)if(r[s]==t)return!0;r.push(t);var o=0,a=!0;if("[object Array]"==i){if(o=t.length,a=o==n.length)for(;o--&&(a=o in t==o in n&&e(t[o],n[o],r)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var l in t)if(_.has(t,l)&&(o++,!(a=_.has(n,l)&&e(t[l],n[l],r))))break;if(a){for(l in n)if(_.has(n,l)&&!o--)break;a=!o}}return r.pop(),a}var t=this,n=t._,r={},i=Array.prototype,s=Object.prototype,o=Function.prototype,a=i.slice,l=i.unshift,c=s.toString,u=s.hasOwnProperty,h=i.forEach,f=i.map,d=i.reduce,p=i.reduceRight,v=i.filter,m=i.every,g=i.some,$=i.indexOf,y=i.lastIndexOf,b=Array.isArray,x=Object.keys,C=o.bind,_=function(e){return new T(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):t._=_,_.VERSION="1.3.3";var w=_.each=_.forEach=function(e,t,n){if(null!=e)if(h&&e.forEach===h)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(i in e&&t.call(n,e[i],i,e)===r)return}else for(var o in e)if(_.has(e,o)&&t.call(n,e[o],o,e)===r)return};_.map=_.collect=function(e,t,n){var r=[];return null==e?r:f&&e.map===f?e.map(t,n):(w(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},_.reduce=_.foldl=_.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduce===d)return r&&(t=_.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(w(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return n},_.reduceRight=_.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return r&&(t=_.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=_.toArray(e).reverse();return r&&!i&&(t=_.bind(t,r)),i?_.reduce(s,t,n,r):_.reduce(s,t)},_.find=_.detect=function(e,t,n){var r;return j(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},_.filter=_.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(w(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},_.reject=function(e,t,n){var r=[];return null==e?r:(w(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},_.every=_.all=function(e,t,n){var i=!0;return null==e?i:m&&e.every===m?e.every(t,n):(w(e,function(e,s,o){return(i=i&&t.call(n,e,s,o))?void 0:r}),!!i)};var j=_.some=_.any=function(e,t,n){t||(t=_.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,n):(w(e,function(e,s,o){return i||(i=t.call(n,e,s,o))?r:void 0}),!!i)};_.include=_.contains=function(e,t){var n=!1;return null==e?n:$&&e.indexOf===$?-1!=e.indexOf(t):n=j(e,function(e){return e===t})},_.invoke=function(e,t){var n=a.call(arguments,2);return _.map(e,function(e){return(_.isFunction(t)?t||e:e[t]).apply(e,n)})},_.pluck=function(e,t){return _.map(e,function(e){return e[t]})},_.max=function(e,t,n){if(!t&&_.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&_.isEmpty(e))return-1/0;var r={computed:-1/0};return w(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},_.min=function(e,t,n){if(!t&&_.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&_.isEmpty(e))return 1/0;var r={computed:1/0};return w(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},_.shuffle=function(e){var t,n=[];return w(e,function(e,r){t=Math.floor(Math.random()*(r+1)),n[r]=n[t],n[t]=e}),n},_.sortBy=function(e,t,n){var r=_.isFunction(t)?t:function(e){return e[t]};return _.pluck(_.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return void 0===n?1:void 0===r?-1:r>n?-1:n>r?1:0}),"value")},_.groupBy=function(e,t){var n={},r=_.isFunction(t)?t:function(e){return e[t]};return w(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},_.sortedIndex=function(e,t,n){n||(n=_.identity);for(var r=0,i=e.length;i>r;){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},_.toArray=function(e){return e?_.isArray(e)?a.call(e):_.isArguments(e)?a.call(e):e.toArray&&_.isFunction(e.toArray)?e.toArray():_.values(e):[]},_.size=function(e){return _.isArray(e)?e.length:_.keys(e).length},_.first=_.head=_.take=function(e,t,n){return null==t||n?e[0]:a.call(e,0,t)},_.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},_.last=function(e,t,n){return null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},_.rest=_.tail=function(e,t,n){return a.call(e,null==t||n?1:t)},_.compact=function(e){return _.filter(e,function(e){return!!e})},_.flatten=function(e,t){return _.reduce(e,function(e,n){return _.isArray(n)?e.concat(t?n:_.flatten(n)):(e[e.length]=n,e)},[])},_.without=function(e){return _.difference(e,a.call(arguments,1))},_.uniq=_.unique=function(e,t,n){var r=n?_.map(e,n):e,i=[];return e.length<3&&(t=!0),_.reduce(r,function(n,r,s){return(t?_.last(n)===r&&n.length:_.include(n,r))||(n.push(r),i.push(e[s])),n},[]),i},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=_.intersect=function(e){var t=a.call(arguments,1);return _.filter(_.uniq(e),function(e){return _.every(t,function(t){return _.indexOf(t,e)>=0})})},_.difference=function(e){var t=_.flatten(a.call(arguments,1),!0);return _.filter(e,function(e){return!_.include(t,e)})},_.zip=function(){for(var e=a.call(arguments),t=_.max(_.pluck(e,"length")),n=new Array(t),r=0;t>r;r++)n[r]=_.pluck(e,""+r);return n},_.indexOf=function(e,t,n){if(null==e)return-1;var r,i;if(n)return r=_.sortedIndex(e,t),e[r]===t?r:-1;if($&&e.indexOf===$)return e.indexOf(t);for(r=0,i=e.length;i>r;r++)if(r in e&&e[r]===t)return r;return-1},_.lastIndexOf=function(e,t){if(null==e)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},_.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);r>i;)s[i++]=e,e+=n;return s};var E=function(){};_.bind=function(e,t){var n,r;if(e.bind===C&&C)return C.apply(e,a.call(arguments,1));if(!_.isFunction(e))throw new TypeError;return r=a.call(arguments,2),n=function(){if(this instanceof n){E.prototype=e.prototype;var i=new E,s=e.apply(i,r.concat(a.call(arguments)));return Object(s)===s?s:i}return e.apply(t,r.concat(a.call(arguments)))}},_.bindAll=function(e){var t=a.call(arguments,1);return 0==t.length&&(t=_.functions(e)),w(t,function(t){e[t]=_.bind(e[t],e)}),e},_.memoize=function(e,t){var n={};return t||(t=_.identity),function(){var r=t.apply(this,arguments);return _.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},_.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},_.defer=function(e){return _.delay.apply(_,[e,1].concat(a.call(arguments,1)))},_.throttle=function(e,t){var n,r,i,s,o,a,l=_.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var c=function(){i=null,o&&e.apply(n,r),l()};return i||(i=setTimeout(c,t)),s?o=!0:a=e.apply(n,r),l(),s=!0,a}},_.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}},_.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments))}},_.wrap=function(e,t){return function(){var n=[e].concat(a.call(arguments,0));return t.apply(this,n)}},_.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},_.after=function(e,t){return 0>=e?t():function(){return--e<1?t.apply(this,arguments):void 0}},_.keys=x||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)_.has(e,n)&&(t[t.length]=n);return t},_.values=function(e){return _.map(e,_.identity)},_.functions=_.methods=function(e){var t=[];for(var n in e)_.isFunction(e[n])&&t.push(n);return t.sort()},_.extend=function(e){return w(a.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},_.pick=function(e){var t={};return w(_.flatten(a.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},_.defaults=function(e){return w(a.call(arguments,1),function(t){for(var n in t)null==e[n]&&(e[n]=t[n])}),e},_.clone=function(e){return _.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},_.tap=function(e,t){return t(e),e},_.isEqual=function(t,n){return e(t,n,[])},_.isEmpty=function(e){if(null==e)return!0;if(_.isArray(e)||_.isString(e))return 0===e.length;for(var t in e)if(_.has(e,t))return!1;return!0},_.isElement=function(e){return!!e&&1==e.nodeType},_.isArray=b||function(e){return"[object Array]"==c.call(e)},_.isObject=function(e){return e===Object(e)},_.isArguments=function(e){return"[object Arguments]"==c.call(e)},_.isArguments(arguments)||(_.isArguments=function(e){return!!e&&!!_.has(e,"callee")}),_.isFunction=function(e){return"[object Function]"==c.call(e)},_.isString=function(e){return"[object String]"==c.call(e)},_.isNumber=function(e){return"[object Number]"==c.call(e)},_.isFinite=function(e){return _.isNumber(e)&&isFinite(e)},_.isNaN=function(e){return e!==e},_.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},_.isDate=function(e){return"[object Date]"==c.call(e)},_.isRegExp=function(e){return"[object RegExp]"==c.call(e)},_.isNull=function(e){return null===e},_.isUndefined=function(e){return void 0===e},_.has=function(e,t){return u.call(e,t)},_.noConflict=function(){return t._=n,this},_.identity=function(e){return e},_.times=function(e,t,n){for(var r=0;e>r;r++)t.call(n,r)},_.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},_.result=function(e,t){if(null==e)return null;var n=e[t];return _.isFunction(n)?n.call(e):n},_.mixin=function(e){w(_.functions(e),function(t){R(t,_[t]=e[t])})};var S=0;_.uniqueId=function(e){var t=S++;return e?e+t:t},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/.^/,F={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var P in F)F[F[P]]=P;var I=/\\|'|\r|\n|\t|\u2028|\u2029/g,M=/\\(\\|'|r|n|t|u2028|u2029)/g,N=function(e){return e.replace(M,function(e,t){return F[t]})};_.template=function(e,t,n){n=_.defaults(n||{},_.templateSettings);var r="__p+='"+e.replace(I,function(e){return"\\"+F[e]}).replace(n.escape||A,function(e,t){return"'+\n_.escape("+N(t)+")+\n'"}).replace(n.interpolate||A,function(e,t){return"'+\n("+N(t)+")+\n'"}).replace(n.evaluate||A,function(e,t){return"';\n"+N(t)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,_);var s=function(e){return i.call(this,e,_)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},_.chain=function(e){return _(e).chain()};var T=function(e){this._wrapped=e};_.prototype=T.prototype;var B=function(e,t){return t?_(e).chain():e},R=function(e,t){T.prototype[e]=function(){var e=a.call(arguments);return l.call(e,this._wrapped),B(t.apply(_,e),this._chain)}};_.mixin(_),w(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];T.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return("shift"==e||"splice"==e)&&0===r&&delete n[0],B(n,this._chain)}}),w(["concat","join","slice"],function(e){var t=i[e];T.prototype[e]=function(){return B(t.apply(this._wrapped,arguments),this._chain)}}),T.prototype.chain=function(){return this._chain=!0,this},T.prototype.value=function(){return this._wrapped}}.call(this),define("underscore",function(){return _}),define("underscore",function(){}),define("js/core/Binding",["js/core/EventDispatcher","js/lib/parser","underscore"],function(e,t,n){var r,i=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(r.type!=a)return!1;t.push(r.name)}return t.join(".")},s=e.inherit("js.core.Binding",{defaults:{event:"change",path:null,twoWay:!1},ctor:function(e){if(!r)try{r=requirejs("js/core/Bindable")}catch(t){r=null}this.callBase(),this.$=e,n.defaults(this.$,this.defaults),this.initialize()},transform:function(e){return e},transformBack:function(e){return e},initialize:function(){this._checkAttributes(),this.$parameters=[],this.$events=[],this.$subBinding=null,this.$.rootScope||(this.$.rootScope=this);var e=this.$.scope;n.isString(this.$.path)&&(this.$.path=t.parse(this.$.path,"path")),this.$.key=this.$.path[0];var r=this;if(this.$.key.type==o){var i=this.$.key.name;if(this.$parameters=this.$.key.parameter,n.isFunction(e[i])){var s=e[i],a=[];if(s._attributes&&s._attributes.length>0)this.$.scope.bind("change",this._changeCallback,this),this.$events.push({eventType:"change",callback:this._changeCallback});else{a=s._events?s._events:[];for(var l,c=0;c<a.length;c++)l=a[c],e.bind(l,this._callback,this),this.$events.push({eventType:l,callback:this._callback})}for(var u,h=function(){r.trigger()},f=0;f<this.$parameters.length;f++)u=this.$parameters[f],n.isObject(u)&&(this.$parameters[f]=this.$.bindingCreator.create(u,this.$.target,h));this.$.fnc=s,this.$.fnc.trigger=function(){r.trigger()}}}else this.$.event="change:"+this.$.key.name,this.$events.push({eventType:this.$.event,callback:this._callback}),e.bind(this.$.event,this._callback,this);this.$.twoWay===!0&&1===this.$.path.length&&(this.$.targetEvent="change:"+this.$.targetKey,this.$.target.bind(this.$.targetEvent,this._revCallback,this)),this._createSubBinding(),e.bind("destroy",function(){r.destroy()}),1===this.$.path.length&&this.trigger()},_checkAttributes:function(){if(!this.$.path)throw"No path defined!";if(!this.$.scope)throw"No scope defined!";if(this.$.twoWay){if(!this.$.target)throw"TwoWay binding, but no target defined!";if(!this.$.target instanceof r)throw"Target is not a Bindable!";if(!this.$.targetKey)throw"TwoWay binding, but no target key defined!"}this.$.bindingCreator||(this.$.bindingCreator=this),this.$.transform&&(this.transform=this.$.transform),this.$.transformBack&&(this.transformBack=this.$.transformBack)},_createSubBinding:function(){if(this.$.path.length>1){var e;e=this.$.fnc?this.getValue():this.$.scope.$[this.$.key.name],e&&e instanceof r&&(this.$subBinding=new s({scope:e,path:this.$.path.slice(1),target:this.$.target,targetKey:this.$.targetKey,rootScope:this.$.rootScope,callback:this.$.callback,context:this.$.context,twoWay:this.$.twoWay,transform:this.$.transform,transformBack:this.$.transformBack,bindingCreator:this.$.bindingCreator}))}},_revCallback:function(e){if(this.$.fnc){var t=this._getFncParameters();t.unshift(e.$),this.$.fnc.apply(this.$.scope,t)}else this.$.scope.set(i(this.$.path),this.transformBack(e.$))},_changeCallback:function(e){for(var t=0;t<this.$.fnc._attributes.length;t++)if(!n.isUndefined(e.$[this.$.fnc._attributes[t]]))return this.trigger(),void 0},_callback:function(){this.$subBinding&&(this.$subBinding.destroy(),this.$subBinding=null),this._createSubBinding(),this.trigger()},destroy:function(){for(var e,t=0;t<this.$events.length;t++)e=this.$events[t],this.$.scope.unbind(e.eventType,e.callback);this.$.twoWay===!0&&this.$.target.unbind(this.$.targetEvent,this._revCallback),this.$subBinding&&(this.$subBinding.destroy(),delete this.$subBinding);for(var n=0;n<this.$parameters.length;n++){var r=this.$parameters[n];r instanceof s&&r.destroy()}},_getFncParameters:function(){for(var e=[],t=0;t<this.$parameters.length;t++){var n=this.$parameters[t];n instanceof s&&(n=n.getValue()),e.push(n)}return e},getValue:function(){return this.$subBinding?this.$subBinding.getValue():this.$.fnc?this.$.fnc.apply(this.$.scope,this._getFncParameters()):1==this.$.path.length?this.$.scope.get(this.$.key.name):null},getContextValue:function(){return this.$.context&&this.$.context.length>1?s.contextToString(this.$.context):this.getValue()},trigger:function(){var e=this.getContextValue();this.$.targetKey?this.$.target.set(this.$.targetKey,this.transform(e)):this.$.callback&&this.$.callback.call(this.$.target,this.transform(e))},toString:function(){return this.getValue()},create:function(e,t,n){var r,i,o={scope:this.$.scope,target:t,callback:n,path:e.path,twoWay:e.type===l,bindingCreator:this.$.bindingCreator};return e.transform&&(r=e.transform.pop(),i=this.get(e.transform),i&&(o.transform=i[r.name])),e.transformBack&&(r=e.transformBack.pop(),i=this.get(e.transform),i&&(o.transformBack=i[r.name])),new s(o)}}),o=s.TYPE_FNC="fnc",a=s.TYPE_VAR="var",l=(s.TYPE_STATIC="static",s.TYPE_TWOWAY="twoWay");return s.contextToString=function(e){for(var t,n="",r=0;r<e.length;r++)t=e[r],t instanceof s&&(t=t.getValue()),null!==t&&"undefined"!=typeof t&&(n+=t);return n},s}),define("js/core/BindingCreator",["js/core/EventDispatcher","js/lib/parser","js/core/Binding","underscore"],function(e,t,n,r){function i(e,t){var r=e[0];t=r.type==n.TYPE_FNC?t.getScopeForFncName(r.name):t.getScopeForKey(r.name);for(var i=t;i&&e.length>0;){if(r=e.shift(),r.type==n.TYPE_FNC)return i[r.name];r.type==n.TYPE_VAR&&(i=i.get(r.name))}return!1}return e.inherit("js.core.BindingCreator",{create:function(e,t,s,o){var a,l=e.path,c=l[0],u=t;if(c.type!=n.TYPE_FNC&&s==c.name&&(u=u.$parentScope),a=c.type==n.TYPE_FNC?u.getScopeForFncName(c.name):u.getScopeForKey(c.name)){if("static"!==e.type){var h;r.isFunction(s)&&(h=s);var f=e.type==n.TYPE_TWOWAY,d={scope:a,path:l,target:t,twoWay:f,context:o,bindingCreator:this};if(f){if(e.transform){var p=i(e.transform,u);p&&(d.transform=p)}if(e.transformBack){var v=i(e.transformBack,u);v&&(d.transformBack=v)}}return h?d.callback=h:d.targetKey=s,new n(d)}return a.get(e.path)}throw"Couldn't find scope for "+c.name},evaluate:function(e,i,s){if(!r.isString(e))return e;for(var o,a=t.parse(e,"text"),l=[],c=0;c<a.length;c++){var u=a[c];u.length?a[c]=u:(o=this.create(u,i,s,a),o instanceof n&&l.push(o),a[c]=o)}return l.length>0?l[0].getContextValue():a.length>0?1===a.length?a[0]:n.contextToString(a):e}})}),define("js/core/Bindable",["js/core/EventDispatcher","js/lib/parser","js/core/Binding","underscore"],function(e,t,n,r){var i=e.inherit("js.core.Bindable",{ctor:function(e){this.$eventBindables=[],this.callBase(null),this.$={},r.extend(this._eventAttributes,this.base._eventAttributes||{}),e=e||{};var t=this._defaultAttributes();for(var n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)||(e[n]=r.isFunction(t[n])?new t[n]:r.clone(t[n])));this.$=e,this.$previousAttributes=r.clone(e)},defaults:{},_defaultAttributes:function(){return this._generateDefaultsChain("defaults")},_generateDefaultsChain:function(e){for(var t=this[e],n=this.base;n;)r.defaults(t,n[e]),n=n.base;return t},set:function(e,t,n){var i={};if(r.isString(e)){var s=e.split(".");if(s.length>1){var o=this.get(s.shift());if(o&&o.set)return o.set(s.join("."),t,n),this}i[e]=t}else n=t,i=e;if(n=n||{silent:!1,unset:!1},n.unset)for(e in i)i.hasOwnProperty(e)&&(i[e]=void 0);var a,l,c={},u=this.$;for(e in i)i.hasOwnProperty(e)&&(a=i[e],n.unset===!0?delete u[e]:r.isEqual(u[e],i[e])||(l=u[e],this.$previousAttributes[e]=l,u[e]=i[e],c[e]=u[e]));if(this._commitChangedAttributes(c),n.silent===!1&&r.size(c)>0){for(e in c)c.hasOwnProperty(e)&&this.trigger("change:"+e,c[e],this);this.trigger("change",c,this)}return this},get:function(e,n){if(n||(n=e,e=this),!n)return null;var s;s=r.isArray(n)?n:r.isObject(n)?[n]:t.parse(n,"path");for(var o;e&&s.length>0;){if(o=s.shift(),"fnc"==o.type){for(var a=e[o.name],l=o.parameter,c=0;c<l.length;c++){var u=l[c];r.isObject(u)&&(u.type="static",l[c]=this.get(u.path))}e=a.apply(e,l)}else"var"==o.type&&(e=e instanceof i?0===s.length?e.$[o.name]:e.get(o.name):e[o.name]);e&&""!==o.index&&(r.isArray(e)?e=e[o.index]:e.at&&(e=e.at(o.index)))}return e},has:function(e){return!r.isUndefined(this.get(e))},_commitChangedAttributes:function(){},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(){return this.set(this.$,{unset:!0})},bind:function(e,t,i,o){if(t instanceof Function&&r.isString(e))return this.callBase(e,t,i);r.isArray(e)&&e.length>0&&(o=i,i=t,t=e[1],e=e[2]);var a=new s({path:e,event:t,scope:o,callback:i,value:null});a.set("binding",new n({path:e,scope:this,target:a,targetKey:"value"})),this.$eventBindables.push(a)},unbind:function(e,t,n,r){if(t instanceof Function)this.callBase(e,t,n);else for(var i,s=this.$eventBindables.length-1;s>=0;s--)i=this.$eventBindables[s],i.$.scope===r&&i.$.path===e&&i.$.event===t&&i.$.callback===n&&(i.destroy(),this.$eventBindables.slice(s,1))},destroy:function(){this.callBase();for(var e=0;e<this.$eventBindables.length;e++)this.$eventBindables[e].destroy();return this.trigger("destroy",this),this}}),s=i.inherit({_commitChangedAttributes:function(e){this.callBase(),this._unbindEvent(this.$previousAttributes.value),r.isUndefined(e.value)||this._bindEvent(e.value)},_unbindEvent:function(t){t&&t instanceof e&&t.unbind(this.$.event,this.$.callback,this.$.scope)},_bindEvent:function(t){t&&t instanceof e&&t.bind(this.$.event,this.$.callback,this.$.scope)},destroy:function(){this._unbindEvent(this.$.value),this.$.binding.destroy(),this.callBase()}});return i}),define("js/core/Element",["js/core/Bindable","underscore","js/core/BindingCreator"],function(e,t,n){function r(e){if(t.isString(e)){var n=Number(e);if(!isNaN(n))return n;if("true"===e)return!0;if("false"===e)return!1}return e}var i,s=new n,o=e.inherit("js.core.Element",{ctor:function(e,t,n,r,o){e=e||{},t||o||(o=this),this.$descriptor=t,this.$systemManager=n,this.$parentScope=r||null,this.$rootScope=o||null,this.$attributesNamespace=this.$attributesNamespace||{},this.$bindingCreator=s,this.callBase(e),this._initializeAttributes(this.$),(t===i||null===t)&&this._initialize(this.$creationPolicy)},_getAttributesFromDescriptor:function(e){this.$attributesNamespace=this.$attributesNamespace||{};var t={};if(e&&e.attributes)for(var n,i,s=0;s<e.attributes.length;s++)n=e.attributes[s],0!==n.nodeName.indexOf("xmlns")&&(i=this._getLocalNameFromNode(n),t[i]=r(n.value),n.namespaceURI&&(this.$attributesNamespace[i]=n.namespaceURI));return t},_getLocalNameFromNode:function(e){return e.localName?e.localName:e.name.split(":").pop()},defaults:{creationPolicy:"auto"},_initializeAttributes:function(){},_initializeDescriptors:function(){},_initialize:function(e,t){this.$initialized||(this._preinitialize(),this.initialize(),this._initializeDescriptors(),(this==this.$rootScope||t)&&this._initializeBindings())},_initializeBindings:function(){this._initializationComplete()},initialize:function(){},find:function(e){var t=this.getScopeForKey(e);return this===t?this.get(e):null!=t?t.get(e):null},getScopeForKey:function(e){var n=this.$[e];return t.isUndefined(n)?this.$parentScope?this.$parentScope.getScopeForKey(e):null:this},getScopeForFncName:function(e){var n=this[e];return!t.isUndefined(n)&&t.isFunction(n)?this:this.$parentScope?this.$parentScope.getScopeForFncName(e):null},_preinitialize:function(){},_initializationComplete:function(){this._commitChangedAttributes(this.$),this.$initialized=!0},_getTextContentFromDescriptor:function(e){var t=e.textContent||e.text||e.data;if(!t){t="";for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];(1==r.nodeType||4==r.nodeType)&&(t+=this._getTextContentFromDescriptor(r))}}return t}});return o.xmlStringToDom=function(e){if(window&&window.DOMParser)return(new DOMParser).parseFromString(e,"text/xml").documentElement;if("undefined"!=typeof ActiveXObject){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async=!1,t.loadXML(e),t.documentElement}throw"Couldn't parse xml string"},o}),define("js/core/TextElement",["js/core/Element","underscore"],function(e,t){return e.inherit("js.core.TextElement",{_initializeBindings:function(){this.$.textContent=this.$bindingCreator.evaluate(this.$.textContent||"",this,"textContent"),this.callBase()},_initializeDescriptors:function(){this.$descriptor&&(this.$.textContent=this._getTextContentFromDescriptor(this.$descriptor))},render:function(){return this.$initialized||this._initialize(this.$creationPolicy),this.$el=this.$systemManager.$document.createTextNode(""),this._renderTextContent(this.$.textContent),this.$el},_renderTextContent:function(e){(t.isUndefined(this.$.textContent)||null===e)&&(e=""),this.$el.nodeValue=e},_commitChangedAttributes:function(e){this.$el&&(t.isUndefined(e.textContent)||this._renderTextContent(e.textContent))}})}),define("js/core/Component",["require","js/core/Element","js/core/TextElement","js/core/Bindable","js/core/EventDispatcher","underscore"],function(e,t,n,r,i,s){var o,a,l=t.inherit("js.core.Component",{ctor:function(t,n){if(s.isUndefined(o))try{o=e("js/core/Template")}catch(r){o=null}if(s.isUndefined(a))try{a=e("js/conf/Configuration")}catch(r){a=null}this.$eventDefinitions=[],this.$internalDescriptors=[],this.$xamlDefaults={},this.$xamlAttributes={};for(var i,l=this;l;)l._$descriptor&&i!=l&&(this._cleanUpDescriptor(l._$descriptor),this.$internalDescriptors.unshift(l._$descriptor),s.extend(this.$xamlDefaults,this._getAttributesFromDescriptor(l._$descriptor))),l=l.base;n&&(this._cleanUpDescriptor(n),this.$xamlAttributes=this._getAttributesFromDescriptor(n)),this.$elements=[],this.$templates={},this.$configurations=[],this.$children=[],t=t||{},s.extend(t,this.$xamlAttributes,this.$xamlDefaults),this.callBase()},events:[],inject:{},_injectChain:function(){return this._generateDefaultsChain("inject")},_preinitialize:function(){this.callBase(),this._inject()},_inject:function(){var e=this._injectChain();if(s.keys(e).length>0){var t=this.$systemManager.$injection;if(!t)throw"injection not available in systemManager";for(var n in e)e.hasOwnProperty(n)&&(this.$[n]=t.getInstance(e[n]))}},addChild:function(e){if(!(e instanceof t))throw"only children of type js.core.Component can be added";"auto"==this.$creationPolicy&&e._initialize(this.$creationPolicy),e.$rootScope&&e.$.cid&&e.$rootScope.set(e.$.cid,e),e.$parent=this,this.$elements.push(e),o&&e instanceof o?this._addTemplate(e):a&&e instanceof a&&this._addConfiguration(e)},removeChild:function(e){if(!(e instanceof t))throw"only children of type js.core.Component can be removed";var n=this.$elements.indexOf(e);-1!=n&&(e.$parent=null,this.$elements.splice(n,1)),this.$templates.hasOwnProperty(e.$.name)&&delete this.$templates[e.$.name],n=this.$elements.indexOf(e),-1!=n&&this.$configurations.splice(n,1)},_addTemplate:function(e){if(!e.$.name)throw"template without name";this.$templates[e.$.name]=e},_addConfiguration:function(e){this.$configurations.push(e)},getTemplate:function(e){var t=this.$templates[e];return t?t:this.$parent&&this.$parent!=this?this.$parent.getTemplate(e):null},_initializeChildren:function(e){for(var t=0;t<e.length;t++)this.addChild(e[t])},_initializeAttributes:function(e){this.callBase(),"full"!=this.$creationPolicy&&e.hasOwnProperty("creationPolicy")&&(this.$creationPolicy=e.creationPolicy,delete e.creationPolicy)},_initializeDescriptors:function(){for(var e,t=[],n=0;n<this.$internalDescriptors.length;n++)e=this.$internalDescriptors[n],t=t.concat(this._getChildrenFromDescriptor(e,this));t=t.concat(this._getChildrenFromDescriptor(this.$descriptor)),this._initializeChildren(t),this._childrenInitialized(),this._initializeEventAttributes(this.$xamlDefaults,this),this._initializeEventAttributes(this.$xamlAttributes,this.$rootScope)},_cleanUpDescriptor:function(e){if(e&&e.childNodes)for(var t,n,r=e.childNodes.length-1;r>=0;r--)t=e.childNodes[r],3===t.nodeType&&(n=t.textContent||t.text||t.data,(!n||0===n.trim().length)&&e.removeChild(t))},_isEventAttribute:function(e){return 0==e.indexOf("on")},_isComponentEvent:function(e){for(var t=0;t<this.events.length;t++)if(e==this.events[t])return!0;return!1},_getEventTypeForAttribute:function(e){return this._eventAttributes[e]},_initializeEventAttributes:function(e,t){var n="";for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(this._isEventAttribute(r)){if(!t[i])throw"Couldn't find callback "+i+" for "+r+" event";this.$eventDefinitions.push({name:r,scope:t,fncName:i}),n=r.substr(2),this._isComponentEvent(n)&&this.bind(n,t[i],t)}}},_initializeBindings:function(){var e,t=this.$;for(var n in t)t.hasOwnProperty(n)&&(e=t[n],this.$[n]=this.$bindingCreator.evaluate(e,this,n));for(var r=0;r<this.$elements.length;r++)this.$elements[r]._initializeBindings();this.callBase()},_createComponentForNode:function(e,t,n){if(!e)return null;if(t=t||{},n=n||this.$rootScope,this.$systemManager.$applicationDomain,1==e.nodeType){var r=this.$systemManager.$applicationContext.getFqClassName(e.namespaceURI,this._localNameFromDomNode(e),!0),i=this.$systemManager.$applicationContext.getFqClassName(e.namespaceURI,this._localNameFromDomNode(e),!1);return this.$systemManager.$applicationContext.createInstance(r,[t,e,this.$systemManager,this,n],i)}if(3==e.nodeType||4==e.nodeType){var s=e.textContent?e.textContent:e.text;return e.textContent&&(e.textContent=s),this._createTextElement(e,n)}return null},createComponent:function(e,t){return t=t||[],this.$systemManager.$applicationContext.createInstance(e,[t,null,this.$systemManager,this,this.$rootScope])},_createTextElement:function(e,t){return this.$systemManager.$applicationContext.createInstance("js/core/TextElement",[null,e,this.$systemManager,this,t])},_getChildrenFromDescriptor:function(e,t){var n,r,i=[];if(e)for(var s=0;s<e.childNodes.length;s++)n=e.childNodes[s],r=this._createComponentForNode(n,null,t),r&&i.push(r);return i},_childrenInitialized:function(){},initialize:function(){},_localNameFromDomNode:function(e){if(e.localName)return e.localName;var t=e.tagName.split(":");return t[t.length-1]}});return l}),define("js/core/Content",["require","js/core/Component"],function(e,t){return t.inherit("js.core.Content",{getChildren:function(){for(var t,n=[],r=0;r<this.$elements.length;r++)t=this.$elements[r],t instanceof e("js/html/DomElement")&&n.push(t);return n}})}),define("js/html/DomElement",["require","js/core/EventDispatcher","js/core/Component","js/core/Content","js/core/Binding","inherit","underscore"],function(e,t,n,r,i,s,o){var a,l=/\s+/,c={$classAttributes:[/^\$/,/^data/,/^xmlns/,/^on/,"cid",/^_/],ctor:function(e,t){this.$renderMap={},this.$children=[],this.$contentChildren=[],this.$domEventHandler={};for(var n=this;n;)n.$classAttributes&&(this.$classAttributes=this.$classAttributes.concat(n.$classAttributes)),n=n.base;this.callBase(),t&&(this.$tagName||(this.$tagName=t.tagName),this.$namespace||(this.$namespace=t.namespaceURI))},_inject:function(){this.callBase();var e=this._injectChain();for(var t in e)e.hasOwnProperty(t)&&this.$classAttributes.push(t)},_initializeAttributes:function(e){this.callBase(),e.tagName&&(this.$tagName=e.tagName,delete e.tagName)},addChild:function(e){this.callBase(),e instanceof f||e.render?(this.$children.push(e),this.isRendered()&&this._renderChild(e)):e instanceof r&&this.$contentChildren.push(e)},removeChild:function(e){if(this.callBase(),e instanceof f||e.render){this.isRendered()&&this._removeRenderedChild(e);var t=this.$children.indexOf(e);this.$children.splice(t,1)}},getPlaceHolder:function(e){for(var t=0;t<this.$children.length;t++)if(this.$children[t].$.name===e)return this.$children[t];var n;for(t=0;t<this.$children.length;t++)if(this.$children[t].getPlaceHolder&&(n=this.$children[t].getPlaceHolder(e)))return n;return null},remove:function(){this.$parent&&this.$parent.removeChild(this)},getContentPlaceHolders:function(){a||(a=e("js/ui/ContentPlaceHolder"));for(var t,n=[],r=0;r<this.$children.length;r++)t=this.$children[r],a&&t instanceof a?n.push(t):t instanceof f&&(n=n.concat(t.getContentPlaceHolders()));return n},findContent:function(e){for(var t,n,i=0;i<this.$elements.length;i++)if(t=this.$elements[i],t instanceof r&&t.$.name===e)return t;for(i=0;i<this.$elements.length;i++)if(t=this.$elements[i],t.findContent&&(n=t.findContent(e)))return n;
return null},render:function(){return this.$initialized||this._initialize(this.$creationPolicy),this.isRendered()?this.$el:(this.$renderedChildren=[],this.$el=this.$systemManager.$document.createElementNS&&this.$namespace&&/^http/.test(this.$namespace)?this.$systemManager.$document.createElementNS(this.$namespace,this.$tagName):this.$systemManager.$document.createElement(this.$tagName),this._initializeRenderer(this.$el),this._renderChildren(this.$children),this._renderContentChildren(this.$contentChildren),this._renderAttributes(this.$),this._bindDomEvents(this.$el),this.$el)},_bindDomEvents:function(){for(var e,t,n=0;n<this.$eventDefinitions.length;n++)e=this.$eventDefinitions[n],t=e.name.substr(2),this._isComponentEvent(t)||this.addEventListener(t,e.scope[e.fncName],e.scope)},_initializeRenderer:function(){},_renderChildren:function(e){for(var t,n=0;n<e.length;n++)t=e[n],this._renderChild(t)},_renderContentChildren:function(e){for(var t,n=0;n<e.length;n++){t=e[n];var r=t.get("ref"),i=this.getPlaceHolder(r);i&&i.set({content:t})}},_renderChild:function(e){if(o.isFunction(e.render)){var t=e.render();this.$renderedChildren.push(e),t&&this.$el.appendChild(t)}},_removeRenderedChild:function(e){if(this.isRendered())for(var t,n=this.$renderedChildren.length-1;n>=0;n--)if(t=this.$renderedChildren[n],e===t)return this.$el.removeChild(t.$el),this.$renderedChildren.splice(n,1),void 0},_clearRenderedChildren:function(){if(this.isRendered())for(var e,t=this.$renderedChildren.length-1;t>=0;t--)e=this.$renderedChildren[t],this.$el.removeChild(e.$el);this.$renderedChildren=[]},_getIndexOfPlaceHolder:function(){if(this.$layoutTpl)for(var e,t=0;t<this.$layoutTpl.$children.length;t++)if(e=this.$layoutTpl.$children[t],placeHolderId==e.$cid)return t;return-1},isRendered:function(){return"undefined"!=typeof this.$el},_renderAttributes:function(e){var t;for(var n in e)e.hasOwnProperty(n)&&(t=e[n],this._renderAttribute(n,t))},_renderAttribute:function(e,t){var n=this.$renderMap[e],r=this.$previousAttributes[e];if(o.isUndefined(n)){var i=e.charAt(0).toUpperCase()+e.substr(1),s="_render"+i;n=this[s],o.isFunction(n)||(n=!1),this.$renderMap[e]=n}if(n!==!1)n.call(this,t,r);else{for(var a,l=0;l<this.$classAttributes.length;l++)if(a=this.$classAttributes[l],a instanceof RegExp){if(a.test(e))return}else if(a==e)return;this._setAttribute(e,t)}},_setAttribute:function(e,t,n){o.isUndefined(t)||(n=n||this.$attributesNamespace[e],this.$el.setAttributeNS&&n?this.$el.setAttributeNS(n,e,t):this.$el.setAttribute(e,t))},_commitChangedAttributes:function(e){this.isRendered()&&this._renderAttributes(e)},destroy:function(){if(this.callBase(),this.$children)for(var e=0;e<this.$children.length;e++)this.$children[e].destroy()},html:function(){return this.isRendered()||this.render(),this.$el.innerHTML}.on("change"),dom:function(e){return new h(e||this)},setChildIndex:function(e,t){0>t&&(t+=this.$children.length),t>=this.$children.length&&(t-=this.$children.length);var n=this.$children.indexOf(e);n!==t&&(this.$children.splice(n,1),this.$children.splice(t,0,e),this.isRendered()&&e.isRendered()&&this.$renderedChildren.length>1&&(this.$el.removeChild(e.$el),t<this.$el.childNodes.length?this.$el.insertBefore(e.$el,this.$el.childNodes[t]):this.$el.appendChild(e.$el)))},bringToFront:function(){this.$parent&&this.$parent.setChildIndex(this,this.$parent.$children.length-1)},sendToBack:function(){this.$parent&&this.$parent.setChildIndex(this,0)}},u={hasClass:function(e){return 1!=this.$el.className.split(" "+e+" ").length},addClass:function(e){var t=e.split(l);if(this.$el.className||1!==t.length){for(var n=this.$el.className.split(l),r=0;r<t.length;r++)-1==n.indexOf(t[r])&&n.push(t[r]);this.$el.className=n.join(" ")}else this.$el.className=e},removeClass:function(e){if(this.$el.className&&0!==this.$el.className.length){for(var t=e.split(l),n=this.$el.className.split(l),r=0;r<t.length;r++){var i=n.indexOf(t[r]);-1!=i&&n.splice(i,1)}0===n.length?this.$el.removeAttribute("class"):this.$el.className=n.join(" ")}},addEventListener:function(e,t,n){var r=this;if(this.bind(e,t,n),!this.$domEventHandler[e]){var i=this.$domEventHandler[e]=function(t){var n=new f.Event(t);try{r.trigger(e,n,r)}catch(n){}return n.isPropagationStopped?!1:void 0};this.$el.addEventListener?this.$el.addEventListener(e,i,!1):this.$el.attachEvent&&this.$el.attachEvent("on"+e,i)}},removeEventListener:function(e,t,n){this.unbind(e,t,n);var r=this._eventHandlers[e];if(0===r.length){var i=this.$domEventHandler[e];this.$el.removeEventListener?this.$el.removeEventListener(e,i,!1):this.$el.detachEvent&&this.$el.detachEvent("on"+e,i)}}},h=s.Base.inherit(o.extend({ctor:function(e){this.$el=e}},u)),f=n.inherit("js.html.DomElement",o.extend(c,u));return f.Event=t.Event.inherit({ctor:function(e){this.domEvent=e,this.callBase(e)},stopPropagation:function(){this.callBase();var e=this.domEvent;e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},preventDefault:function(){this.callBase();var e=this.domEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}}),f}),define("js/html/HtmlElement",["js/html/DomElement"],function(e){return e.inherit("js/html/HtmlElement",{defaults:{selected:void 0,selectable:void 0},_renderVisible:function(e){e===!0?this.removeClass("hide"):e===!1&&this.addClass("hide")},_renderHidden:function(e){"undefined"!=typeof e&&this.set({visible:!e})},_renderSelected:function(e){e===!0?this.addClass("active"):e===!1&&this.removeClass("active")},_renderSelectable:function(e){if(e===!0){if(!this._onSelect){var t=this;this._onSelect=function(){t.set({selected:!t.$.selected})}}this.addEventListener("click",this._onSelect)}else this._onSelect&&this.removeEvent("click",this._onSelect)},_renderWidth:function(e){e&&("string"!=typeof e&&(e+="px"),this.$el.style.width=e)},_renderHeight:function(e){e&&("string"!=typeof e&&(e+="px"),this.$el.style.height=e)}})}),define("js/core/UIComponent",["js/html/HtmlElement"],function(e){return e.inherit("js.core.UIComponent",{defaults:{tagName:"div"}})}),function(e){var t=function(e){this.$context=e||{actions:[],vars:{}}},n=function(){return new t};t.prototype.seq=function(e,t){if(e instanceof Function&&(t=e,e=null),!t)throw"Sequence action not defined";var n=this;return this.$context.actions.push(function(r){var i=!1,s=!1,o=function(t,i,o){!t&&e&&(n.$context.vars[e]=i),s||(s=!0,r(t,o))},a=function(e,t){o(e,t,!1)};if(a.vars=n.$context.vars,t.length){a.end=function(e,t){o(e,t,!0)};try{t.call(a,a)}catch(l){o(l,null)}}else{a.end=function(){i=!0};try{o(null,t.call(a),i)}catch(l){o(l,null,i)}}}),this};var r=function(e,t){if(!t)throw"Parallel action not defined";return function(n,r,i,s){var o=!1,a=function(t,r,o){!t&&e&&(i[e]=r),s(n,t,o)},l=function(e,t){a(e,t,!1)};if(l.vars=r.vars,t.length){l.end=function(e,t){a(e,t,!0)};try{t.call(l,l)}catch(c){a(c,null)}}else{l.end=function(){o=!0};try{a(null,t.call(l),o)}catch(c){a(c,null,o)}}}};if(t.prototype.par=function(e){if(arguments.length>1)return this.par(Array.prototype.slice.call(arguments)),this;var t,n,i=this;if(e){var s=[];if(e instanceof Array)for(t=0;t<e.length;t++){var o=e[t];s.push(new r(null,o))}else if(e instanceof Function)this.par([e]);else for(n in e)e.hasOwnProperty(n)&&s.push(new r(n,e[n]));s.length>0&&this.$context.actions.push(function(e){!function(e,t){var n,r={},s=function(n,s,o){var a;if(t)if(s||o){var l=t;t=null,l(s,o)}else{var c=e.indexOf(n);if(!(c>=0&&c<e.length))return t("Parallel function returned which wasn't part of this parallel actions"),t=null,void 0;if(e.splice(c,1),0===e.length){for(a in r)r.hasOwnProperty(a)&&(i.$context.vars[a]=r[a]);t(null,!1),t=null}}},o=e.slice();for(n=0;n<o.length;n++){var a=o[n];a(a,i.$context,r,s)}}(s,e)})}return this},t.prototype.parEach=function(e,t){function n(e,n){r&&(n=e,e=null);var s;s=t.length>=2?function(e){t(n,e)}:function(){return t(n)},r?i.push(s):i[e]=s}if(e=e||[],t instanceof Function){var r=e instanceof Array,i=r?[]:{};if(r)for(var s=0;s<e.length;s++)n(e[s]);else for(var o in e)e.hasOwnProperty(o)&&n(o,e[o]);return this.par(i)}throw"2nd argument for parEach needs to be a function"},t.prototype.seqEach=function(e,t){function n(e){var n;n=t.length>=2?function(n){t(e,n)}:function(){return t(e)},r.seq(n)}if(e=e||[],e instanceof Array){if(t instanceof Function){for(var r=this,i=0;i<e.length;i++)n(e[i]);return this}throw"2nd argument for parEach needs to be a function"}throw"values must be an array"},t.prototype.exec=function(e){function t(e,t){try{i(e,t)}catch(n){if(r.errorHandler)try{r.errorHandler(n)}catch(n){}}}function n(e){e<r.$context.actions.length?r.$context.actions[e](function(i,s){i||s?t(i,r.$context.vars):n(e+1)}):t(null,r.$context.vars)}var r=this,i=function(t,n){e&&e(t,n)};n(0)},"undefined"!=typeof console&&console){var i=console.warn||console.log;i instanceof Function&&(t.prototype.errorHandler=function(e){e instanceof Error?i.call(console,[e.message,e.stack]):i.call(console,e)})}var s=e.flow;n.noConflict=function(){return e.flow=s,n},e.flow=n,e.Flow=t}("undefined"==typeof exports?this:exports),define("flow",function(){return flow}),define("flow",function(){}),define("js/core/History",["js/core/Bindable","flow"],function(e,t){var n,r=/^#?!?\/?/,i=function(){};return e.inherit("js.core.History",{ctor:function(){this.callBase(),this.$routers=[],this.processUrl=!0,this.$history=[]},defaults:{interval:50},getFragment:function(){var e;return e=this.runsInBrowser()?decodeURIComponent(window.location.hash):this.$history[this.$history.length-1]||"",e.replace(r,"")},start:function(e,t){var n=this;this.$checkUrlFn=function(){n.checkUrl.apply(n,arguments)},this.runsInBrowser()?"onhashchange"in window?window.addEventListener?window.addEventListener("hashchange",this.$checkUrlFn,!1):window.attachEvent("onhashchange",this.$checkUrlFn):this.$checkUrlInterval=setInterval(this.$checkUrlFn,this.$.interval):this.$history.push(t||""),this.fragment=this.getFragment(),this.navigate(this.fragment,!0,!0,e),this.processUrl=!0},stop:function(){"undefined"!=typeof window&&("onhashchange"in window?window.removeEventListener?window.removeEventListener("hashchange",this.$checkUrlFn,!1):window.detachEvent("onhashchange",this.$checkUrlFn):clearInterval(this.$checkUrlInterval))},addRouter:function(e){this.$routers.push(e)},checkUrl:function(){if(this.processUrl){var e=this.getFragment();if(e==this.fragment)return!1;this.navigate(e,!0,!0,i)}this.processUrl=!0},triggerRoute:function(e,n){for(var r=[],i=0;i<this.$routers.length;i++)r=r.concat(this.$routers[i].generateRoutingStack(e));0===r.length?(console.log("no route for '"+e+"' found."),n&&n()):t().seqEach(r,function(e,t){e(t)}).exec(n)},navigate:function(e,t,r,i){!i&&t instanceof Function&&(i=t,t=null),!i&&r instanceof Function&&(i=r,r=null),(t==n||null==t)&&(t=!0),(r==n||null==r)&&(r=!0),this.processUrl=!1,t?(this.runsInBrowser()?window.location.hash="/"+e:this.checkUrl(null),this.$history.push(e)):(this.runsInBrowser()&&window.location.replace("#/"+e),this.$history[this.$history.length-1]=e),this.fragment=e,r&&this.triggerRoute(e,i)}})}),define("js/core/Application",["js/core/UIComponent","js/core/History"],function(e,t){return e.inherit("js.core.Application",{$classAttributes:[/.+/],ctor:function(){this.history=new t,this.callBase()},initialize:function(){this.callBase()},_inject:function(){},_initializeDescriptors:function(){this.callBase(),e.prototype._inject.call(this)},start:function(e,t){e=e||{},this.$systemManager.$parameter=e,this.startHistory(t,e.initialHash)},startHistory:function(e,t){this.history.start(e,t)},render:function(e){var t=this.callBase(null);return e&&e.appendChild(t),t},toString:function(){return"js.core.Application"}})}),define("js/core/List",["js/core/Bindable","underscore"],function(e,t){return e.inherit("js.core.List",{ctor:function(e,t){this.$items=[],this.callBase(t),e&&this.add(e);var n=this;this.bind("add",function(){n.length=n.size()}),this.bind("remove",function(){n.length=n.size()}),this.length=this.size()},hasItems:function(){return this.$items.length>0}.on("add","remove"),push:function(e){this.$items.push(e),this.trigger("add",{item:e,index:this.$items.length-1})},pop:function(){return this.removeAt(this.$items.length)},shift:function(){return this.removeAt(0)},unshift:function(e){this.$items.unshift(e),this.trigger("add",{item:e,index:0})},add:function(n,r){r=r||{},t.defaults(r,{silent:!1,index:this.$items.length});var i=r.index;t.isArray(n)||(n=[n]);for(var s,o,a=0;a<n.length;a++)s=n[a],s instanceof e&&s.bind("change",this._onItemChange,this),o=i+a,this.$items.splice(o,0,s),r.silent!==!0&&this.trigger("add",{item:s,index:o})},_onItemChange:function(e,t){this.trigger("change",{item:t,index:this.$items.indexOf(t)})},remove:function(e,n){t.isArray(e)||(e=[e]);for(var r=0;r<e.length;r++)this.removeAt(this.$items.indexOf(e[r]),n)},removeAt:function(e,t){if(t=t||{},e>-1&&e<this.$items.length){var n=this.$items.splice(e,1);return t.silent!==!0&&this.trigger("remove",{item:n[0],index:e}),n[0]}return null},reset:function(e){this.$items=e,this.trigger("reset",{items:e})},sort:function(e){this.trigger("sort",{items:this.$items.sort(e),sortFnc:e})},clear:function(){this.reset([])},size:function(){return this.$items.length}.on("add","remove"),at:function(e){return e<this.$items.length&&e>=0?this.$items[e]:null},each:function(e,t){t=t||this;for(var n=0;n<this.$items.length;n++)e.call(t,this.$items[n],n)}})}),define("js/data/Entity",["require","js/core/Bindable","js/core/List"],function(e,t,n){var r,i=0,s=t.inherit("js.core.Entity",{ctor:function(e){this.$cid=++i,this._extendSchema(),this.callBase(e)},$schema:{},$context:null,$dependentObjectContext:null,$cacheInRootContext:!1,$isDependentObject:!0,_extendSchema:function(){for(var e=this.base;e instanceof s;){var t=e.$schema;for(var n in t)t.hasOwnProperty(n)&&!this.$schema.hasOwnProperty(n)&&(this.$schema[n]=t[n]);e=e.base}},getContextForChildren:function(e){return e.prototype.$cacheInRootContext?this.$context.$datasource.getContext():this._isChildFactoryDependentObject(e)?(this.$dependentObjectContext||(this.$dependentObjectContext=this.$context.$datasource.createContext()),this.$dependentObjectContext):this.$context},_isChildFactoryDependentObject:function(e){return e&&e.prototype.$isDependentObject},parse:function(t,i,o){if(!r)try{r=e("js/data/Collection")}catch(a){}var l=this.$context.$datasource.getProcessorForModel(this);t=l.parse(t,i,o);var c=this.$schema;for(var u in c)if(c.hasOwnProperty(u)&&t.hasOwnProperty(u)){var h,f,d,p,v,m=t[u],g=c[u];if(g instanceof Array){if(1===g.length)h=g[0];else{if(0!==g.length)throw"Cannot determinate ModelFactory. Multiple factories defined for '"+u+"'.";this.log('ModelFactory for ListItem for "'+u+'" not defined',"warn"),h=s}if(!(h.prototype instanceof s))throw"Factory for type '"+u+"' isn't an instance of Entity";if(!(m instanceof Array||null===m))throw'Schema for type "'+u+'" requires to be an array';if(p=t[u]=new n,v=h===this.$context.$datasource.$entityFactory||h===this.$context.$datasource.$modelFactory?u:null,m)for(d=0;d<m.length;d++)f=this.getContextForChildren(h).createEntity(h,m[d].id,v),f.set(f.parse(m[d],i,o)),p.add(f)}else if(r&&g.classof(r)){v=g===this.$context.$datasource.$collectionFactory?u:g.prototype.$alias;var $=this.getContextForChildren(g);if(p=t[u]=$.createCollection(g,null,v),p.set(m),m instanceof Array||null===m)for(d=0;d<m.length;d++)f=$.createEntity(p.$modelFactory),f.set(f.parse(m[d],i,o)),p.add(f)}else{if(h=g||s,!(h.prototype instanceof s))throw"Factory for type '"+u+"' isn't an instance of Entity";v=h===this.$context.$datasource.$entityFactory||h===this.$context.$datasource.$modelFactory?u:null,t[u]=f=this.getContextForChildren(h).createEntity(h,this.$.id,v),f.set(f.parse(m,i,o))}}return t},prepare:function(){return this.$},compose:function(e,t){return this.prepare(e,t)}});return s}),define("js/data/Model",["js/data/Entity","js/core/List","flow","underscore"],function(e,t,n,r){function i(e,t,n){r.each(e,function(e){if(e instanceof l){var r=t[e.$alias];r&&(r.found=!0,n.push(function(t){e.fetch({fetchSubModels:r.subModels},t)}))}else e instanceof Object&&i(e,t,n)})}function s(e,t,s,o){var a=function(e,t){o&&o(e,t,s)};if(e)a(e,t);else{var c=[];if(s.fetchSubModels&&s.fetchSubModels.length>0){var u=l.createSubModelLoadingChain(t,s.fetchSubModels);i(t.$,u,c);var h=r.filter(u,function(e){return!e.found});if(h.length>0)return console.log(["requested submodel missing",h]),a("requested submodel missing",t),void 0}n().par(c).exec(function(e){a(e,t)})}}var o={CREATED:0,LOADING:1,LOADED:2,ERROR:-1},a={NEW:0,CREATED:1,DELETED:-1},l=e.inherit("js.data.Model",{ctor:function(e){this.$modelClassName=this.constructor.name,this._fetch={callbacks:[],state:o.CREATED},this.callBase(e)},$isDependentObject:!1,save:function(e,t){try{var n=this._status();if(n!==a.NEW&&n!==a.CREATED)throw"status '"+n+"' doesn't allow save";this.$context.$datasource.saveModel(this,e,t)}catch(r){t&&t(r)}},prepare:function(e,t){return e=this.callBase(),"create"===t&&delete e.id,e},compose:function(e,t){var n=this.callBase(),r=this.$context.$datasource.getProcessorForModel(this,t);return r.compose(n,e,t)},fetch:function(e,t){e=e||{};var n=this;this._fetch.state===o.LOADING?this._fetch.callbacks.push(function(n,r){s(n,r,e,t)}):this._fetch.state==o.LOADED?s(null,this,e,t):(n._fetch.state=o.LOADING,this.$context.$datasource.loadModel(this,e,function(i,a){n._fetch.state=i?o.ERROR:o.LOADED,s(i,a,e,t),r.each(n._fetch.callbacks,function(e){e(i,a)})}))},remove:function(e,t){try{var n=this._status(),r=this;if(n!==a.CREATED)throw"status '"+n+"' doesn't allow delete";this.$context.$datasource.removeModel(this,e,function(e){e||r.set("id",!1),t(e)})}catch(i){t&&t(i)}},_status:function(){return this.$.id===!1?a.DELETED:this.$.id?a.CREATED:a.NEW}.onChange("id")});return l.createSubModelLoadingChain=function(e,t){var n={},i=/^([\w][\w.]*)(?:\/([\w][\w.]*))?$/;return r.each(t,function(e){var t=i.exec(e);if(t){var r=t[1],s=t[2],o=n[r];o||(o={type:r,found:!1,subModels:[]}),s&&o.subModels.push(s),n[r]=o}}),n},l.STATE=a,l.FETCHSTATE=o,l}),define("js/html/Input",["js/html/HtmlElement"],function(e){return e.inherit("js.html.Input",{$classAttributes:["updateOnEvent","checked"],defaults:{type:"text",checked:!1,updateOnEvent:"keyup"},_renderValue:function(e){e!==this.$el.value&&(this.$el.value=e)},_renderChecked:function(e){this.$el.checked=e},_bindDomEvents:function(){var e=this;"text"===this.$.type||"password"===this.$.type?this.addEventListener(this.$.updateOnEvent,function(){e.set("value",e.$el.value)}):"checkbox"===this.$.type||"radio"===this.$.type?this.addEventListener("click",function(){e.set("checked",e.$el.checked)}):"number"==this.$.type&&this.addEventListener(this.$.updateOnEvent,function(){var t=parseInt(e.$el.value);isNaN(t)&&(t=e.$.value),e.set("value",t)}),this.callBase()}})}),define("js/conf/Configuration",["js/core/Component"],function(e){return e.inherit("js.core.Component",{})}),define("js/conf/Route",["js/conf/Configuration"],function(e){return e.inherit("js.conf.Route",{})}),define("js/core/Router",["js/core/Component","underscore","js/conf/Route"],function(e,t,n){return e.inherit("js.core.Router",{ctor:function(){this.$routes=[],this.callBase()},initialize:function(){this.callBase(),this.history=this.$.history?this.$.history:this.$systemManager.$application.history,this.history.addRouter(this)},_initializeChildren:function(){this.callBase()},_childrenInitialized:function(){this.callBase();for(var e=0;e<this.$configurations.length;e++){var t=this.$configurations[e];t instanceof n&&this.addRoute(t.$)}},addRoute:function(){var e;if(e=2==arguments.length?{route:arguments[0],fn:arguments[1]}:arguments[0],e.onexec&&(e.fn=this.$rootScope[e.onexec]),t.defaults(e,{name:null,route:null,fn:null}),e.route&&!(e.route instanceof RegExp)&&(e.route=new RegExp(e.route)),!e.fn||!e.route)throw"fn and route required";this.$routes.push(e)},generateRoutingStack:function(e){function n(e,n){r.push(function(r){var o=n.shift(),a={callback:r,router:s,params:t.clone(n),fragment:o,end:function(){r.end()},navigate:function(e,n,i){t.isUndefined(n)&&(n=!1),s.navigate(e,n,i,r)}};if(n.unshift(a),e.fn._async)try{e.fn.apply(i,n)}catch(l){r(l)}else try{r(null,e.fn.apply(i,n))}catch(l){r(l)}})}for(var r=[],i=this.$rootScope,s=this,o=0;o<this.$routes.length;o++){var a=this.$routes[o],l=a.route.exec(e);l&&n(a,l)}return r},executeRoute:function(e,n){for(var r=0;r<this.$routes.length;r++){var i=this.$routes[r],s=i.route.exec(e);if(s){var o=function(e,t){n&&n(e,t)};s.shift();var a={callback:o,router:this,params:t.clone(s),fragment:e};s.unshift(a);var l=this.$rootScope;if(i.fn._async)i.fn.apply(l,s);else try{o(null,i.fn.apply(l,s))}catch(c){o(c)}return!0}}return!1},navigate:function(e,t,n,r){return this.history.navigate(e,t,n,r)}})}),define("js/core/I18n",["require","js/core/Component","underscore"],function(e,t,n){return t.inherit("js.core.I18n",{defaults:{path:"app/locale",locale:null,suffix:".json",translations:{}},initialize:function(){this.callBase(),this.loadLocale(this.$.locale)},_commitChangedAttributes:function(e){e.locale&&this.loadLocale(e.locale)},loadLocale:function(t,n){if(!t)throw"locale not defined";var r=this;e(["json!"+this.$.path+"/"+this.$.locale],function(e){r.set({translations:e}),n&&n()})},translate:function(){var e,t=Array.prototype.slice.call(arguments),r=t.shift();n.isNumber(r)&&(e=1!==r,r=t.shift()),e&&(r+="_plural");for(var i=this.$.translations[r]||"",s=0;s<t.length;s++)i=i.split("%"+s).join(t[s]);return i}.onChange("translations")})}),define("js/core/Script",["js/core/Element"],function(Element){return Element.inherit("js.core.Script",{evaluate:function(imports){var textContent=this._getTextContentFromDescriptor(this.$descriptor),fn=eval("this.javascript = ("+textContent+")");return fn.apply(this,imports)}})}),define("js/ui/View",["js/html/HtmlElement","js/core/Content","underscore"],function(e,t,n){return e.inherit({defaults:{tagName:"div"},render:function(){var e=this.$templates.layout;if(e){var t=e.createComponents({},this,this);this._initializeLayoutChildren(t)}return this.callBase()},_initializeLayoutChildren:function(e){for(var t=0;t<e.length;t++)e[t].$rootScope=this,this.addChild(e[t])},_renderChild:function(e){if(this.callBase(),e instanceof t){var n=e.get("ref");if(n){var r=this.getPlaceHolder(n);r&&r.set({content:e})}}},_renderLayoutClass:function(e,t){n.each(this.$renderedChildren,function(n){t&&n.removeClass(t),e&&n.addClass(e)})},_renderComponentClass:function(e,t){t&&this.removeClass(t),e&&this.addClass(e)},_renderClass:function(e){e&&this.addClass(e)},_renderTemplateToPlaceHolder:function(e,t,n){this.$renderedPlaceholders=this.$renderedPlaceholders||{};var r=this.$renderedPlaceholders[t];if(r)r.set(n);else{var i=this.getTemplate(e);if(i){r=i.createComponents(n)[0];var s=this.getPlaceHolder(t);s&&(s.set({content:r}),this.$renderedPlaceholders[t]=r)}}},_renderId:function(e){e&&this.$el.setAttribute("id",e)}})}),define("js/core/Template",["js/core/Component"],function(e){return e.inherit("js.core.Template",{_initializeDescriptors:function(){this._cleanUpDescriptor(this.$descriptor),this._childrenInitialized()},createComponents:function(e,t,n){n=n||this.$rootScope,t=t||this.$parentScope;for(var r=this._getChildrenFromDescriptor(this.$descriptor,null,n),i=0;i<r.length;i++)r[i].$parentScope=t,r[i].set(e),r[i]._initialize("auto",!0);return r}})}),define("js/ui/ItemsView",["js/ui/View","js/core/Template","js/core/List","underscore"],function(e,t,n,r){return e.inherit({defaults:{tagName:"div",items:null,itemKey:"item",indexKey:"index"},$classAttributes:["itemKey","indexKey"],hasItems:function(){return this.$.items?this.$.items.length:0}.on("items"),render:function(){return this.isRendered()||(this.$renderedItems=[]),this.callBase()},_renderItems:function(e,t){t&&t instanceof n&&(t.unbind("sort",this._onSort,this),t.unbind("reset",this._onReset,this),t.unbind("add",this._onItemAdd,this),t.unbind("remove",this._onItemRemove,this)),e instanceof n?(e.bind("sort",this._onSort,this),e.bind("reset",this._onReset,this),e.bind("add",this._onItemAdd,this),e.bind("remove",this._onItemRemove,this),this._innerRenderItems(e.$items)):r.isArray(e)&&this._innerRenderItems(e)},_onSort:function(e){if(this.isRendered())for(var t,n,r=0;r<e.$.items.length;r++)t=e.$.items[r],n=this.getComponentForItem(t),this.$el.removeChild(n.$el),this.$el.appendChild(n.$el)},_onReset:function(e){this._innerRenderItems(e.$.items)},_onItemAdd:function(e){this._innerRenderItem(e.$.item,e.$.index)},_onItemRemove:function(e){this._removeRenderedItem(e.$.item)},_innerRenderItems:function(e){if(this.$renderedItems)for(var t,n=this.$renderedItems.length-1;n>=0;n--)t=this.$renderedItems[n],this.removeChild(t.component),t.component.destroy();this.$renderedItems=[];for(var r=0;r<e.length;r++)this._innerRenderItem(e[r],r)},_createComponentForItem:function(e,t){var n={};n[this._getItemKey()]=e,n[this._getIndexKey()]=t;var r=this.$templates.item.createComponents(n)[0];return this.$renderedItems.push({item:e,component:r}),r},_innerRenderItem:function(e,t){this.addChild(this._createComponentForItem(e,t))},_getItemKey:function(){return"$"+this.$.itemKey},_getIndexKey:function(){return"$"+this.$.indexKey},_removeRenderedItem:function(e){for(var t,n=0;n<this.$renderedItems.length;n++)if(t=this.$renderedItems[n],t.item===e)return this.removeChild(t.component),this.$renderedItems.splice(n,1),t.component.destroy(),void 0},getComponentForItem:function(e){for(var t,n=0;n<this.$renderedItems.length;n++)if(t=this.$renderedItems[n],t.item===e)return t.component;return null}})}),define("js/core/Injection",["js/core/Component","underscore"],function(e,t){function n(e,t){return e==t||e.prototype instanceof t}return e.inherit("js.core.Injection",{ctor:function(e,t,n){return n.$injection||(this.callBase(),this.$singletonInstanceCache=[],this.$factories=[],n.$injection=this),n.$injection},_initializeChildren:function(){this.callBase()},_childrenInitialized:function(){this.callBase();for(var e=0;e<this.$configurations.length;e++){var t=this.$configurations[e];this.addFactory(t.$)}},getInstance:function(e){var r;if(t.isString(e)){if(this.$singletonInstanceCache.hasOwnProperty(e))return this.$singletonInstanceCache[e]}else{for(var i=0;i<this.$singletonInstanceCache.length;i++)if(r=this.$singletonInstanceCache[i],r instanceof e)return r;for(var s=0;s<this.$factories.length;s++){var o=this.$factories[s];if(n(o.factory,e)&&(r=new o.factory,r instanceof e))return o.singleton&&this.addInstance(r),r}}throw"requested injection type not found"},addChild:function(e){this.callBase(e),this.addInstance(e)},addFactory:function(e){if(e instanceof Function&&(e={factory:e}),t.defaults(e,{type:null,factory:null,singleton:!1}),!e.factory){var n=this.$systemManager.$applicationDomain.getDefinition(e.type);if(!n)throw"factory for type '"+e.type+"' not found";e.factory=n}this.$factories.push(e)},addInstance:function(e,t){if(1==arguments.length&&(t=e,e=null),t instanceof Function)throw"got a factory instead of an instance";e?this.$singletonInstanceCache[e]=t:this.$singletonInstanceCache.push(t)}})}),define("js/ui/ContentPlaceHolder",["js/ui/View"],function(e){return e.inherit({$classAttributes:["name"],_renderContent:function(e){this._clearRenderedChildren(),e&&this._renderChildren(e.getChildren())}})}),define("js/ui/TextWrapper",["js/ui/View"],function(e){var t=function(e){for(var t,n,r=[],i=[],s=0,o=0;o<e.length;o++)n=e.charAt(o),"["==n&&0===i.length?(t={},t.start=o,i.push(o)):"|"==n?s=o:"]"==n&&i.length>0&&s>0&&(t.index=parseInt(e.substring(s+1,o)),t.end=o,t.text=e.substring(t.start+1,s),r.push(t),i.pop());return r};return e.inherit({defaults:{tagName:"span"},_getChildrenFromDescriptor:function(){return[]},_renderChildren:function(){},_renderContentChildren:function(){},_renderString:function(e){for(var n=0;n<this.$el.childNodes.length;n++)this.$el.removeChild(this.$el.childNodes[n]);if(e){for(var r,i=t(e),s=-1,o=0;o<i.length;o++){r=i[o],r.start>s&&this.$el.appendChild(this.$systemManager.$document.createTextNode(e.substring(s+1,r.start))),s=r.end,this.$viewMap||(this.$viewMap={});var a=r.index+":"+o,l=this.$viewMap[a];l||(l=this._createComponentForNode(this.$descriptor.childNodes[r.index]),l&&(l.$parentScope=this.$parentScope,l.$rootScope=this.$rootScope,this.$viewMap[a]=l)),l?(l.set("$text",r.text),l._initialize("auto",!0),l.isRendered()||l.render(),this.$children.push(l),this.$el.appendChild(l.$el)):this.$el.appendChild(this.$systemManager.$document.createTextNode(r.text))}s<e.length&&this.$el.appendChild(this.$systemManager.$document.createTextNode(e.substr(s+1)))}}})}),define("js/data/DataView",["js/core/Component","js/core/List","underscore"],function(e,t){return e.inherit("js.data.DataView",{defaults:{filterFnc:function(){return!0}},initialize:function(){this.$.list=new t,this.bind("baseList","add",this._onItemAdded,this),this.bind("baseList","remove",this._onItemRemoved,this),this.bind("baseList","change",this._onItemChanged,this),this.bind("baseList","reset",this._onReset,this),this.bind("baseList","sort",this._onSort,this),this.$.baseList&&this.$.baseList instanceof t&&this._innerReset(this.$.baseList.$items)},_onItemChanged:function(){},_onReset:function(e){this._innerReset(e.items)},_onSort:function(e){this.$.list.sort(e.sortFnc)},_innerReset:function(){},destroy:function(){this.unbind("baseList","add",this._onItemAdded,this),this.unbind("baseList","remove",this._onItemRemoved,this),this.unbind("baseList","change",this._onItemChanged,this),this.unbind("baseList","reset",this._onReset,this),this.unbind("baseList","sort",this._onSort,this),this.callBase()}})}),define("js/data/FilterDataView",["js/data/DataView"],function(e){return e.inherit("js.data.FilterListView",{initialize:function(){this.callBase(),this.bind("change:filter",this._onFilterChanged,this),this.bind("filterFnc",this._onFilterChanged,this)},_onFilterChanged:function(){this._innerReset(this.$.baseList.$items)},_onItemAdded:function(e){var t=this._filterItem(e.$.item,e.index);t===!0&&this.$.list.add(e.$.item,e.index)},_onItemRemoved:function(e){this.$.list.remove(e.$.item,e.$.index)},_onItemChanged:function(e){var t=this._filterItem(e.$.item,e.$.index),n=_.include(this.$.list.$items,e.$.item);n&&t===!1?this.$.list.remove(e.$.item,e.$.index):!n&&t===!0&&this.$.list.add(e.$.item,e.$.index)},_innerReset:function(e){for(var t,n=[],r=0;r<e.length;r++)t=e[r],this._filterItem(t,r)===!0&&n.push(t);this.$.list.reset(n)},_filterItem:function(e,t){return this.$.filterFnc?this.$.filterFnc.call(this,e,t,this.$.list):!0}})}),define("js/data/Collection",["require","js/core/List","js/data/Model","flow","underscore"],function(e,t,n,r,i){var s=0,o={CREATED:0,LOADING:1,LOADED:2,ERROR:-1},a=t.inherit("js.data.Collection",{$modelFactory:n,ctor:function(t,n){n=n||{},this.callBase(t),this.$cid=++s,i.defaults(n,{rootCollection:null,pageSize:null,queryParameters:{},factory:this.$modelFactory||e("js/data/Model"),type:null}),this.$itemsCount=null,this.$queryCollectionsCache={},this.$pageCache=[],this.$options=n},getRootCollection:function(){return this.$options.rootCollection?this.$options.rootCollection:this},createQueryCacheKey:function(e){e=e||{};var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return t.sort(),0==t.length?"root":t.join("&")},createQueryCollection:function(e){var t={queryParameter:e,rootCollection:this.getRootCollection()};return i.defaults(t,this.$options),new a(null,t)},fetch:function(e,t){function n(n){function s(t){o.push(function(n){i.fetchPage(t,e,n)})}for(var o=[],a=0;n>a;a++)s(a);r().par(o).exec(function(e){t&&t(e,i)})}e=e||{};var i=this;if(this.$options.pageSize){var s=this.pageCount();isNaN(s)?this.fetchPage(0,e,function(e){e?t&&t(e,i):(s=i.pageCount(),isNaN(s)?t&&t("Count for collection couldn't be fetched.",i):n(s))}):n(s)}else this.fetchPage(0,e,t)},pageCount:function(){return this.$itemsCount?Math.ceil(this.$itemsCount/this.$options.pageSize):0/0},getContextForChildren:function(e){return e.prototype.$cacheInRootContext?this.$context.$datasource.getContext():this.$context
},parse:function(e,t){if(e instanceof Array){for(var n=this.$modelFactory,r=n===this.$context.$datasource.$entityFactory||n===this.$context.$datasource.$modelFactory?t:this.$alias,i=0;i<e.length;i++){var s=e[i],o=this.getContextForChildren(n).createEntity(n,s.id,r,t);o.set(o.parse(s)),e[i]=o}return e}throw"data has to be an array"},createItem:function(e,t){return this.getContextForChildren(this.$modelFactory).createEntity(this.$modelFactory,e,t)},fetchPage:function(e,t,n){if(0>e)throw"pageIndex must be >= 0";var r=this.$pageCache[e];r||(r=this.$pageCache[e]=new l(null,this.getRootCollection(),e));var i=this;r.fetch(t,function(r,s){!r&&!s.itemsInsertedIntoCollection&&(s.itemsInsertedIntoCollection=!0,i.add(s.$items,{index:(e||0)*i.$options.pageSize})),n&&n(r,s,t)})},find:function(e){var t=this.createQueryCacheKey(e);return this.$queryCollectionsCache.hasOwnProperty(t)||(this.$queryCollectionsCache[t]=this.createQueryCollection(e)),this.$queryCollectionsCache[t]}}),l=a.Page=t.inherit({ctor:function(e,t,n){if(!t.$options.pageSize&&0!==n)throw"Cannot create page for index '"+n+"' with pageSize '"+t.options.pageSize+"'";var r=t.$options;r.pageSize&&(this.$offset=n*r.pageSize,this.$limit=r.pageSize),this.$pageIndex=n,this.$collection=t,this.callBase(e),this._fetch={callbacks:[],state:o.CREATED}},parse:function(e,t){return this.$collection.parse.call(this.$collection,e,t)},fetch:function(e,t){function n(t,n,i){var s=function(t,n){i&&i(t,n,e)};e.fetchModels||e.fetchSubModels?r().parEach(n.$items,function(t,n){t.fetch({fetchSubModels:e.fetchSubModels},n)}).exec(function(e){s(e,n)}):s(t,n)}e=e||{};var s=this;this._fetch.state===o.LOADING?this._fetch.callbacks.push(function(e,r){n(e,r,t)}):this._fetch.state==o.LOADED?n(null,this,t):(s._fetch.state=o.LOADING,this.$collection.$context.$datasource.loadCollectionPage(this,e,function(e,r){s._fetch.state=e?o.ERROR:o.LOADED,n(e,r,t),i.each(s._fetch.callbacks,function(t){t(e,r)})}))}});return a.of=function(t){if(t instanceof Function)return a.inherit(a.prototype.constructor.name+"["+t.prototype.constructor.name+"]",{$modelFactory:t});if(i.isString(t))return a.inherit(a.prototype.constructor.name+"["+t+"]",{$alias:t,$modelFactory:n||e("js/data/Model")});throw"Cannot create Collection of '"+t+"'."},a}),define("js/data/DataSource",["require","js/core/Component","js/core/Base","js/data/Collection","underscore","js/data/Model","js/data/Entity","js/core/List","flow","JSON"],function(e,t,n,r,i,s,o,a,l,c){var u,h=n.inherit("js.data.DataSource.Context",{defaults:{collectionPageSize:null},ctor:function(e,t,n){this.callBase(),this.$datasource=e,this.$properties=t,this.$parent=n,this.$cache={}},addEntityToCache:function(e){this.$cache[h.generateCacheIdFromEntity(e)]=e},addCollectionToCache:function(e){this.$cache[h.generateCacheIdFromCollection(e)]=e},getInstanceByCacheId:function(e){return this.$cache[e]},getPathComponents:function(){return[]},createEntity:function(e,t,n){if(i.isFunction(e)){var r=e.prototype.constructor.name;if(n=n||(e.classof(s)?this.$datasource.getAliasForModelClassName(r):r),e.classof(s)&&!n)throw"Alias for '"+r+"' not found";var o;return t&&(o=this.getInstanceByCacheId(h.generateCacheIdForEntity(n,t))),o||(o=new e({id:t}),o.$context=this,o.$alias=n,this.addEntityToCache(o)),o}throw"Factory has to be a function"},createCollection:function(e,t,n){if(t=t||{},i.isFunction(e)){var r=e.prototype.constructor.name;if(n=n||this.$datasource.getAliasForCollectionClassName(r),!n)throw"Alias for '"+r+"' not found";i.defaults(t,{factory:e,type:n});var s=this.getInstanceByCacheId(h.generateCacheIdForCollection(n));return s||(s=new e(null,t),s.$context=this,s.$alias=n,this.addCollectionToCache(s)),s}throw"Factory has to be a function"}});h.generateCacheIdForCollection=function(e){return e},h.generateCacheIdForEntity=function(e,t){return e+"_"+t},h.generateCacheIdFromEntity=function(e){return h.generateCacheIdForEntity(e.$alias,e.$.id)},h.generateCacheIdFromCollection=function(e){return h.generateCacheIdForCollection(e.$alias)};var f=n.inherit("js.data.DataSource.Processor",{ctor:function(e){if(!e)throw"dataSource is required for Processor";this.$datasource=e},compose:function(e,t,n){return this._composeObject(e,t,n)},_composeObject:function(e,t,n){var r={};for(var i in e)if(e.hasOwnProperty(i)){var s=this._getCompositionValue(e[i],t,n);s!==u&&(r[i]=s)}return r},_getCompositionValue:function(e,t,n){if(e instanceof s)return this._composeSubModel(e,t,n);if(e instanceof r)return this._composeCollection(e,t,n);if(e instanceof o)return e.compose(t,n);if(e instanceof a){var i=[],l=this;return e.each(function(e){i.push(l._getCompositionValue(e,t,n))}),i}return e instanceof Object?this._composeObject(e):e},_composeSubModel:function(e,t,n){return e.compose(t,n)},_composeCollection:function(){return u},parse:function(e){return e},saveSubModels:function(e,t,n){n()},getSubModelsForModel:function(e){function t(r){if(r!==e&&-1===i.indexOf(n,r)){if(r instanceof s)return n.push(r),void 0;for(var o in r)if(r.hasOwnProperty(o)){var l=r[o];if(l instanceof Array)for(var c=0;c<l.length;c++)t(l[c]);else l instanceof a?l.each(function(e){t(e)}):l instanceof Object&&t(l)}}}var n=[];return t(e.$),n}}),d=t.inherit("js.data.DataSource",{ctor:function(){this.$configuredTypes=[],this.$contextCache={},this.$formatProcessors=[],this.callBase(),this.initializeFormatProcessors(),this.initializeProcessors()},$processors:{},$modelFactory:s,$entityFactory:o,$collectionFactory:r,$defaultProcessorFactory:f,$defaultProcessor:null,initializeFormatProcessors:function(){},initializeProcessors:function(){this.$defaultProcessor=new this.$defaultProcessorFactory(this);for(var e in this.$processors)this.$processors.hasOwnProperty(e)&&this.$processors[e]instanceof Function&&(this.$processors[e]=new this.$processors[e](this))},_childrenInitialized:function(){this.callBase();for(var e=0;e<this.$configurations.length;e++){var t=this.$configurations[e];this.addTypeConfiguration(t)}},getAliasForModelClassName:function(e){for(var t=0;t<this.$configuredTypes.length;t++){var n=this.$configuredTypes[t];if(n.$.modelClassName===e)return n.$.alias}return null},getAliasForCollectionClassName:function(e){for(var t=0;t<this.$configuredTypes.length;t++){var n=this.$configuredTypes[t];if(n.$.collectionClassName===e)return n.$.alias}return null},addTypeConfiguration:function(e){if(!e.$.modelClassName&&!e.$.alias)throw"neither modelClassName nor alias defined";e.$.modelClassName&&!e.$.alias&&(e.$.alias=e.$.modelClassName.split(".").pop()),e.$.modelClassName||(e.$.modelClassName="js.data.Model"),this.$configuredTypes.push(e)},getFqClassName:function(e){for(var t=0;t<this.$configuredTypes.length;t++){var n=this.$configuredTypes[t];if(n.$.alias==e)return n.$.modelClassName}},getContext:function(e,t){var n=this.createContextCacheId(e,t?t.$properties:null);return this.$contextCache.hasOwnProperty(n)||(this.$contextCache[n]=this.createContext(e,t)),this.$contextCache[n]},root:function(){return this.getContext()},createContext:function(e,t){return new h(this,e,t)},createContextCacheId:function(e,t){var n=[];return i.each(i.extend({},t,e),function(e,t){n.push(t+"="+e)}),n.sort(),0==n.length?"root":n.join("&")},createEntity:function(e,t,n,r){return r=r||this.getContext(),r.createEntity(e,t,n)},createCollection:function(e,t,n,r){return r=r||this.getContext(),r.createCollection(e,t,n)},resolveReferences:function(e,t,n,r){r&&r("Abstract method",t)},loadModel:function(e,t,n){n&&n("Abstract method",e)},loadCollectionPage:function(e,t,n){n&&n("Abstact method loadCollectionPage",e)},saveModel:function(e,t,n){n&&n("Abstract method saveModel",e)},removeModel:function(e,t,n){n&&n("Abstract method removeModel",e)},getConfigurationForModelClass:function(e){for(var t=0;t<this.$configuredTypes.length;t++){var n=this.$configuredTypes[t];if(n.$.modelClassName===e)return n}return null},getConfigurationByAlias:function(e){for(var t=0;t<this.$configuredTypes.length;t++){var n=this.$configuredTypes[t];if(n.$.alias===e)return n}return null},getProcessorForModel:function(e){if(e){var t;if(t=e.constructor===this.$modelFactory?this.getConfigurationByAlias(e.$alias):this.getConfigurationForModelClass(e.$modelClassName),t&&t.$.processor){var n=t.$.processor;if(this.$processors[n])return this.$processors[n];throw"Processor for '"+n+"' not an instance of js.data.DataSource.Processor."}}return this.$defaultProcessor},getFormatProcessor:function(){return this.$formatProcessors[0]},update:function(){},find:function(){}});return d.FormatProcessor=n.inherit("js.data.DataSource.FormatProcessor",{serialize:function(){throw"abstract method"},deserialize:function(){throw"abstract method"}}),d.JsonFormatProcessor=d.FormatProcessor.inherit("js.data.DataSource.JsonFormatProcessor",{serialize:function(e){return c.stringify(e)},deserialize:function(e){return c.parse(e)}}),d.Context=h,d.Processor=f,d.ACTION={LOAD:"load",CREATE:"create",UPDATE:"update",DELETE:"delete"},d.IdGenerator={genId:function(e,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t).toUpperCase()}}(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})},d}),define("js/data/LocalStorageDataSource",["js/data/DataSource","js/data/Model","flow"],function(e,t,n){var r=new e.JsonFormatProcessor;return e.inherit("js.data.LocalStorageDataSource",{defaults:{name:"default"},ctor:function(){if(this.callBase(),this.$storage=this._getStorage(),!this.$storage)throw"Storage not available";var e=this.$storage.getItem(this.$.name);this.$data=e&&this.getFormatProcessor(null).deserialize(e)||{}},getFormatProcessor:function(){return r},getPathComponentsForModel:function(e){if(e){var t=this.getConfigurationByAlias(e.$alias);if(t)return[t.$.path]}return null},getPathForAlias:function(e){var t,n;for(n=0;n<this.$configuredTypes.length;n++)if(t=this.$configuredTypes[n],t.$.alias==e)return t.$.path;return null},_getStorage:function(){return"undefined"!=typeof window&&window.localStorage?window.localStorage:null},_getCollectionData:function(e,t){if(!e)return callback("path for model unknown",null,options),void 0;var n=[];return t&&(n=n.concat(t)),n=n.concat(e),this.$data[n.join(":")]||{}},loadCollectionPage:function(e,t,n){n=n||function(){};var r=e.$collection.$options.path?e.$collection.$options.path:this.getPathForAlias(e.$collection.$alias),i=e.$collection.$context.getPathComponents(),s=[],o=this._getCollectionData(r,i);for(var a in o)o.hasOwnProperty(a)&&s.push(this.$data[a]);s=e.parse(s),e.add(s),n(null,e,t)},saveModel:function(r,i,s){s=s||function(){};var o=e.ACTION.UPDATE;r._status()===t.STATE.NEW&&(o=e.ACTION.CREATE);var a=this.getProcessorForModel(r,i),l=(this.getFormatProcessor(o),this);n().seq(function(e){a.saveSubModels(r,i,e)}).seq(function(n){var s=r.compose(o,i);if(r._status()===t.STATE.NEW&&(s.id=e.IdGenerator.genId()),l.$data[s.id]=s,o===e.ACTION.CREATE){var a=l.getPathComponentsForModel(r);if(!a)return n("path for model unknown"),void 0;var c=[];c=c.concat(r.$context.getPathComponents()),c=c.concat(a);var u=l.$data[c.join(":")]||{};u[s.id]=!0,l.$data[c.join(":")]=u}l._saveStorage(),r.set("id",s.id),n()}).exec(function(e){s(e,r,i)})},loadModel:function(t,n,r){r=r||function(){};var i;return this.getFormatProcessor(e.ACTION.LOAD),t.$.id?(i=this.$data[t.$.id])?(i=t.parse(i),t.set(i),r(null,t,n),void 0):(r("Could not find model"),void 0):(r("Model has no id"),void 0)},removeModel:function(e,t,n){if(n=n||function(){},!e.$.id)return n("Model has no id"),void 0;delete this.$data[e.$.id];var r=this._getCollectionData(this.getPathComponentsForModel(e));r&&delete r[e.$.id],this._saveStorage(),n(null,e,t)},_saveStorage:function(){this.$storage.setItem(this.$.name,this.getFormatProcessor(null).serialize(this.$data))}})}),define("js/html/a",["js/html/HtmlElement"],function(e){var t=/^(([^:]+:\/\/)|(javascript:))/i,n=/^#/,r=/^#?(.*)$/;return e.inherit("js.html.a",{defaults:{tagName:"a",target:null,href:null},_renderHref:function(e){e=e||"javascript:void(0);","external"!==this.$.target&&!t.test(e)&&"_blank"!==this.$.target&&(n.test(e)||(e="#"+e),this.runsInBrowser()||(e=e.replace(r,"#!$1"))),this.$el.setAttribute("href",e)},_renderTarget:function(e){e&&"external"!==e&&this.$el.setAttribute("target",e)}})}),function(e,t,n,r,i){function s(e){function t(){}return t.prototype=e,new t}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var o;Function.prototype.async=function(){return this._async=!0,this};var a=/^(xaml!)?(.+?)(\.xml)?$/,l=function(e,t){this.$from=e,this.$to=t},c={"http://www.w3.org/1999/xhtml":"js.html","http://www.w3.org/2000/svg":"js.svg"},u=[new l(/^js\/html\/(a)$/,"js/html/a"),new l(/^js\/html\/(input)$/,"js/html/Input"),new l(/^js\/html\/(select)$/,"js/html/Select"),new l(/^js\/html\/(textarea)$/,"js/html/TextArea"),new l(/^js\/html\/(option)$/,"js/html/Option"),new l(/^js\/html\/(.+)$/,"js/html/HtmlElement"),new l(/^js\/svg\/svg$/,"js/svg/Svg"),new l(/^js\/svg\/(.+)$/,"js/svg/SvgElement")];"undefined"!=typeof JSON?n("JSON",[],function(){return JSON}):t.config({paths:{JSON:"js/lib/json2"},shim:{JSON:{exports:"JSON"}}}),t.config({paths:{json:"js/plugins/json"}});var h={createApplicationContext:function(e,r,i){r=r||{};var s=function(r){r.xamlClasses=r.xamlClasses||[],r.namespaceMap=r.namespaceMap||c,r.rewriteMap=r.rewriteMap||u;var s=t.config(r),l=new v(s,r);n("rAppid",function(){return l}),"undefined"!=typeof JSON&&n("JSON",function(){return JSON}),s(["inherit","underscore"],function(t,n){if(o=n,t&&n)if(e){var r=a.exec(e);e=r?"xaml!"+r[2]:e.replace(/\./g,"/"),s([e],function(e){l.$applicationFactory=e,i(null,l)},function(e){i(e)})}else i(null,l);else i("inherit or underscore missing")})};"[object String]"==Object.prototype.toString.call(r)?t(["json!"+r],function(e){s(e)}):s(r)},bootStrap:function(e,t,n){h.createApplicationContext(e,t,function(e,t){e||!r?n(e||"target document missing"):t.createApplicationInstance(r,n)})},rewriteMapEntry:l,createQueryString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},ajax:function(e,t,n){var r={url:e};if(o.extend(r,h.ajaxSettings,t),r.data&&!o.isString(r.data))throw"data must be a string";r.hasContent=!/^(?:GET|HEAD)$/.test(r.type),r.queryParameter&&o.keys(r.queryParameter).length>0&&(r.url+=/\?/.test(r.url)?"&":"?"+this.createQueryString(r.queryParameter));var i=r.xhr();i.open(r.type,r.url,r.async),r.hasContent&&r.contentType!==!1&&(i.setRequestHeader("Content-Type",r.contentType),i.setRequestHeader("Content-Length",r.data?r.data.length.toString():"0"));try{for(var s in r.headers)r.headers.hasOwnProperty(s)&&i.setRequestHeader(s,r.headers[s])}catch(a){}i.send(r.data);var l=function(e,t){var r;l&&(t||4===i.readyState)&&(l=void 0,t?4!==i.readyState&&i.abort():r=new d(i),n&&n(t,r))};return r.async&&4!==i.readyState?i.onreadystatechange=l:l(),i}},f=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,d=function(e){this.xhr=e,this.status=e.status,this.$nativeResponseHeaders=e.getAllResponseHeaders(),this.responses={};var t=e.responseXML;t&&t.documentElement&&(this.responses.xml=t),this.responses.text=e.responseText;try{this.statusText=e.statusText}catch(n){this.statusText=""}};d.prototype.getResponseHeader=function(e){var t;if(!this.$responseHeaders)for(this.$responseHeaders={};t=f.exec(this.$nativeResponseHeaders);)this.$responseHeaders[t[1].toLowerCase()]=t[2];return this.$responseHeaders[e.toLowerCase()]},h.ajaxSettings={type:"GET",contentType:"application/x-www-form-urlencoded",async:!0,xhr:function(){return new i},headers:{},data:null};var p=function(e,t,n){this.$requirejsContext=e,this.$applicationContext=t,this.$applicationFactory=null,this.$document=n},v=function(e,t){p.call(this,e),this.$config=t,this.$applicationContext=this};v.prototype=s(p.prototype),v.prototype.constructor=v,v.prototype.createApplicationInstance=function(e,t){var n=this.$applicationFactory,r=new p(this.$requirejsContext,this,e);this.$requirejsContext(["js/core/Application"],function(e){var i=new n(null,!1,r,null,null);if(i instanceof e)r.$application=i,i._initialize("auto"),t&&t(null,r,i);else{var s="mainClass isn't an instance of js.core.Application";if(!t)throw s;t(s)}})},v.prototype.getFqClassName=function(e,t,n){if((void 0==n||null==n)&&(n=!0),e&&t){e=(this.$config.namespaceMap[e]||e).replace(/\./g,"/");var r=[e,t].join("/")}else r=(e||t).replace(/\./g,"/");if(-1!==o.indexOf(this.$config.xamlClasses,r)&&(r="xaml!"+r),n)for(var i=0;i<this.$config.rewriteMap.length;i++){var s=this.$config.rewriteMap[i];if(s instanceof h.rewriteMapEntry&&s.$from.test(r))return r.replace(s.$from,s.$to)}return r},v.prototype.createInstance=function(e,t,n){function r(e,t){function n(){return e.apply(this,t)}return n.prototype=e.prototype,new n}t=t||[];var i;e instanceof Function?(i=e,e=i.prototype.constructor.name):(e=e.replace(/\./g,"/"),i=this.$requirejsContext(e)),n=n||e;var s;try{s=r(i,t),s.className=n}catch(o){}return s},v.prototype.ajax=function(e,t,n){!/^http.*$/.test(e)&&this.$config.applicationUrl&&(e=this.$config.applicationUrl+"/"+e),h.ajax(e,t,n)},h.defaultNamespaceMap=c,h.defaultRewriteMap=u,h.SystemManager=p,h.ApplicationContext=v,h.Rewrite=l,e.rAppid=h}("undefined"!=typeof exports?exports:window,"undefined"!=typeof requirejs?requirejs:require("requirejs"),"undefined"!=typeof requirejs?define:require("requirejs").define,"undefined"!=typeof window?window.document:null,"undefined"!=typeof window?window.XMLHttpRequest:require("xmlhttprequest").XMLHttpRequest),define("js/lib/rAppid",function(){}),define("xaml",[],function(){function e(e){return/\S/.test(e)}function t(e,t,n,r,i){n=n||{},i=i||{},r=r||[],e=(n[e]||e).replace(/\./g,"/");for(var s=[e,t].join("/"),o=0;o<i.length;o++){var a=i[o];if(a.$from&&a.$to&&a.$from.test(s)){s=s.replace(a.$from,a.$to);break}}return-1!==r.indexOf(s)&&(s="xaml!"+s),s.replace(/\./g,"/")}function n(e){var t=e.textContent||e.text||e.data;if(!t){t="";for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];(1==r.nodeType||4==r.nodeType)&&(t+=this._getTextContentFromDescriptor(r))}}return t}function r(e,r,i,s,o){function a(e){var c=f(e),u=t(e.namespaceURI,c,r,i,s);if("js/core/Imports"==u)for(var d=0;d<e.childNodes.length;d++){var p=e.childNodes[d];if(3==p.nodeType)for(var v,m=n(p);null!=(v=h.exec(m+" "));){var g=v[0].replace(/\./g,"/");"undefined"!==g&&(-1==l.indexOf(g)&&l.push(g),o&&o.push(g))}}-1==l.indexOf(u)&&l.push(u);for(var $=0;$<e.childNodes.length;$++){var y=e.childNodes[$];1==y.nodeType&&a(y)}}var l=[];return e&&a(e),l}function i(e,n,r,i){for(var s=[],o=0;o<e.childNodes.length;o++){var a=e.childNodes[o];1==a.nodeType&&"js/core/Script"==t(a.namespaceURI,f(a),n,r,i)&&s.push(a)}return s}function s(e){var t={};if(e)for(var n=0;n<e.length;n++){var r=e[n];for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}var o,a,l=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],c=function(){throw new Error("Environment unsupported.")},u={},h=/((?:xaml!)?[a-z]+(\.[a-z]+[a-z0-9]*)*)/gim;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1});var f=function(e){if(e.localName)return e.localName;var t=e.tagName.split(":");return t[t.length-1]};return"undefined"!=typeof window&&window.navigator&&window.document||"undefined"!=typeof importScripts?(a=function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(t=0;3>t;t++){n=l[t];try{e=new ActiveXObject(n)}catch(r){}if(e){l=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},c=function(e,t){var n;try{n=a(),n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&(n.responseXML?t(null,n.responseXML):t("no responseXML found"))},n.send(null)}catch(r){t(r)}}):"undefined"!=typeof process&&process.versions&&!!process.versions.node&&(o=require.nodeRequire("fs"),c=function(e,t){try{var n=o.readFileSync(e,"utf8");t(null,require.nodeRequire("libxml").parseFromString(n))}catch(r){t(r)}}),{write:function(e,t,n){if(t in u){var r=u[t];n.asModule(e+"!"+t,r)}},version:"0.2.0",load:function(t,n,o,a){var l=n.toUrl(t+".xml");c(l,function(c,h){if(!c&&h){var f=[],d=1,p=r(h.documentElement,a.namespaceMap,a.xamlClasses,a.rewriteMap,f),v=i(h.documentElement,a.namespaceMap,a.xamlClasses,a.rewriteMap);if(v.length>1)throw"only one script block allowed in XAML";if(v.length>0&&(p.splice(1,0,"js/core/Script"),d++),f.length>0&&(p=p.slice(0,d).concat(f).concat(p.slice(d))),a.isBuild){p.splice(1,0,"js/core/Element"),d++;for(var m="(function () {define(%dependencies%, %function%)}).call(this);",g="function(baseClass, ELEMENT %parameter%){return baseClass.inherit({ %classDefinition% _$descriptor: ELEMENT.xmlStringToDom(%descriptor%)})}",$=0;$<p.length;$++)p[$]="'"+p[$]+"'";m=m.replace("%dependencies%","["+p.join(",")+"]");var y=h.documentElement.toString().replace(/((\r\n|\n|\r)[\s\t]*)/gm,"").replace(/'/g,"\\'").replace(/<js:Script[^>]*>[\s\S]*<\/js:Script[^>]*>/,""),b="",x="";if(v.length>0){var C=v[0].toString(),_=/^[\s\S]*?function\s*\(([\s\S]*?)\)[\s\S]*?\{[\s\S]*?return[\s\S]*?\{([\s\S]*)\}[\s\S]*?\}[\s\S]*?\)[^)]*$/,w=_.exec(C);if(!w)throw"Error parsing script block";e(w[1])&&(b=",SCRIPT,"+w[1]),e(w[2])&&(x=w[2]+",")}g=g.replace("%parameter%",b),g=g.replace("%classDefinition%",x),g=g.replace("%descriptor%","'"+y+"'"),m=m.replace("%function%",g),o.fromText(t,m),u[t]=m,n([t],function(e){o(e)})}else n(p,function(){var e=arguments[0],n=arguments[1],r=Array.prototype.slice.call(arguments),i=[],a=r.slice(d);if(v.length>0)for(var l=0;l<v.length;l++)try{var c=new n(null,v[l]);i.push(c.evaluate(a))}catch(u){o.error(new Error(t+": Script cannot be loaded"+u))}var f=e.inherit(s(i));f.prototype._$descriptor=h.documentElement,o(f)},function(e){o.error(e)})}else o.error(new Error("XML "+l+" not found."+c))})}}}),define("json",["JSON"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=function(){throw new Error("Environment unsupported.")},s={},o=/^(.+)\.json$/i;return"undefined"!=typeof window&&window.navigator&&window.document||"undefined"!=typeof importScripts?(n=function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(t=0;3>t;t++){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},i=function(e,t){var r;try{r=n(),r.open("GET",e,!0),r.onreadystatechange=function(){4===r.readyState&&(r.responseText?t(null,r.responseText):t("no responseXML found"))},r.send(null)}catch(i){t(i)}}):"undefined"!=typeof process&&process.versions&&!!process.versions.node&&(t=require.nodeRequire("fs"),i=function(e,n){try{var r=t.readFileSync(e,"utf8");n(null,r)}catch(i){n(i)}}),{write:function(e,t,n){if(t in s){var r=s[t];n.asModule(e+"!"+t,r)}},version:"0.1.0",load:function(t,n,r){t=t.replace(o,"$1"),t+=".json";var s=n.toUrl(t);i(s,function(t,n){t?r.error(new Error("Json for "+s+" not found")):r(e.parse(n))})}}}),rAppid.bootStrap("app/Todo.xml","config.json",function(e,t,n){e||n.start(null,function(){n.render(document.body)})});