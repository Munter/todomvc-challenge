!function(){"use strict";function t(){"tastejs.github.io"===location.hostname&&(location.href=location.href.replace("tastejs.github.io/todomvc","todomvc.com"))}function e(){var t;return[/labs/,/\w*-examples/].forEach(function(e){var n=location.href.match(e);!t&&n&&(t=location.href.indexOf(n))}),location.href.substr(0,t)}function n(t,n){if(!location.host)return console.info("Miss the info bar? Run TodoMVC from a server to avoid a cross-origin error.");var r=new XMLHttpRequest;r.open("GET",e()+t,!0),r.send(),r.onload=function(){200===r.status&&n&&n(r.responseText)}}function r(t,e){if(!(this instanceof r))return new r(t,e);var n,i;if("object"!=typeof t)try{t=JSON.parse(t)}catch(o){return}e&&(n=e.template,i=e.framework),!n&&t.templates&&(n=t.templates.todomvc),!i&&document.querySelector("[data-framework]")&&(i=document.querySelector("[data-framework]").getAttribute("data-framework")),n&&t[i]&&(this.frameworkJSON=t[i],this.template=n,this.append())}var i=function(t){t.defaults=function(t){if(!t)return t;for(var e=1,n=arguments.length;n>e;e++){var r=arguments[e];if(r)for(var i in r)null==t[i]&&(t[i]=r[i])}return t},t.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var e=/(.)^/,n={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},r=/\\|'|\r|\n|\t|\u2028|\u2029/g;return t.template=function(i,o,a){var s;a=t.defaults({},a,t.templateSettings);var u=new RegExp([(a.escape||e).source,(a.interpolate||e).source,(a.evaluate||e).source].join("|")+"|$","g"),c=0,l="__p+='";i.replace(u,function(t,e,o,a,s){return l+=i.slice(c,s).replace(r,function(t){return"\\"+n[t]}),e&&(l+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'"),o&&(l+="'+\n((__t=("+o+"))==null?'':__t)+\n'"),a&&(l+="';\n"+a+"\n__p+='"),c=s+t.length,t}),l+="';\n",a.variable||(l="with(obj||{}){\n"+l+"}\n"),l="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+l+"return __p;\n";try{s=new Function(a.variable||"obj","_",l)}catch(f){throw f.source=l,f}if(o)return s(o,t);var p=function(e){return s.call(this,e,t)};return p.source="function("+(a.variable||"obj")+"){\n"+l+"}",p},t}({});"todomvc.com"===location.hostname&&(window._gaq=[["_setAccount","UA-31081062-1"],["_trackPageview"]],function(t,e){var n=t.createElement(e),r=t.getElementsByTagName(e)[0];n.src="//www.google-analytics.com/ga.js",r.parentNode.insertBefore(n,r)}(document,"script")),r.prototype.append=function(){var t=document.createElement("aside");t.innerHTML=i.template(this.template,this.frameworkJSON),t.className="learn";var n=t.querySelectorAll(".demo-link");Array.prototype.forEach.call(n,function(t){t.setAttribute("href",e()+t.getAttribute("href"))}),document.body.className=(document.body.className+" learn-bar").trim(),document.body.insertAdjacentHTML("afterBegin",t.outerHTML)},t(),n("learn.json",r)}(),function(){var t,e=[].slice;t=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],function(t,e,n){n.prototype=t.prototype;var r=new n,i=t.apply(r,e),o=typeof i;return"object"==o||"function"==o?i||r:r}(t.Object,n,function(){})},t.version="0.14.1",t.config={pathPrefix:"/",viewPrefix:"views",fetchRemoteViews:!0,usePushState:!1,minificationErrors:!0},(t.container=function(){return this}()).Batman=t,"function"==typeof define&&define("batman",[],function(){return t}),t.exportHelpers=function(e){var n,r,i,o;for(o=["mixin","extend","unmixin","redirect","typeOf","redirect","setImmediate","clearImmediate"],r=0,i=o.length;i>r;r++)n=o[r],e["$"+n]=t[n];return e},t.exportGlobals=function(){return t.exportHelpers(t.container)}}.call(this),function(){var t;Batman._Batman=t=function(){function t(t){this.object=t}return t.prototype.check=function(t){return t!==this.object?(t._batman=new Batman._Batman(t),!1):!0},t.prototype.get=function(t){var e,n;switch(n=this.getAll(t),n.length){case 0:return void 0;case 1:return n[0];default:return e=null!=n[0].concat?function(t,e){return t.concat(e)}:null!=n[0].merge?function(t,e){return t.merge(e)}:n.every(function(t){return"object"==typeof t})?(n.unshift({}),function(t,e){return Batman.extend(t,e)}):void 0,e?n.reduceRight(e):n}},t.prototype.getFirst=function(t){var e;return e=this.getAll(t),e[0]},t.prototype.getAll=function(t){var e,n,r;return e="function"==typeof t?t:function(e){var n;return null!=(n=e._batman)?n[t]:void 0},n=this.ancestors(e),(r=e(this.object))&&n.unshift(r),n},t.prototype.ancestors=function(t){var e,n,r,i,o,a;if(this._allAncestors||(this._allAncestors=this.allAncestors()),t){for(n=[],a=this._allAncestors,i=0,o=a.length;o>i;i++)e=a[i],r=t(e),null!=r&&n.push(r);return n}return this._allAncestors},t.prototype.allAncestors=function(){var t,e,n,r,i,o;return r=[],t=!!this.object.prototype,e=t?null!=(i=this.object.__super__)?i.constructor:void 0:(n=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:n,null!=e&&(null!=(o=e._batman)&&o.check(e),r.push(e),null!=e._batman&&(r=r.concat(e._batman.allAncestors()))),r},t.prototype.set=function(t,e){return this[t]=e},t}()}.call(this),function(){var t,e,n,r,i,o,a,s,u=[].slice,c={}.hasOwnProperty,l=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.typeOf=function(t){return"undefined"==typeof t?"Undefined":o.call(t).slice(8,-1)},o=Object.prototype.toString,Batman.extend=function(){var t,e,n,r,i,o,a;for(r=arguments[0],n=2<=arguments.length?u.call(arguments,1):[],o=0,a=n.length;a>o;o++){e=n[o];for(t in e)i=e[t],r[t]=i}return r},Batman.mixin=function(){var t,e,n,r,i,o,a,s;for(i=arguments[0],r=2<=arguments.length?u.call(arguments,1):[],t="function"==typeof i.set,a=0,s=r.length;s>a;a++)if(n=r[a],"Object"===Batman.typeOf(n)){for(e in n)c.call(n,e)&&(o=n[e],"initialize"!==e&&"uninitialize"!==e&&"prototype"!==e&&(t?i.set(e,o):null!=i.nodeName?Batman.data(i,e,o):i[e]=o));"function"==typeof n.initialize&&n.initialize.call(i)}return i},Batman.unmixin=function(){var t,e,n,r,i,o;for(t=arguments[0],r=2<=arguments.length?u.call(arguments,1):[],i=0,o=r.length;o>i;i++){n=r[i];for(e in n)"initialize"!==e&&"uninitialize"!==e&&delete t[e];"function"==typeof n.uninitialize&&n.uninitialize.call(t)}return t},Batman._functionName=Batman.functionName=function(t){var e;return t.__name__?t.__name__:t.name?t.name:null!=(e=t.toString().match(/\W*function\s+([\w\$]+)\(/))?e[1]:void 0},Batman._isChildOf=Batman.isChildOf=function(t,e){var n;for(n=e.parentNode;n;){if(n===t)return!0;n=n.parentNode}return!1},i=function(t){var e,n,r,i,o,a,s;return e=function(){var e,n;return t.postMessage?(e=!0,n=t.onmessage,t.onmessage=function(){return e=!1},t.postMessage("","*"),t.onmessage=n,e):!1},s=new Batman.SimpleHash,n=0,i=function(){return"go"+ ++n},t.setImmediate&&t.clearImmediate?(Batman.setImmediate=t.setImmediate,Batman.clearImmediate=t.clearImmediate):e()?(a="com.batman.",r=new Batman.SimpleHash,o=function(t){var e,n;if(~t.data.search(a))return e=t.data.substring(a.length),"function"==typeof(n=s.unset(e))?n():void 0},t.addEventListener?t.addEventListener("message",o,!1):t.attachEvent("onmessage",o),Batman.setImmediate=function(e){var n;return s.set(n=i(),e),t.postMessage(a+n,"*"),n},Batman.clearImmediate=function(t){return s.unset(t)}):"undefined"!=typeof document&&l.call(document.createElement("script"),"onreadystatechange")>=0?(Batman.setImmediate=function(){var t,e;return t=i(),e=document.createElement("script"),e.onreadystatechange=function(){var n;return"function"==typeof(n=s.get(t))&&n(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},document.documentElement.appendChild(e),t},Batman.clearImmediate=function(t){return s.unset(t)}):("undefined"!=typeof process&&null!==process?process.nextTick:void 0)?(r={},Batman.setImmediate=function(t){var e;return e=i(),r[e]=t,process.nextTick(function(){return"function"==typeof r[e]&&r[e](),delete r[e]}),e},Batman.clearImmediate=function(t){return delete r[t]}):(Batman.setImmediate=function(t){return setTimeout(t,0)},Batman.clearImmediate=function(t){return clearTimeout(t)})},Batman.setImmediate=function(){return i(Batman.container),Batman.setImmediate.apply(this,arguments)},Batman.clearImmediate=function(){return i(Batman.container),Batman.clearImmediate.apply(this,arguments)},Batman.forEach=function(t,e,n){var r,i,o,a,s,u,c,l;if(t.forEach)return t.forEach(e,n);if(t.indexOf){for(c=[],i=s=0,u=t.length;u>s;i=++s)r=t[i],c.push(e.call(n,r,i,t));return c}l=[];for(o in t)a=t[o],l.push(e.call(n,o,a,t));return l},Batman.objectHasKey=function(t,e){return"function"==typeof t.hasKey?t.hasKey(e):e in t},Batman.contains=function(t,e){return t.indexOf?l.call(t,e)>=0:"function"==typeof t.has?t.has(e):Batman.objectHasKey(t,e)},Batman.get=function(t,e){return"function"==typeof t.get?t.get(e):Batman.Property.forBaseAndKey(t,e).getValue()},Batman.getPath=function(t,e){var n,r,i;for(r=0,i=e.length;i>r;r++){if(n=e[r],null==t)return void 0;if(t=Batman.get(t,n),null==t)return t}return t},r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},a=[],e=[];for(t in r)a.push(t),e.push(r[t]);s=new RegExp("["+a.join("")+"]","g"),n=new RegExp("("+e.join("|")+")","g"),Batman.escapeHTML=function(){return function(t){return(""+t).replace(s,function(t){return r[t]})}}(),Batman.unescapeHTML=function(){return function(t){var e;if(null!=t)return e=Batman._unescapeHTMLNode||(Batman._unescapeHTMLNode=document.createElement("DIV")),e.innerHTML=t,null!=e.innerText?e.innerText:e.textContent}}(),Batman.translate=function(t,e){return null==e&&(e={}),Batman.helpers.interpolate(Batman.get(Batman.translate.messages,t),e)},Batman.translate.messages={},Batman.t=function(){return Batman.translate.apply(Batman,arguments)},Batman.redirect=function(t){var e;return null!=(e=Batman.navigator)?e.redirect(t):void 0},Batman.initializeObject=function(t){return null!=t._batman?t._batman.check(t):t._batman=new Batman._Batman(t)}}.call(this),function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.Inflector=function(){function n(){this._plural=[],this._singular=[],this._uncountable=[],this._human=[]}return n.prototype.plural=function(t,e){return this._plural.unshift([t,e])},n.prototype.singular=function(t,e){return this._singular.unshift([t,e])},n.prototype.human=function(t,e){return this._human.unshift([t,e])},n.prototype.uncountable=function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],this._uncountable=this._uncountable.concat(e.map(function(t){return new RegExp(""+t+"$","i")}))},n.prototype.irregular=function(t,e){return t.charAt(0)===e.charAt(0)?(this.plural(new RegExp("("+t.charAt(0)+")"+t.slice(1)+"$","i"),"$1"+e.slice(1)),this.plural(new RegExp("("+t.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+e.slice(1)),this.singular(new RegExp("("+e.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+t.slice(1))):(this.plural(new RegExp(""+t+"$","i"),e),this.plural(new RegExp(""+e+"$","i"),e),this.singular(new RegExp(""+e+"$","i"),t))},n.prototype.ordinalize=function(t){var n,r;if(n=Math.abs(parseInt(t)),r=n%100,e.call([11,12,13],r)>=0)return t+"th";switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd";default:return t+"th"}},n.prototype.pluralize=function(t){var e,n,r,i,o,a,s,u,c,l;for(u=this._uncountable,i=0,a=u.length;a>i;i++)if(r=u[i],r.test(t))return t;for(c=this._plural,o=0,s=c.length;s>o;o++)if(l=c[o],e=l[0],n=l[1],e.test(t))return t.replace(e,n);return t},n.prototype.singularize=function(t){var e,n,r,i,o,a,s,u,c,l;for(u=this._uncountable,i=0,a=u.length;a>i;i++)if(r=u[i],r.test(t))return t;for(c=this._singular,o=0,s=c.length;s>o;o++)if(l=c[o],e=l[0],n=l[1],e.test(t))return t.replace(e,n);return t},n.prototype.humanize=function(t){var e,n,r,i,o,a;for(o=this._human,r=0,i=o.length;i>r;r++)if(a=o[r],e=a[0],n=a[1],e.test(t))return t.replace(e,n);return t},n}()}.call(this),function(){var t,e,n,r,i,o,a,s;e=/(?:^|_|\-)(.)/g,n=/(^|\s)([a-z])/g,a=/([A-Z]+)([A-Z][a-z])/g,s=/([a-z\d])([A-Z])/g,r=/_id$/,i=/_|-/g,o=/^\w/g,Batman.helpers={ordinalize:function(){return Batman.helpers.inflector.ordinalize.apply(Batman.helpers.inflector,arguments)},singularize:function(){return Batman.helpers.inflector.singularize.apply(Batman.helpers.inflector,arguments)},pluralize:function(t,e,n,r){var i;return null==r&&(r=!0),arguments.length<2?Batman.helpers.inflector.pluralize(t):(i=1===+t?e:n||Batman.helpers.inflector.pluralize(e),r&&(i=""+(t||0)+" "+i),i)},camelize:function(t,n){return t=t.replace(e,function(t,e){return e.toUpperCase()}),n?t.substr(0,1).toLowerCase()+t.substr(1):t},underscore:function(t){return t.replace(a,"$1_$2").replace(s,"$1_$2").replace("-","_").toLowerCase()},capitalize:function(t){return t.replace(n,function(t,e,n){return e+n.toUpperCase()})},trim:function(t){return t?t.trim():""},interpolate:function(t,e){var n,r,i;"object"==typeof t?(r=t[e.count],r||(r=t.other)):r=t;for(n in e)i=e[n],r=r.replace(new RegExp("%\\{"+n+"\\}","g"),i);return r},humanize:function(t){return t=Batman.helpers.underscore(t),t=Batman.helpers.inflector.humanize(t),t.replace(r,"").replace(i," ").replace(o,function(t){return t.toUpperCase()})}},t=new Batman.Inflector,Batman.helpers.inflector=t,t.plural(/$/,"s"),t.plural(/s$/i,"s"),t.plural(/(ax|test)is$/i,"$1es"),t.plural(/(octop|vir)us$/i,"$1i"),t.plural(/(octop|vir)i$/i,"$1i"),t.plural(/(alias|status)$/i,"$1es"),t.plural(/(bu)s$/i,"$1ses"),t.plural(/(buffal|tomat)o$/i,"$1oes"),t.plural(/([ti])um$/i,"$1a"),t.plural(/([ti])a$/i,"$1a"),t.plural(/sis$/i,"ses"),t.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),t.plural(/(hive)$/i,"$1s"),t.plural(/([^aeiouy]|qu)y$/i,"$1ies"),t.plural(/(x|ch|ss|sh)$/i,"$1es"),t.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),t.plural(/([m|l])ouse$/i,"$1ice"),t.plural(/([m|l])ice$/i,"$1ice"),t.plural(/^(ox)$/i,"$1en"),t.plural(/^(oxen)$/i,"$1"),t.plural(/(quiz)$/i,"$1zes"),t.singular(/s$/i,""),t.singular(/(n)ews$/i,"$1ews"),t.singular(/([ti])a$/i,"$1um"),t.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),t.singular(/(^analy)ses$/i,"$1sis"),t.singular(/([^f])ves$/i,"$1fe"),t.singular(/(hive)s$/i,"$1"),t.singular(/(tive)s$/i,"$1"),t.singular(/([lr])ves$/i,"$1f"),t.singular(/([^aeiouy]|qu)ies$/i,"$1y"),t.singular(/(s)eries$/i,"$1eries"),t.singular(/(m)ovies$/i,"$1ovie"),t.singular(/(x|ch|ss|sh)es$/i,"$1"),t.singular(/([m|l])ice$/i,"$1ouse"),t.singular(/(bus)es$/i,"$1"),t.singular(/(o)es$/i,"$1"),t.singular(/(shoe)s$/i,"$1"),t.singular(/(cris|ax|test)es$/i,"$1is"),t.singular(/(octop|vir)i$/i,"$1us"),t.singular(/(alias|status)es$/i,"$1"),t.singular(/^(ox)en/i,"$1"),t.singular(/(vert|ind)ices$/i,"$1ex"),t.singular(/(matr)ices$/i,"$1ix"),t.singular(/(quiz)zes$/i,"$1"),t.singular(/(database)s$/i,"$1"),t.irregular("person","people"),t.irregular("man","men"),t.irregular("child","children"),t.irregular("sex","sexes"),t.irregular("move","moves"),t.irregular("cow","kine"),t.irregular("zombie","zombies"),t.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans")}.call(this),function(){var t;Batman.developer={suppressed:!1,DevelopmentError:function(){var t;return t=function(t){return this.message=t,this.name="DevelopmentError"},t.prototype=Error.prototype,t}(),_ie_console:function(t,e){var n,r,i,o;for(1!==e.length&&"undefined"!=typeof console&&null!==console&&console[t]("..."+t+" of "+e.length+" items..."),o=[],r=0,i=e.length;i>r;r++)n=e[r],o.push("undefined"!=typeof console&&null!==console?console[t](n):void 0);return o},suppress:function(e){return t.suppressed=!0,e?(e(),t.suppressed=!1):void 0},unsuppress:function(){return t.suppressed=!1},log:function(){return t.suppressed||null==("undefined"!=typeof console&&null!==console?console.log:void 0)?void 0:console.log.apply?console.log.apply(console,arguments):t._ie_console("log",arguments)},warn:function(){return t.suppressed||null==("undefined"!=typeof console&&null!==console?console.warn:void 0)?void 0:console.warn.apply?console.warn.apply(console,arguments):t._ie_console("warn",arguments)},error:function(e){throw new t.DevelopmentError(e)},assert:function(e,n){return e?void 0:t.error(n)},"do":function(e){return t.suppressed?void 0:e()},addFilters:function(){return Batman.extend(Batman.Filters,{log:function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log,t},logStack:function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log,t}})},deprecated:function(t,e){return Batman.developer.warn(""+t+" has been deprecated.",e||"")}},t=Batman.developer,Batman.developer.assert(function(){}.bind,"Error! Batman needs Function.bind to work! Please shim it using something like es5-shim or augmentjs!")}.call(this),function(){Batman.Event=function(){function t(t,e){this.base=t,this.key=e,this._preventCount=0}return t.forBaseAndKey=function(t,e){return t.isEventEmitter?t.event(e):new Batman.Event(t,e)},t.prototype.isEvent=!0,t.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key},t.prototype.hashKey=function(){var t;return this.hashKey=function(){return t},t="<Batman.Event base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">'},t.prototype.addHandler=function(t){return this.handlers||(this.handlers=[]),-1===this.handlers.indexOf(t)&&this.handlers.push(t),this.oneShot&&this.autofireHandler(t),this},t.prototype.removeHandler=function(t){var e;return this.handlers&&-1!==(e=this.handlers.indexOf(t))&&this.handlers.splice(e,1),this},t.prototype.eachHandler=function(t){var e,n,r,i,o,a,s,u,c,l,f,p,h;if(null!=(o=this.handlers)&&o.slice().forEach(t),null!=(a=this.base)?a.isEventEmitter:void 0){for(n=this.key,u=null!=(s=this.base._batman)?s.ancestors():void 0,h=[],r=0,i=u.length;i>r;r++)e=u[r],e.isEventEmitter&&(null!=(c=e._batman)?null!=(l=c.events)?l.hasOwnProperty(n):void 0:void 0)?h.push(null!=(f=e.event(n,!1))?null!=(p=f.handlers)?p.slice().forEach(t):void 0:void 0):h.push(void 0);return h}},t.prototype.clearHandlers=function(){return this.handlers=void 0},t.prototype.handlerContext=function(){return this.base},t.prototype.prevent=function(){return++this._preventCount},t.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount},t.prototype.isPrevented=function(){return this._preventCount>0},t.prototype.autofireHandler=function(t){return this._oneShotFired&&null!=this._oneShotArgs?t.apply(this.handlerContext(),this._oneShotArgs):void 0},t.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},t.prototype.fire=function(){return this.fireWithContext(this.handlerContext(),arguments)},t.prototype.fireWithContext=function(t,e){return this.isPrevented()||this._oneShotFired?!1:(this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=e),this.eachHandler(function(n){return n.apply(t,e)}))},t.prototype.allowAndFire=function(){return this.allowAndFireWithContext(this.handlerContext,arguments)},t.prototype.allowAndFireWithContext=function(t,e){return this.allow(),this.fireWithContext(t,e)},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PropertyEvent=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.eachHandler=function(t){return this.base.eachObserver(t)},n.prototype.handlerContext=function(){return this.base.base},n}(Batman.Event)}.call(this),function(){var t=[].slice;Batman.EventEmitter={isEventEmitter:!0,hasEvent:function(t){var e,n;return null!=(e=this._batman)?"function"==typeof e.get?null!=(n=e.get("events"))?n.hasOwnProperty(t):void 0:void 0:void 0},event:function(t,e){var n,r,i,o,a,s,u,c,l,f,p,h;if(null==e&&(e=!0),Batman.initializeObject(this),r=this.eventClass||Batman.Event,null!=(l=this._batman.events)?l.hasOwnProperty(t):void 0)return o=this._batman.events[t];for(f=this._batman.ancestors(),u=0,c=f.length;c>u&&(n=f[u],!(o=null!=(p=n._batman)?null!=(h=p.events)?h[t]:void 0:void 0));u++);return e||(null!=o?o.oneShot:void 0)?(i=(s=this._batman).events||(s.events={}),a=i[t]=new r(this,t),a.oneShot=null!=o?o.oneShot:void 0,a):o},on:function(){var e,n,r,i,o,a,s;for(r=2<=arguments.length?t.call(arguments,0,i=arguments.length-1):(i=0,[]),e=arguments[i++],s=[],o=0,a=r.length;a>o;o++)n=r[o],s.push(this.event(n).addHandler(e));return s},once:function(t,e){var n,r;return n=this.event(t),r=function(){return e.apply(this,arguments),n.removeHandler(r)},n.addHandler(r)},registerAsMutableSource:function(){return Batman.Property.registerSource(this)},mutation:function(t){return function(){var e,n;return e=t.apply(this,arguments),null!=(n=this.event("change",!1))&&n.fire(this,this),e}},prevent:function(t){return this.event(t).prevent(),this},allow:function(t){return this.event(t).allow(),this},isPrevented:function(t){var e;return null!=(e=this.event(t,!1))?e.isPrevented():void 0},fire:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],null!=(r=this.event(n,!1))?r.fireWithContext(this,e):void 0},allowAndFire:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],null!=(r=this.event(n,!1))?r.allowAndFireWithContext(this,e):void 0}}}.call(this),function(){var t=[].slice;Batman.Enumerable={isEnumerable:!0,map:function(t,e){var n;return null==e&&(e=Batman.container),n=[],this.forEach(function(){return n.push(t.apply(e,arguments))}),n},mapToProperty:function(t){var e;return e=[],this.forEach(function(n){return e.push(n.get(t))}),e},every:function(t,e){var n;return null==e&&(e=Batman.container),n=!0,this.forEach(function(){return n=n&&t.apply(e,arguments)}),n},some:function(t,e){var n;return null==e&&(e=Batman.container),n=!1,this.forEach(function(){return n=n||t.apply(e,arguments)}),n},reduce:function(e,n){var r,i,o;return r=0,o=this,i=null!=n?!0:!1,this.forEach(function(){return i?n=e.apply(null,[n].concat(t.call(arguments),[r],[o])):(n=arguments[0],i=!0,void 0)}),n},filter:function(t){var e,n;return e=new this.constructor,e.add?n=function(e,n){return t(n)&&e.add(n),e}:e.set?n=function(e,n,r){return t(n,r)&&e.set(n,r),e}:(e.push||(e=[]),n=function(e,n){return t(n)&&e.push(n),e}),this.reduce(n,e)},inGroupsOf:function(t){var e,n,r;return r=[],e=!1,n=0,this.forEach(function(i){return 0===n++%t&&(e=[],r.push(e)),e.push(i)}),r}}}.call(this),function(){var t,e=[].slice;t=Object.prototype.toString,Batman.SimpleHash=function(){function n(t){this._storage={},this.length=0,null!=t&&this.update(t)}return Batman.extend(n.prototype,Batman.Enumerable),n.prototype.hasKey=function(t){var e,n,r,i;if(this.objectKey(t)){if(!this._objectStorage)return!1;if(n=this._objectStorage[this.hashKeyFor(t)])for(r=0,i=n.length;i>r;r++)if(e=n[r],this.equality(e[0],t))return!0;return!1}return t=this.prefixedKey(t),this._storage.hasOwnProperty(t)},n.prototype.get=function(t){var e,n,r,i;if(!this.objectKey(t))return this._storage[this.prefixedKey(t)];if(!this._objectStorage)return void 0;if(n=this._objectStorage[this.hashKeyFor(t)])for(r=0,i=n.length;i>r;r++)if(e=n[r],this.equality(e[0],t))return e[1]},n.prototype.set=function(t,e){var n,r,i,o,a,s;if(this.objectKey(t)){for(this._objectStorage||(this._objectStorage={}),r=(i=this._objectStorage)[s=this.hashKeyFor(t)]||(i[s]=[]),o=0,a=r.length;a>o;o++)if(n=r[o],this.equality(n[0],t))return n[1]=e;return this.length++,r.push([t,e]),e}return t=this.prefixedKey(t),null==this._storage[t]&&this.length++,this._storage[t]=e},n.prototype.unset=function(t){var e,n,r,i,o,a,s,u,c,l;if(!this.objectKey(t))return t=this.prefixedKey(t),a=this._storage[t],null!=this._storage[t]&&(this.length--,delete this._storage[t]),a;if(!this._objectStorage)return void 0;if(e=this.hashKeyFor(t),o=this._objectStorage[e])for(n=u=0,c=o.length;c>u;n=++u)if(l=o[n],r=l[0],s=l[1],this.equality(r,t))return i=o.splice(n,1),o.length||delete this._objectStorage[e],this.length--,i[0][1]},n.prototype.getOrSet=function(t,e){var n;return n=this.get(t),n||(n=e(),this.set(t,n)),n},n.prototype.prefixedKey=function(t){return"_"+t},n.prototype.unprefixedKey=function(t){return t.slice(1)},n.prototype.hashKeyFor=function(e){var n,r;return(n=null!=e?"function"==typeof e.hashKey?e.hashKey():void 0:void 0)?n:(r=t.call(e),"[object Array]"===r?r:e)},n.prototype.equality=function(t,e){return t===e?!0:t!==t&&e!==e?!0:(null!=t?"function"==typeof t.isEqual?t.isEqual(e):void 0:void 0)&&(null!=e?"function"==typeof e.isEqual?e.isEqual(t):void 0:void 0)?!0:!1},n.prototype.objectKey=function(t){return"string"!=typeof t},n.prototype.forEach=function(t,e){var n,r,i,o,a,s,u,c,l,f,p;if(i=[],this._objectStorage){c=this._objectStorage;for(n in c)for(a=c[n],l=a.slice(),s=0,u=l.length;u>s;s++)f=l[s],r=f[0],o=f[1],i.push(t.call(e,r,o,this))}p=this._storage;for(n in p)o=p[n],i.push(t.call(e,this.unprefixedKey(n),o,this));return i},n.prototype.keys=function(){var t;return t=[],Batman.SimpleHash.prototype.forEach.call(this,function(e){return t.push(e)}),t},n.prototype.toArray=n.prototype.keys,n.prototype.clear=function(){return this._storage={},delete this._objectStorage,this.length=0},n.prototype.isEmpty=function(){return 0===this.length},n.prototype.merge=function(){var t,n,r,i,o;for(r=1<=arguments.length?e.call(arguments,0):[],n=new this.constructor,r.unshift(this),i=0,o=r.length;o>i;i++)t=r[i],t.forEach(function(t,e){return n.set(t,e)});return n},n.prototype.update=function(t){var e,n,r;r=[];for(e in t)n=t[e],r.push(this.set(e,n));return r},n.prototype.replace=function(t){var e=this;return this.forEach(function(n){return n in t?void 0:e.unset(n)}),this.update(t)},n.prototype.toObject=function(){var t,e,n,r,i,o;e={},i=this._storage;for(t in i)r=i[t],e[this.unprefixedKey(t)]=r;if(this._objectStorage){o=this._objectStorage;for(t in o)n=o[t],e[t]=n[0][1]}return e},n.prototype.toJSON=n.prototype.toObject,n}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.AssociationCurator=function(t){function r(t){this.model=t,r.__super__.constructor.call(this),this._byTypeStorage=new Batman.SimpleHash}return e(r,t),r.availableAssociations=["belongsTo","hasOne","hasMany"],r.prototype.add=function(t){var e;return this.set(t.label,t),(e=this._byTypeStorage.get(t.associationType))||(e=new Batman.SimpleSet,this._byTypeStorage.set(t.associationType,e)),e.add(t)},r.prototype.getByType=function(t){return this._byTypeStorage.get(t)},r.prototype.getByLabel=function(t){return this.get(t)},r.prototype.reset=function(){return this.forEach(function(t,e){return e.reset()}),!0},r.prototype.merge=function(){var t,e;return t=1<=arguments.length?n.call(arguments,0):[],e=r.__super__.merge.apply(this,arguments),e._byTypeStorage=this._byTypeStorage.merge(t.map(function(t){return t._byTypeStorage})),e},r.prototype._markDirtyAttribute=function(t,e){var n;if("loading"!==(n=this.lifecycle.get("state"))&&"creating"!==n&&"saving"!==n&&"saved"!==n){if(this.lifecycle.startTransition("set"))return this.dirtyKeys.set(t,e);throw new Batman.StateMachine.InvalidTransitionError("Can't set while in state "+this.lifecycle.get("state"))}},r}(Batman.SimpleHash)}.call(this),function(){var t=[].slice;Batman.SimpleSet=function(){function e(){var t,e;this._storage=[],this.length=0,e=function(){var e,n,r;for(r=[],e=0,n=arguments.length;n>e;e++)t=arguments[e],null!=t&&r.push(t);return r}.apply(this,arguments),e.length>0&&this.add.apply(this,e)}return Batman.extend(e.prototype,Batman.Enumerable),e.prototype.has=function(t){return!!~this._indexOfItem(t)},e.prototype.add=function(){var e,n,r,i,o;for(r=1<=arguments.length?t.call(arguments,0):[],e=[],i=0,o=r.length;o>i;i++)n=r[i],~this._indexOfItem(n)||(this._storage.push(n),e.push(n));return this.length=this._storage.length,this.fire&&0!==e.length&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereAdded"].concat(t.call(e)))),e},e.prototype.remove=function(){var e,n,r,i,o,a;for(r=1<=arguments.length?t.call(arguments,0):[],i=[],o=0,a=r.length;a>o;o++)n=r[o],~(e=this._indexOfItem(n))&&(this._storage.splice(e,1),i.push(n));return this.length=this._storage.length,this.fire&&0!==i.length&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(t.call(i)))),i},e.prototype.find=function(t){var e,n,r,i;for(i=this._storage,n=0,r=i.length;r>n;n++)if(e=i[n],t(e))return e},e.prototype.forEach=function(t,e){var n,r,i,o,a;for(o=this._storage,a=[],r=0,i=o.length;i>r;r++)n=o[r],a.push(t.call(e,n,null,this));return a},e.prototype.isEmpty=function(){return 0===this.length},e.prototype.clear=function(){var e;return e=this._storage,this._storage=[],this.length=0,this.fire&&0!==e.length&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(t.call(e)))),e},e.prototype.replace=function(t){try{return"function"==typeof this.prevent&&this.prevent("change"),this.clear(),this.add.apply(this,t.toArray())}finally{"function"==typeof this.allowAndFire&&this.allowAndFire("change",this,this)}},e.prototype.toArray=function(){return this._storage.slice()},e.prototype.merge=function(){var e,n,r,i,o;for(n=1<=arguments.length?t.call(arguments,0):[],e=new this.constructor,n.unshift(this),i=0,o=n.length;o>i;i++)r=n[i],r.forEach(function(t){return e.add(t)});return e},e.prototype.indexedBy=function(t){return this._indexes||(this._indexes=new Batman.SimpleHash),this._indexes.get(t)||this._indexes.set(t,new Batman.SetIndex(this,t))},e.prototype.indexedByUnique=function(t){return this._uniqueIndexes||(this._uniqueIndexes=new Batman.SimpleHash),this._uniqueIndexes.get(t)||this._uniqueIndexes.set(t,new Batman.UniqueSetIndex(this,t))},e.prototype.sortedBy=function(t,e){var n;return null==e&&(e="asc"),e="desc"===e.toLowerCase()?"desc":"asc",this._sorts||(this._sorts=new Batman.SimpleHash),n=this._sorts.get(t)||this._sorts.set(t,new Batman.Object),n.get(e)||n.set(e,new Batman.SetSort(this,t,e))},e.prototype.equality=Batman.SimpleHash.prototype.equality,e.prototype._indexOfItem=function(t){var e,n,r,i,o;for(o=this._storage,e=r=0,i=o.length;i>r;e=++r)if(n=o[e],this.equality(t,n))return e;return-1},e}()}.call(this),function(){var t,e,n=[].slice;t=[],e=!0,Batman.Property=function(){function r(t,e){this.base=t,this.key=e}return Batman.mixin(r.prototype,Batman.EventEmitter),r._sourceTrackerStack=t,r._sourceTrackerStackValid=e,r.defaultAccessor={get:function(t){return this[t]},set:function(t,e){return this[t]=e},unset:function(t){var e;return e=this[t],delete this[t],e},cache:!1},r.defaultAccessorForBase=function(t){var e;return(null!=(e=t._batman)?e.getFirst("defaultAccessor"):void 0)||Batman.Property.defaultAccessor},r.accessorForBaseAndKey=function(t,e){var n,r,i,o,a,s,u,c,l;if(null!=(i=t._batman)&&(n=null!=(s=i.keyAccessors)?s.get(e):void 0,!n))for(u=i.ancestors(),o=0,a=u.length;a>o&&(r=u[o],!(n=null!=(c=r._batman)?null!=(l=c.keyAccessors)?l.get(e):void 0:void 0));o++);return n||this.defaultAccessorForBase(t)},r.forBaseAndKey=function(t,e){return t.isObservable?t.property(e):new Batman.Keypath(t,e)},r.withoutTracking=function(t){return this.wrapTrackingPrevention(t)()},r.wrapTrackingPrevention=function(t){return function(){Batman.Property.pushDummySourceTracker();try{return t.apply(this,arguments)}finally{Batman.Property.popSourceTracker()}}},r.registerSource=function(n){var r;if(n.isEventEmitter)return e?r=t[t.length-1]:(r=[],t.push(r),e=!0),null!=r&&r.push(n),void 0},r.pushSourceTracker=function(){return e?e=!1:t.push([])},r.popSourceTracker=function(){return e?t.pop():(e=!0,void 0)},r.pushDummySourceTracker=function(){return e||(t.push([]),e=!0),t.push(null)},r.prototype._isolationCount=0,r.prototype.cached=!1,r.prototype.value=null,r.prototype.sources=null,r.prototype.isProperty=!0,r.prototype.isDead=!1,r.prototype.eventClass=Batman.PropertyEvent,r.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key
},r.prototype.hashKey=function(){return this._hashKey||(this._hashKey="<Batman.Property base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">')},r.prototype.event=function(t){var e,n;return e=this.eventClass||Batman.Event,this.events||(this.events={}),(n=this.events)[t]||(n[t]=new e(this,t)),this.events[t]},r.prototype.changeEvent=function(){return this._changeEvent||(this._changeEvent=this.event("change"))},r.prototype.accessor=function(){return this._accessor||(this._accessor=this.constructor.accessorForBaseAndKey(this.base,this.key))},r.prototype.eachObserver=function(t){var e,n,r,i,o,a,s,u,c,l,f,p,h;if(r=this.key,n=null!=(l=this.changeEvent().handlers)?l.slice():void 0)for(a=0,u=n.length;u>a;a++)i=n[a],t(i);if(this.base.isObservable){for(f=this.base._batman.ancestors(),h=[],s=0,c=f.length;c>s;s++)e=f[s],e.isObservable&&e.hasProperty(r)?(o=e.property(r),n=null!=(p=o.changeEvent().handlers)?p.slice():void 0,n?h.push(function(){var e,r,o;for(o=[],e=0,r=n.length;r>e;e++)i=n[e],o.push(t(i));return o}()):h.push(void 0)):h.push(void 0);return h}},r.prototype.observers=function(){var t;return t=[],this.eachObserver(function(e){return t.push(e)}),t},r.prototype.hasObservers=function(){return this.observers().length>0},r.prototype.updateSourcesFromTracker=function(){var t,e,n,r,i,o,a,s,u,c;if(e=this.constructor.popSourceTracker(),t=this.sourceChangeHandler(),this.sources)for(s=this.sources,r=0,o=s.length;o>r;r++)n=s[r],null!=n&&n.event("change").removeHandler(t);if(this.sources=e,this.sources){for(u=this.sources,c=[],i=0,a=u.length;a>i;i++)n=u[i],c.push(null!=n?n.event("change").addHandler(t):void 0);return c}},r.prototype.getValue=function(){if(this.registerAsMutableSource(),!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},r.prototype.isCachable=function(){var t;return this.isFinal()?!0:(t=this.accessor().cache,null!=t?!!t:!0)},r.prototype.isCached=function(){return this.isCachable()&&this.cached},r.prototype.isFinal=function(){return!!this.accessor()["final"]},r.prototype.refresh=function(){var t,e;return this.cached=!1,t=this.value,e=this.getValue(),e===t||this.isIsolated()||this.fire(e,t),void 0!==this.value&&this.isFinal()?this.lockValue():void 0},r.prototype.sourceChangeHandler=function(){var t=this;return this._sourceChangeHandler||(this._sourceChangeHandler=this._handleSourceChange.bind(this)),Batman.developer["do"](function(){return t._sourceChangeHandler.property=t}),this._sourceChangeHandler},r.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:this.isFinal()||this.hasObservers()?this.refresh():this.cached=!1},r.prototype.valueFromAccessor=function(){var t;return null!=(t=this.accessor().get)?t.call(this.base,this.key):void 0},r.prototype.setValue=function(t){var e;if(e=this.accessor().set)return this._changeValue(function(){return e.call(this.base,this.key,t)})},r.prototype.unsetValue=function(){var t;if(t=this.accessor().unset)return this._changeValue(function(){return t.call(this.base,this.key)})},r.prototype._changeValue=function(t){var e;this.cached=!1,this.constructor.pushDummySourceTracker();try{e=t.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}return this.isCached()||this.hasObservers()||this.die(),e},r.prototype.forget=function(t){return null!=t?this.changeEvent().removeHandler(t):this.changeEvent().clearHandlers()},r.prototype.observeAndFire=function(t){return this.observe(t),t.call(this.base,this.value,this.value,this.key)},r.prototype.observe=function(t){return this.changeEvent().addHandler(t),null==this.sources&&this.getValue(),this},r.prototype.observeOnce=function(t){var e,n;return e=this.changeEvent(),n=function(){return t.apply(this,arguments),e.removeHandler(n)},e.addHandler(n),null==this.sources&&this.getValue(),this},r.prototype._removeHandlers=function(){var t,e,n,r,i;if(t=this.sourceChangeHandler(),this.sources)for(i=this.sources,n=0,r=i.length;r>n;n++)e=i[n],e.event("change").removeHandler(t);return delete this.sources,this.changeEvent().clearHandlers()},r.prototype.lockValue=function(){return this._removeHandlers(),this.getValue=function(){return this.value},this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},r.prototype.die=function(){var t,e;return this._removeHandlers(),null!=(t=this.base._batman)&&null!=(e=t.properties)&&e.unset(this.key),this.isDead=!0},r.prototype.fire=function(){var t;return(t=this.changeEvent()).fire.apply(t,n.call(arguments).concat([this.key]))},r.prototype.isolate=function(){return 0===this._isolationCount&&(this._preIsolationValue=this.getValue()),this._isolationCount++},r.prototype.expose=function(){return 1===this._isolationCount?(this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue),this._preIsolationValue=null):this._isolationCount>0?this._isolationCount--:void 0},r.prototype.isIsolated=function(){return this._isolationCount>0},r}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Keypath=function(t){function n(t,e){"string"==typeof e?(this.segments=e.split("."),this.depth=this.segments.length):(this.segments=[e],this.depth=1),n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.isCachable=function(){return 1===this.depth?n.__super__.isCachable.apply(this,arguments):!0},n.prototype.terminalProperty=function(){var t;return t=Batman.getPath(this.base,this.segments.slice(0,-1)),null!=t?Batman.Keypath.forBaseAndKey(t,this.segments[this.depth-1]):void 0},n.prototype.valueFromAccessor=function(){return 1===this.depth?n.__super__.valueFromAccessor.apply(this,arguments):Batman.getPath(this.base,this.segments)},n.prototype.setValue=function(t){var e;return 1===this.depth?n.__super__.setValue.apply(this,arguments):null!=(e=this.terminalProperty())?e.setValue(t):void 0},n.prototype.unsetValue=function(){var t;return 1===this.depth?n.__super__.unsetValue.apply(this,arguments):null!=(t=this.terminalProperty())?t.unsetValue():void 0},n}(Batman.Property)}.call(this),function(){var t=[].slice;Batman.Observable={isObservable:!0,hasProperty:function(t){var e,n;return null!=(e=this._batman)?null!=(n=e.properties)?"function"==typeof n.hasKey?n.hasKey(t):void 0:void 0:void 0},property:function(t){var e,n,r;return Batman.initializeObject(this),n=this.propertyClass||Batman.Keypath,e=(r=this._batman).properties||(r.properties=new Batman.SimpleHash),e.get(t)||e.set(t,new n(this,t))},get:function(t){return this.property(t).getValue()},set:function(t,e){return this.property(t).setValue(e)},unset:function(t){return this.property(t).unsetValue()},getOrSet:Batman.SimpleHash.prototype.getOrSet,forget:function(t,e){var n;return t?this.property(t).forget(e):null!=(n=this._batman.properties)&&n.forEach(function(t,e){return e.forget()}),this},observe:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(r=this.property(n)).observe.apply(r,e),this},observeAndFire:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(r=this.property(n)).observeAndFire.apply(r,e),this},observeOnce:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(r=this.property(n)).observeOnce.apply(r,e),this}}}.call(this),function(){Batman.DOM={textInputTypes:["text","search","tel","url","email","password"],scrollIntoView:function(t){var e;return null!=(e=document.getElementById(t))?"function"==typeof e.scrollIntoView?e.scrollIntoView():void 0:void 0},partial:function(t,e,n,r){var i;return r.prevent("rendered"),i=new Batman.View({source:e,context:n}),i.on("ready",function(){return Batman.DOM.setInnerHTML(t,""),Batman.DOM.appendChild(t,i.get("node")),r.allowAndFire("rendered")})},propagateBindingEvent:function(t,e){for(var n,r,i,o,a;n=(n||e).parentNode;)if(i=Batman._data(n,"bindings"),null!=i)for(o=0,a=i.length;a>o;o++)r=i[o],"function"==typeof r.childBindingAdded&&r.childBindingAdded(t)},propagateBindingEvents:function(t){var e,n,r,i,o,a,s,u;for(u=t.childNodes,i=0,a=u.length;a>i;i++)r=u[i],Batman.DOM.propagateBindingEvents(r);if(n=Batman._data(t,"bindings"))for(o=0,s=n.length;s>o;o++)e=n[o],Batman.DOM.propagateBindingEvent(e,t)},trackBinding:function(t,e){var n;return(n=Batman._data(e,"bindings"))?n.push(t):Batman._data(e,"bindings",[t]),Batman.DOM.fire("bindingAdded",t),Batman.DOM.propagateBindingEvent(t,e),!0},onParseExit:function(t,e){var n;return n=Batman._data(t,"onParseExit")||Batman._data(t,"onParseExit",new Batman.SimpleSet),null!=e&&n.add(e),n},forgetParseExit:function(t){return Batman.removeData(t,"onParseExit",!0)},defineView:function(t,e){var n;return n=e.innerHTML,Batman.View.store.set(Batman.Navigator.normalizePath(t),n),n},setStyleProperty:function(t,e,n,r){return t.style.setProperty?t.style.setProperty(e,n,r):t.style.setAttribute(e,n,r)},removeOrDestroyNode:function(t){var e;return e=Batman._data(t,"view"),e||(e=Batman._data(t,"yielder")),null!=e&&e.get("cached")?Batman.DOM.removeNode(t):Batman.DOM.destroyNode(t)},insertBefore:function(t,e,n){return null==n&&(n=null),!n||t.childNodes.length<=0?Batman.DOM.appendChild(t,e):(Batman.DOM.willInsertNode(e),t.insertBefore(e,n),Batman.DOM.didInsertNode(e))},valueForNode:function(t,e,n){var r;switch(null==e&&(e=""),null==n&&(n=!0),r=arguments.length>1,t.nodeName.toUpperCase()){case"INPUT":case"TEXTAREA":return r?t.value=e:t.value;case"SELECT":if(r)return t.value=e;break;default:return r?Batman.DOM.setInnerHTML(t,n?Batman.escapeHTML(e):e):t.innerHTML}},nodeIsEditable:function(t){var e;return"INPUT"===(e=t.nodeName.toUpperCase())||"TEXTAREA"===e||"SELECT"===e},addEventListener:function(t,e,n){var r;return(r=Batman._data(t,"listeners"))||(r=Batman._data(t,"listeners",{})),r[e]||(r[e]=[]),r[e].push(n),Batman.DOM.hasAddEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)},removeEventListener:function(t,e,n){var r,i,o;return(o=Batman._data(t,"listeners"))&&(r=o[e])&&(i=r.indexOf(n),-1!==i&&r.splice(i,1)),Batman.DOM.hasAddEventListener?t.removeEventListener(e,n,!1):t.detachEvent("on"+e,n)},hasAddEventListener:!!("undefined"!=typeof window&&null!==window?window.addEventListener:void 0),preventDefault:function(t){return"function"==typeof t.preventDefault?t.preventDefault():t.returnValue=!1},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},willInsertNode:function(t){var e,n,r,i,o,a;for(n=Batman._data(t,"view"),null!=n&&n.fire("beforeAppear",t),null!=(o=Batman.data(t,"show"))&&o.call(t),a=t.childNodes,r=0,i=a.length;i>r;r++)e=a[r],Batman.DOM.willInsertNode(e);return!0},didInsertNode:function(t){var e,n,r,i,o;for(n=Batman._data(t,"view"),n&&(n.fire("appear",t),n.applyYields()),o=t.childNodes,r=0,i=o.length;i>r;r++)e=o[r],Batman.DOM.didInsertNode(e);return!0},willRemoveNode:function(t){var e,n,r,i,o,a;for(n=Batman._data(t,"view"),n&&n.fire("beforeDisappear",t),null!=(o=Batman.data(t,"hide"))&&o.call(t),a=t.childNodes,r=0,i=a.length;i>r;r++)e=a[r],Batman.DOM.willRemoveNode(e);return!0},didRemoveNode:function(t){var e,n,r,i,o;for(n=Batman._data(t,"view"),n&&(n.retractYields(),n.fire("disappear",t)),o=t.childNodes,r=0,i=o.length;i>r;r++)e=o[r],Batman.DOM.didRemoveNode(e);return!0},willDestroyNode:function(t){var e,n,r,i,o;for(n=Batman._data(t,"view"),n&&(n.fire("beforeDestroy",t),n.get("yields").forEach(function(e,n){var r,i,o;for(o=[],r=0,i=n.length;i>r;r++)t=n[r].node,o.push(Batman.DOM.willDestroyNode(t));return o})),o=t.childNodes,r=0,i=o.length;i>r;r++)e=o[r],Batman.DOM.willDestroyNode(e);return!0},didDestroyNode:function(t){var e,n,r,i,o,a,s,u,c;if(a=Batman._data(t,"view"),a&&a.die(),(e=Batman._data(t,"bindings"))&&e.forEach(function(t){return t.die()}),o=Batman._data(t,"listeners"))for(i in o)r=o[i],r.forEach(function(e){return Batman.DOM.removeEventListener(t,i,e)});for(Batman.removeData(t),Batman.removeData(t,void 0,!0),c=t.childNodes,s=0,u=c.length;u>s;s++)n=c[s],Batman.DOM.didDestroyNode(n);return!0}},Batman.mixin(Batman.DOM,Batman.EventEmitter,Batman.Observable),Batman.DOM.event("bindingAdded")}.call(this),function(){Batman.DOM.ReaderBindingDefinition=function(){function t(t,e,n,r){this.node=t,this.keyPath=e,this.context=n,this.renderer=r}return t}(),Batman.BindingDefinitionOnlyObserve={Data:"data",Node:"node",All:"all",None:"none"},Batman.DOM.readers={target:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Node,Batman.DOM.readers.bind(t)},source:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.readers.bind(t)},bind:function(t){var e,n;switch(n=t.node,n.nodeName.toLowerCase()){case"input":switch(n.getAttribute("type")){case"checkbox":return t.attr="checked",Batman.DOM.attrReaders.bind(t),!0;case"radio":e=Batman.DOM.RadioBinding;break;case"file":e=Batman.DOM.FileBinding}break;case"select":e=Batman.DOM.SelectBinding}return e||(e=Batman.DOM.ValueBinding),new e(t)},context:function(t){return t.context.descendWithDefinition(t)},mixin:function(t){return t.context=t.context.descend(Batman.mixins),new Batman.DOM.MixinBinding(t)},showif:function(t){return new Batman.DOM.ShowHideBinding(t)},hideif:function(t){return t.invert=!0,new Batman.DOM.ShowHideBinding(t)},insertif:function(t){return new Batman.DOM.InsertionBinding(t)},removeif:function(t){return t.invert=!0,new Batman.DOM.InsertionBinding(t)},route:function(t){return new Batman.DOM.RouteBinding(t)},view:function(t){return new Batman.DOM.ViewBinding(t)},partial:function(t){return Batman.DOM.partial(t.node,t.keyPath,t.context,t.renderer)},defineview:function(t){var e;return e=t.node,Batman.DOM.onParseExit(e,function(){var t;return null!=(t=e.parentNode)?t.removeChild(e):void 0}),Batman.DOM.defineView(t.keyPath,e),{skipChildren:!0}},renderif:function(t){return new Batman.DOM.DeferredRenderingBinding(t)},yield:function(t){var e,n;return n=t.node,e=t.keyPath,Batman.DOM.onParseExit(n,function(){return Batman.DOM.Yield.withName(e).set("containerNode",n)})},contentfor:function(t){var e,n,r,i,o;return n=t.node,o=t.value,i=t.swapMethod,r=t.renderer,e=t.keyPath,i||(i="append"),Batman.DOM.onParseExit(n,function(){var t;return null!=(t=n.parentNode)&&t.removeChild(n),r.view.pushYieldAction(e,i,n)})},replace:function(t){return t.swapMethod="replace",Batman.DOM.readers.contentfor(t)}}}.call(this),function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.DOM.events={click:function(e,n,r,i){return null==i&&(i="click"),Batman.DOM.addEventListener(e,i,function(){var o,a;return a=arguments[0],o=2<=arguments.length?t.call(arguments,1):[],a.metaKey||a.ctrlKey||1===a.button||(Batman.DOM.preventDefault(a),!Batman.DOM.eventIsAllowed(i,a))?void 0:n.apply(null,[e,a].concat(t.call(o),[r]))}),"A"!==e.nodeName.toUpperCase()||e.href||(e.href="#"),e},doubleclick:function(t,e,n){return Batman.DOM.events.click(t,e,n,"dblclick")},change:function(n,r,i){var o,a,s,u,c,l;for(a=function(){var t;switch(n.nodeName.toUpperCase()){case"TEXTAREA":return["input","keyup","change"];case"INPUT":return t=n.type.toLowerCase(),e.call(Batman.DOM.textInputTypes,t)>=0?(s=r,r=function(t,e){return"keyup"===e.type&&Batman.DOM.events.isEnter(e)?void 0:s(t,e)},["input","keyup","change"]):["input","change"];default:return["change"]}}(),l=[],u=0,c=a.length;c>u;u++)o=a[u],l.push(Batman.DOM.addEventListener(n,o,function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],r.apply(null,[n].concat(t.call(e),[i]))}));return l},isEnter:function(t){var e,n;return 13<=(e=t.keyCode)&&14>=e||13<=(n=t.which)&&14>=n||"Enter"===t.keyIdentifier||"Enter"===t.key},submit:function(e,n,r){return Batman.DOM.nodeIsEditable(e)?(Batman.DOM.addEventListener(e,"keydown",function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],Batman.DOM.events.isEnter(n[0])?Batman.DOM._keyCapturingNode=e:void 0}),Batman.DOM.addEventListener(e,"keyup",function(){var i;return i=1<=arguments.length?t.call(arguments,0):[],Batman.DOM.events.isEnter(i[0])?(Batman.DOM._keyCapturingNode===e&&(Batman.DOM.preventDefault(i[0]),n.apply(null,[e].concat(t.call(i),[r]))),Batman.DOM._keyCapturingNode=null):void 0})):Batman.DOM.addEventListener(e,"submit",function(){var i;return i=1<=arguments.length?t.call(arguments,0):[],Batman.DOM.preventDefault(i[0]),n.apply(null,[e].concat(t.call(i),[r]))}),e},other:function(e,n,r,i){return Batman.DOM.addEventListener(e,n,function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],r.apply(null,[e].concat(t.call(n),[i]))})}},Batman.DOM.eventIsAllowed=function(t,e){var n,r,i;return(n=null!=(r=Batman.currentApp)?null!=(i=r.shouldAllowEvent)?i[t]:void 0:void 0)&&n(e)===!1?!1:!0}}.call(this),function(){Batman.DOM.AttrReaderBindingDefinition=function(){function t(t,e,n,r,i){this.node=t,this.attr=e,this.keyPath=n,this.context=r,this.renderer=i}return t}(),Batman.DOM.attrReaders={_parseAttribute:function(t){return"false"===t&&(t=!1),"true"===t&&(t=!0),t},source:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.attrReaders.bind(t)},bind:function(t){var e;return e=function(){switch(t.attr){case"checked":case"disabled":case"selected":return Batman.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return Batman.DOM.NodeAttributeBinding;case"class":return Batman.DOM.ClassBinding;case"style":return Batman.DOM.StyleBinding;default:return Batman.DOM.AttributeBinding}}(),new e(t)},context:function(t){return t.context.descendWithDefinition(t)},event:function(t){return new Batman.DOM.EventBinding(t)},addclass:function(t){return new Batman.DOM.AddClassBinding(t)},removeclass:function(t){return t.invert=!0,new Batman.DOM.AddClassBinding(t)},foreach:function(t){return new Batman.DOM.IteratorBinding(t)},formfor:function(t){return new Batman.DOM.FormBinding(t),t.context.descendWithDefinition(t)}}}.call(this),function(){var t,e,n,r,i,o=[].slice,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=function(t,e){var n,r,i,o;for("function"==typeof e&&(e={get:e}),o=["cachable","cacheable"],r=0,i=o.length;i>r;r++)n=o[r],n in e&&(Batman.developer.warn('Property accessor option "'+n+'" is deprecated. Use "cache" instead.'),"cache"in e||(e.cache=e[n]));return e},r=function(t){return function(e){return{get:function(n){var r,i,o,a,s,u,c,l=this;return null!=(i=e.get.apply(this,arguments))?i:(r=!1,o=void 0,null==(u=(a=this._batman).promises)&&(a.promises={}),null==(c=(s=this._batman.promises)[n])&&(s[n]=function(){var e,i;return e=function(t,e){return r&&l.set(n,e),o=e},i=t.call(l,e,n),null==o&&(o=i),!0}()),r=!0,o)},cache:!0}}},i=function(t,e){var n,r;e=("function"==typeof e?e(t):void 0)||e;for(n in t)r=t[n],n in e||(e[n]=r);return e},e={_defineAccessor:function(){var t,e,i,a,s,u,c,l,f;if(i=2<=arguments.length?o.call(arguments,0,s=arguments.length-1):(s=0,[]),t=arguments[s++],null==t)return Batman.Property.defaultAccessorForBase(this);if(0===i.length&&"Object"!==(l=Batman.typeOf(t))&&"Function"!==l)return Batman.Property.accessorForBaseAndKey(this,t);if("function"==typeof t.promise)return this._defineWrapAccessor.apply(this,o.call(i).concat([r(t.promise)]));if(Batman.initializeObject(this),0===i.length)return this._batman.defaultAccessor=n(this,t);for((a=this._batman).keyAccessors||(a.keyAccessors=new Batman.SimpleHash),f=[],u=0,c=i.length;c>u;u++)e=i[u],f.push(this._batman.keyAccessors.set(e,n(this,t)));return f},_defineWrapAccessor:function(){var t,e,n,r,a,s,u;if(e=2<=arguments.length?o.call(arguments,0,r=arguments.length-1):(r=0,[]),n=arguments[r++],Batman.initializeObject(this),0===e.length)return this._defineAccessor(i(this._defineAccessor(),n));for(u=[],a=0,s=e.length;s>a;a++)t=e[a],u.push(this._defineAccessor(t,i(this._defineAccessor(t),n)));return u},_resetPromises:function(){var t;if(null!=this._batman.promises)for(t in this._batman.promises)this._resetPromise(t)},_resetPromise:function(t){this.unset(t),this.property(t).cached=!1,delete this._batman.promises[t]}},t=function(t){function n(){var t;t=1<=arguments.length?o.call(arguments,0):[],this._batman=new Batman._Batman(this),this.mixin.apply(this,t)}var r;return s(n,t),Batman.initializeObject(n),Batman.initializeObject(n.prototype),Batman.mixin(n.prototype,e,Batman.EventEmitter,Batman.Observable),Batman.mixin(n,e,Batman.EventEmitter,Batman.Observable),n.classMixin=function(){return Batman.mixin.apply(Batman,[this].concat(o.call(arguments)))},n.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},n.prototype.mixin=n.classMixin,n.classAccessor=n._defineAccessor,n.accessor=function(){var t;return(t=this.prototype)._defineAccessor.apply(t,arguments)},n.prototype.accessor=n._defineAccessor,n.wrapClassAccessor=n._defineWrapAccessor,n.wrapAccessor=function(){var t;return(t=this.prototype)._defineWrapAccessor.apply(t,arguments)},n.prototype.wrapAccessor=n._defineWrapAccessor,n.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},n.singleton=function(t){return null==t&&(t="sharedInstance"),this.classAccessor(t,{get:function(){var e;return this[e="_"+t]||(this[e]=new this)}})},n.accessor("_batmanID",function(){return this._batmanID()}),r=0,n.prototype._batmanID=function(){var t,e;return this._batman.check(this),null==(e=(t=this._batman).id)&&(t.id=r++),this._batman.id},n.prototype.hashKey=function(){var t;if("function"!=typeof this.isEqual)return(t=this._batman).hashKey||(t.hashKey="<Batman.Object "+this._batmanID()+">")},n.prototype.toJSON=function(){var t,e,n;e={};for(t in this)a.call(this,t)&&(n=this[t],"_batman"!==t&&"hashKey"!==t&&"_batmanID"!==t&&(e[t]=(null!=n?n.toJSON:void 0)?n.toJSON():n));return e},n}(Object),Batman.Object=t}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Renderer=function(e){function r(e,n,i){this.node=e,this.context=n,this.view=i,this.resume=t(this.resume,this),this.start=t(this.start,this),r.__super__.constructor.call(this),this.context instanceof Batman.RenderContext||Batman.developer.error("Must pass a RenderContext to a renderer for rendering"),this.immediate=Batman.setImmediate(this.start)}var i,o,a,s,u,c,l,f,p,h,d;for(n(r,e),r.prototype.deferEvery=50,r.prototype.start=function(){return this.startTime=new Date,this.prevent("parsed"),this.prevent("rendered"),this.parseNode(this.node)},r.prototype.resume=function(){return this.startTime=new Date,this.parseNode(this.resumeNode)},r.prototype.finish=function(){return this.startTime=null,this.prevent("stopped"),this.allowAndFire("parsed"),this.allowAndFire("rendered")},r.prototype.stop=function(){return Batman.clearImmediate(this.immediate),this.fire("stopped")},d=["parsed","rendered","stopped"],l=0,p=d.length;p>l;l++)s=d[l],r.prototype.event(s).oneShot=!0;for(i=/^data\-(.*)/,o=["view","renderif","foreach","formfor","context","bind","source","target"],a={},c=f=0,h=o.length;h>f;c=++f)u=o[c],a[u]=c;return r.prototype._sortBindings=function(t,e){var n,r;return n=a[t[0]],r=a[e[0]],null==n&&(n=o.length),null==r&&(r=o.length),n>r?1:r>n?-1:t[0]>e[0]?1:e[0]>t[0]?-1:0},r.prototype.parseNode=function(t){var e,n,r,o,a,s,c,l,f,p,h,d,g,m,v,y,b,$,x,w=this;if(this.deferEvery&&new Date-this.startTime>this.deferEvery)return this.resumeNode=t,this.timeout=Batman.setImmediate(this.resume),void 0;if(t.getAttribute&&t.attributes){for(a=[],y=t.attributes,d=0,m=y.length;m>d;d++)n=y[d],u=null!=(b=n.nodeName.match(i))?b[1]:void 0,u&&a.push((s=u.split("-")).length>1?[s[0],s.slice(1,s.length+1||9e9).join("-"),n.value]:[u,void 0,n.value]);for($=a.sort(this._sortBindings),g=0,v=$.length;v>g;g++)if(x=$[g],u=x[0],e=x[1],h=x[2],r=e?(f=Batman.DOM.attrReaders[u])?(o=new Batman.DOM.AttrReaderBindingDefinition(t,e,h,this.context,this),f(o)):void 0:(f=Batman.DOM.readers[u])?(o=new Batman.DOM.ReaderBindingDefinition(t,h,this.context,this),f(o)):void 0,r instanceof Batman.RenderContext)l=this.context,this.context=r,Batman.DOM.onParseExit(t,function(){return w.context=l});else if(null!=r?r.skipChildren:void 0){p=!0;break}}return(c=this.nextNode(t,p))?this.parseNode(c):this.finish()},r.prototype.nextNode=function(t,e){var n,r,i,o,a,s;if(!e&&(n=t.childNodes,null!=n?n.length:void 0))return n[0];if(o=t.nextSibling,null!=(a=Batman.DOM.onParseExit(t))&&a.forEach(function(t){return t()}),Batman.DOM.forgetParseExit(t),this.node!==t){if(o)return o;for(r=t;r=r.parentNode;){if(i=r.nextSibling,null!=(s=Batman.DOM.onParseExit(r))&&s.forEach(function(t){return t()}),Batman.DOM.forgetParseExit(r),this.node===r)return;if(i)return i}}},r}(Batman.Object)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AbstractBinding=function(e){function r(e){this._fireDataChange=t(this._fireDataChange,this),this.node=e.node,this.keyPath=e.keyPath,this.renderContext=e.context,this.renderer=e.renderer,e.onlyObserve&&(this.onlyObserve=e.onlyObserve),null!=e.skipParseFilter&&(this.skipParseFilter=e.skipParseFilter),this.skipParseFilter||this.parseFilter(),this.bindImmediately&&this.bind()}var i,o,a,s,u,c;return n(r,e),a=/(^|,)\s*(?:(true|false)|("[^"]*")|(\{[^\}]*\})|(([0-9]+[a-zA-Z\_]|[a-zA-Z])[\w\-\.]*[\?\!]?))\s*(?=$|,)/g,i=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,o=/(?!^\s*)\[(.*?)\]/g,r.accessor("filteredValue",{get:function(){var t,e,n,r;return r=this.get("unfilteredValue"),n=this,t=this.get("renderContext"),this.filterFunctions.length>0?(Batman.developer.currentFilterStack=t,e=this.filterFunctions.reduce(function(e,r,i){var o;for(o=n.filterArguments[i].map(function(t){return t._keypath?n.renderContext.get(t._keypath):t}),o.unshift(e);o.length<r.length-1;)o.push(void 0);return o.push(n),r.apply(t,o)},r),Batman.developer.currentFilterStack=null,e):r},set:function(t,e){return this.set("unfilteredValue",e)}}),r.accessor("unfilteredValue",{get:function(){var t;return(t=this.get("key"))?Batman.RenderContext.deProxy(Batman.getPath(this,["keyContext",t])):this.get("value")},set:function(t,e){var n,r,i;return(n=this.get("key"))?(r=this.get("keyContext"),r&&r!==Batman.container?(i=Batman.Property.forBaseAndKey(r,n),i.setValue(e)):void 0):this.set("value",e)}}),r.accessor("keyContext",function(){return this.renderContext.contextForKey(this.key)}),s=Batman.BindingDefinitionOnlyObserve.All,u=Batman.BindingDefinitionOnlyObserve.Data,c=Batman.BindingDefinitionOnlyObserve.Node,r.prototype.bindImmediately=!0,r.prototype.shouldSet=!0,r.prototype.isInputBinding=!1,r.prototype.escapeValue=!0,r.prototype.onlyObserve=s,r.prototype.skipParseFilter=!1,r.prototype.isTwoWay=function(){return null!=this.key&&0===this.filterFunctions.length},r.prototype.bind=function(){var t,e;return this.node&&((t=this.onlyObserve)===s||t===c)&&Batman.DOM.nodeIsEditable(this.node)&&(Batman.DOM.events.change(this.node,this._fireNodeChange.bind(this)),this.onlyObserve===c&&this._fireNodeChange()),((e=this.onlyObserve)===s||e===u)&&this.observeAndFire("filteredValue",this._fireDataChange),this.node?Batman.DOM.trackBinding(this,this.node):void 0},r.prototype._fireNodeChange=function(t){var e;return this.shouldSet=!1,e=this.value||this.get("keyContext"),"function"==typeof this.nodeChange&&this.nodeChange(this.node,e,t),this.fire("nodeChange",this.node,e),this.shouldSet=!0},r.prototype._fireDataChange=function(t){return this.shouldSet?("function"==typeof this.dataChange&&this.dataChange(t,this.node),this.fire("dataChange",t,this.node)):void 0},r.prototype.die=function(){var t;return this.forget(),null!=(t=this._batman.properties)&&t.forEach(function(t,e){return e.die()}),this.fire("die"),this.node=null,this.keyPath=null,this.renderContext=null,this.renderer=null,this.dead=!0,!0},r.prototype.parseFilter=function(){var t,e,n,r,a,s,u,c,l;for(this.filterFunctions=[],this.filterArguments=[],u=this.keyPath;i.test(u);)u=u.replace(i,"]['$1']");a=u.replace(o," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{s=this.parseSegment(c=a.shift())[0]}catch(f){Batman.developer.warn(f),Batman.developer.error("Error! Couldn't parse keypath in \""+c+'". Parsing error above.')}if(s&&s._keypath?this.key=s._keypath:this.value=s,a.length){for(;r=a.shift();){if(l=r.indexOf(" "),-1===l&&(l=r.length),n=r.substr(0,l),t=r.substr(l),!(e=Batman.Filters[n]))return Batman.developer.error("Unrecognized filter '"+n+"' in key \""+this.keyPath+'"!');this.filterFunctions.push(e);try{this.filterArguments.push(this.parseSegment(t))}catch(f){Batman.developer.error('Bad filter arguments "'+t+'"!')}}return!0}},r.prototype.parseSegment=function(t){return t=t.replace(a,function(t,e,n,r,i,o){var a;return null==e&&(e=""),a=o?'{"_keypath": "'+o+'"}':n||r||i,e+a}),JSON.parse("["+t+"]")},r}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ViewBinding=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.renderer.prevent("rendered"),this.node.removeAttribute("data-view")}return e(n,t),n.prototype.skipChildren=!0,n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){var e,n=this;if(null!=t)return t.isView?(this.view=t,this.view.set("context",this.renderContext),this.view.set("node",this.node)):this.view=new t({node:this.node,context:this.renderContext,parentView:this.renderer.view}),this.view.on("ready",function(){return n.renderer.allowAndFire("rendered")}),this.forget(),null!=(e=this._batman.properties)?e.forEach(function(t,e){return e.die()}):void 0},n.prototype.die=function(){return this.view=null,n.__super__.die.apply(this,arguments)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ViewArgumentBinding=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ValueBinding=function(t){function n(t){var e;this.isInputBinding="input"===(e=t.node.nodeName.toLowerCase())||"textarea"===e,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.node.value):void 0},n.prototype.dataChange=function(t){return Batman.DOM.valueForNode(this.node,t,this.escapeValue)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ShowHideBinding=function(t){function n(t){var e;e=t.node.style.display,e&&"none"!==e||(e=""),this.originalDisplay=e,this.invert=t.invert,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){var e,n,r;
return n=Batman._data(this.node,"view"),!!t==!this.invert?(null!=n&&n.fire("beforeAppear",this.node),null!=(r=Batman.data(this.node,"show"))&&r.call(this.node),this.node.style.display=this.originalDisplay,null!=n?n.fire("appear",this.node):void 0):(null!=n&&n.fire("beforeDisappear",this.node),"function"==typeof(e=Batman.data(this.node,"hide"))?e.call(this.node):Batman.DOM.setStyleProperty(this.node,"display","none","important"),null!=n?n.fire("disappear",this.node):void 0)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.SelectBinding=function(e){function r(){this.updateOptionBindings=t(this.updateOptionBindings,this),this.nodeChange=t(this.nodeChange,this),this.dataChange=t(this.dataChange,this),this.childBindingAdded=t(this.childBindingAdded,this),this.selectedBindings=new Batman.SimpleSet,r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.isInputBinding=!0,r.prototype.canSetImplicitly=!0,r.prototype.childBindingAdded=function(t){var e,n=this;if(t instanceof Batman.DOM.CheckedBinding)t.on("dataChange",e=function(){return n.nodeChange()}),t.on("die",function(){return t.forget("dataChange",e),n.selectedBindings.remove(t)}),this.selectedBindings.add(t);else{if(!(t instanceof Batman.DOM.IteratorBinding))return;t.on("nodeAdded",e=function(){return n._fireDataChange(n.get("filteredValue"))}),t.on("nodeRemoved",e),t.on("die",function(){return t.forget("nodeAdded",e),t.forget("nodeRemoved",e)})}return this._fireDataChange(this.get("filteredValue"))},r.prototype.lastKeyContext=null,r.prototype.dataChange=function(t){var e,n,r,i,o,a,s;if(this.lastKeyContext||(this.lastKeyContext=this.get("keyContext")),this.lastKeyContext!==this.get("keyContext")&&(this.canSetImplicitly=!0,this.lastKeyContext=this.get("keyContext")),null!=t?t.forEach:void 0){for(r={},s=this.node.children,i=0,o=s.length;o>i;i++)e=s[i],e.selected=!1,n=r[a=e.value]||(r[a]=[]),n.push(e);t.forEach(function(t){var e,n,i,o,a;if(e=r[t]){for(a=[],i=0,o=e.length;o>i;i++)n=e[i],a.push(n.selected=!0);return a}})}else null==t&&this.canSetImplicitly?this.node.value&&(this.canSetImplicitly=!1,this.set("unfilteredValue",this.node.value)):(this.canSetImplicitly=!1,Batman.DOM.valueForNode(this.node,t,this.escapeValue));this.updateOptionBindings()},r.prototype.nodeChange=function(){var t,e;this.isTwoWay()&&(e=this.node.multiple?function(){var e,n,r,i;for(r=this.node.children,i=[],e=0,n=r.length;n>e;e++)t=r[e],t.selected&&i.push(t.value);return i}.call(this):this.node.value,typeof e===Array&&1===e.length&&(e=e[0]),this.set("unfilteredValue",e),this.updateOptionBindings())},r.prototype.updateOptionBindings=function(){return this.selectedBindings.forEach(function(t){return t._fireNodeChange()})},r}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.RouteBinding=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onAnchorTag=!1,n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.accessor("dispatcher",function(){return this.renderContext.get("dispatcher")||Batman.App.get("current.dispatcher")}),n.prototype.bind=function(){var t=this;return"A"===this.node.nodeName.toUpperCase()&&(this.onAnchorTag=!0),n.__super__.bind.apply(this,arguments),Batman.DOM.events.click(this.node,function(e,n){var r;if(!n.__batmanActionTaken)return n.__batmanActionTaken=!0,r=t.pathFromValue(t.get("filteredValue")),null!=r?Batman.redirect(r):void 0})},n.prototype.dataChange=function(t){var e;return t&&(e=this.pathFromValue(t)),this.onAnchorTag?(e=e&&Batman.navigator?Batman.navigator.linkTo(e):"#",this.node.href=e):void 0},n.prototype.pathFromValue=function(t){var e;return t?t.isNamedRouteQuery?t.get("path"):null!=(e=this.get("dispatcher"))?e.pathFromParams(t):void 0:void 0},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.RadioBinding=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor("parsedNodeValue",function(){return Batman.DOM.attrReaders._parseAttribute(this.node.value)}),n.prototype.firstBind=!0,n.prototype.dataChange=function(){var t;return t=this.get("filteredValue"),null!=t?this.node.checked=t===Batman.DOM.attrReaders._parseAttribute(this.node.value):this.firstBind&&this.node.checked&&this.set("filteredValue",this.get("parsedNodeValue")),this.firstBind=!1},n.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.get("parsedNodeValue")):void 0},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.MixinBinding=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){return null!=t?Batman.mixin(this.node,t):void 0},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.FileBinding=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.isInputBinding=!0,n.prototype.nodeChange=function(t){return this.isTwoWay()?t.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(t.files)):this.set("filteredValue",t.files[0]):void 0},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.DeferredRenderingBinding=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-renderif")}return e(n,t),n.prototype.rendered=!1,n.prototype.skipChildren=!0,n.prototype.nodeChange=function(){},n.prototype.dataChange=function(t){return t&&!this.rendered?this.render():void 0},n.prototype.render=function(){return new Batman.Renderer(this.node,this.renderContext,this.renderer.view),this.rendered=!0},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AbstractAttributeBinding=function(t){function n(t){this.attributeName=t.attr,n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.FormBinding=function(e){function r(){this.childBindingAdded=t(this.childBindingAdded,this),r.__super__.constructor.apply(this,arguments),this.contextName=this.attributeName,delete this.attributeName,Batman.DOM.events.submit(this.get("node"),function(t,e){return Batman.DOM.preventDefault(e)}),this.setupErrorsList()}return n(r,e),r.current=null,r.prototype.errorClass="error",r.prototype.defaultErrorsListSelector="div.errors",r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,r.accessor("errorsListSelector",function(){return this.get("node").getAttribute("data-errors-list")||this.defaultErrorsListSelector}),r.prototype.childBindingAdded=function(t){var e,n,r,i;return t.isInputBinding&&Batman.isChildOf(this.get("node"),t.get("node"))&&~(r=t.get("key").indexOf(this.contextName))?(i=t.get("node"),n=t.get("key").slice(r+this.contextName.length+1),e=new Batman.DOM.AttrReaderBindingDefinition(i,this.errorClass,this.get("keyPath")+(" | get 'errors."+n+".length'"),this.renderContext,this.renderer),new Batman.DOM.AddClassBinding(e)):void 0},r.prototype.setupErrorsList=function(){return(this.errorsListNode=Batman.DOM.querySelector(this.get("node"),this.get("errorsListSelector")))&&(Batman.DOM.setInnerHTML(this.errorsListNode,this.errorsListHTML()),!this.errorsListNode.getAttribute("data-showif"))?this.errorsListNode.setAttribute("data-showif",""+this.contextName+".errors.length"):void 0},r.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.contextName+'.errors" data-bind="error.fullMessage"></li>\n</ul>'},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.EventBinding=function(t){function n(){var t,e,r,i=this;n.__super__.constructor.apply(this,arguments),(r=this.node.getAttribute("data-confirm"))&&Batman.developer.deprecated("data-confirm"),e=function(){var t;if(!r||confirm(r))return null!=(t=i.get("filteredValue"))?t.apply(i.get("callbackContext"),arguments):void 0},(t=Batman.DOM.events[this.attributeName])?t(this.node,e,this.renderContext):Batman.DOM.events.other(this.node,this.attributeName,e,this.renderContext)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,n.accessor("callbackContext",function(){var t;return t=this.key.split("."),t.pop(),t.length>0?this.get("keyContext").get(t.join(".")):this.get("keyContext")}),n.wrapAccessor("unfilteredValue",function(t){return{get:function(){var e,n,r,i;return(n=this.get("key"))&&(i=n.split("."),i.length>1&&(e=i.pop(),r=Batman.getPath(this,["keyContext"].concat(i)),r=Batman.RenderContext.deProxy(r),null!=r))?r[e]:t.get.apply(this,arguments)}}}),n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.NodeAttributeBinding=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.dataChange=function(t){return null==t&&(t=""),this.node[this.attributeName]=t},n.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(t[this.attributeName])):void 0},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.CheckedBinding=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.isInputBinding=!0,n.prototype.dataChange=function(t){return this.node[this.attributeName]=!!t},n}(Batman.DOM.NodeAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AttributeBinding=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){return this.node.setAttribute(this.attributeName,t)},n.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(t.getAttribute(this.attributeName))):void 0},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AddClassBinding=function(t){function n(t){var e;this.invert=t.invert,this.classes=function(){var n,r,i,o;for(i=t.attr.split("|"),o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push({name:e,pattern:new RegExp("(?:^|\\s)"+e+"(?:$|\\s)","i")});return o}(),n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){var e,n,r,i,o,a,s,u;for(e=this.node.className,s=this.classes,o=0,a=s.length;a>o;o++)u=s[o],r=u.name,i=u.pattern,n=i.test(e),!!t==!this.invert?n||(this.node.className=""+e+" "+r):n&&(this.node.className=e.replace(i," "));return!0},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AbstractCollectionBinding=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.bindCollection=function(t){var e;return t instanceof Batman.Hash&&(t=t.meta),t===this.collection?!0:(this.unbindCollection(),this.collection=t,(null!=(e=this.collection)?e.isObservable:void 0)?(this.collection.observeAndFire("toArray",this.handleArrayChanged),!0):!1)},n.prototype.unbindCollection=function(){var t;return(null!=(t=this.collection)?t.isObservable:void 0)?this.collection.forget("toArray",this.handleArrayChanged):void 0},n.prototype.handleArrayChanged=function(){},n.prototype.die=function(){return this.unbindCollection(),n.__super__.die.apply(this,arguments)},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.DOM.StyleBinding=function(i){function o(){this.setStyle=t(this.setStyle,this),this.handleArrayChanged=t(this.handleArrayChanged,this),this.oldStyles={},this.styleBindings={},o.__super__.constructor.apply(this,arguments)}return n(o,i),o.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,o.prototype.dataChange=function(t){var n,i,o,a,s,u,c,l,f;if(!t)return this.resetStyles(),void 0;this.unbindCollection();{if("string"!=typeof t){if(t instanceof Batman.Hash)return this.bindCollection(t);t instanceof Batman.Object&&(t=t.toJSON()),this.resetStyles(),f=[];for(o in t)e.call(t,o)&&f.push(this.bindSingleAttribute(o,""+this.keyPath+"."+o));return f}for(this.resetStyles(),c=t.split(";"),s=0,u=c.length;u>s;s++)a=c[s],l=a.split(":"),i=l[0],n=2<=l.length?r.call(l,1):[],this.setStyle(i,n.join(":"))}},o.prototype.handleArrayChanged=function(){var t=this;return this.collection.forEach(function(e){return t.bindSingleAttribute(e,""+t.keyPath+"."+e)})},o.prototype.bindSingleAttribute=function(t,e){var n;return n=new Batman.DOM.AttrReaderBindingDefinition(this.node,t,e,this.renderContext,this.renderer),this.styleBindings[t]=new Batman.DOM.StyleBinding.SingleStyleBinding(n,this)},o.prototype.setStyle=function(t,e){return t=Batman.helpers.camelize(t.trim(),!0),null==this.oldStyles[t]&&(this.oldStyles[t]=this.node.style[t]||""),(null!=e?e.trim:void 0)&&(e=e.trim()),null==e&&(e=""),this.node.style[t]=e},o.prototype.resetStyles=function(){var t,n,r,i;r=this.oldStyles,i=[];for(t in r)e.call(r,t)&&(n=r[t],i.push(this.setStyle(t,n)));return i},o.prototype.resetBindings=function(){var t,e,n;n=this.styleBindings;for(t in n)e=n[t],e._fireDataChange(""),e.die();return this.styleBindings={}},o.prototype.unbindCollection=function(){return this.resetBindings(),o.__super__.unbindCollection.apply(this,arguments)},o.SingleStyleBinding=function(t){function e(t,n){this.parent=n,e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,e.prototype.isTwoWay=function(){return!1},e.prototype.dataChange=function(t){return this.parent.setStyle(this.attributeName,t)},e}(Batman.DOM.AbstractAttributeBinding),o}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.IteratorBinding=function(e){function r(e){this.handleArrayChanged=t(this.handleArrayChanged,this);var n,i,o=this;i=e.node,this.iteratorName=e.attr,this.key=e.keyPath,this.parentRenderer=e.renderer,this.nodeMap=new Batman.SimpleHash,this.rendererMap=new Batman.SimpleHash,this.prototypeNode=i.cloneNode(!0),this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),n=i.nextSibling,this.startNode=document.createComment("start "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode=document.createComment("end "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode[Batman.expando]=i[Batman.expando],Batman.canDeleteExpando&&delete i[Batman.expando],Batman.DOM.insertBefore(i.parentNode,this.startNode,n),Batman.DOM.insertBefore(i.parentNode,this.endNode,n),this.parentRenderer.prevent("rendered"),Batman.DOM.onParseExit(i.parentNode,function(){return Batman.DOM.destroyNode(i),o.bind(),o.parentRenderer.allowAndFire("rendered")}),e.node=this.endNode,r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.currentActionNumber=0,r.prototype.queuedActionNumber=0,r.prototype.bindImmediately=!1,r.prototype.skipChildren=!0,r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,r.prototype.parentNode=function(){return this.endNode.parentNode},r.prototype.dataChange=function(t){var e,n;return null==t?this.handleArrayChanged([]):this.bindCollection(t)?void 0:(e=(null!=t?t.forEach:void 0)?(n=[],t.forEach(function(t){return n.push(t)}),n):Object.keys(t),this.handleArrayChanged(e))},r.prototype.handleArrayChanged=function(t){var e,n,r,i,o,a,s,u,c,l,f=this;if(a=this.parentNode(),s=this._getStartNodeIndex()+1,u=this.nodeMap.merge(),t)for(n=c=0,l=t.length;l>c;n=++c)r=t[n],o=a.childNodes[s+n],null==o||this._itemForNode(o)!==r?(i=(e=this.nodeMap.get(r))?(u.unset(r),e):this._newNodeForItem(r),Batman.DOM.insertBefore(this.parentNode(),i,o)):u.unset(r);u.forEach(function(t,e){return f._nodesToBeRendered.has(e)?(f._nodesToBeRemoved||(f._nodesToBeRemoved=new Batman.SimpleSet),f._nodesToBeRemoved.add(e)):f._removeItem(t)})},r.prototype._itemForNode=function(t){return Batman._data(t,""+this.iteratorName+"Item")},r.prototype._newNodeForItem=function(t){var e,n,r=this;return e=this.prototypeNode.cloneNode(!0),this._nodesToBeRendered||(this._nodesToBeRendered=new Batman.SimpleSet),this._nodesToBeRendered.add(e),Batman._data(e,""+this.iteratorName+"Item",t),this.nodeMap.set(t,e),this.parentRenderer.prevent("rendered"),n=new Batman.Renderer(e,this.renderContext.descend(t,this.iteratorName),this.parentRenderer.view),n.once("rendered",function(){var n;return r._nodesToBeRendered.remove(e),(null!=(n=r._nodesToBeRemoved)?n.has(e):void 0)?(r._nodesToBeRemoved.remove(e),r._removeItem(t)):(Batman.DOM.propagateBindingEvents(e),r.fire("nodeAdded",e,t)),r.parentRenderer.allowAndFire("rendered")}),e},r.prototype._getStartNodeIndex=function(){var t,e,n,r,i;for(i=this.parentNode().childNodes,t=n=0,r=i.length;r>n;t=++n)if(e=i[t],e===this.startNode)return t;return 0},r.prototype._removeItem=function(t){var e;return e=this.nodeMap.unset(t),Batman.DOM.destroyNode(e),this.fire("nodeRemoved",e,t)},r.prototype.die=function(){var t;return this._nodesToBeRendered&&!this._nodesToBeRendered.isEmpty()&&(this._nodesToBeRemoved||(this._nodesToBeRemoved=new Batman.SimpleSet),(t=this._nodesToBeRemoved).add.apply(t,this._nodesToBeRendered.toArray())),r.__super__.die.apply(this,arguments)},r}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.ClassBinding=function(r){function i(){return this.handleArrayChanged=t(this.handleArrayChanged,this),i.__super__.constructor.apply(this,arguments)}return n(i,r),i.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,i.prototype.dataChange=function(t){return null!=t?(this.unbindCollection(),"string"==typeof t?this.node.className=t:(this.bindCollection(t),this.updateFromCollection())):void 0},i.prototype.updateFromCollection=function(){var t,n,r;return this.collection?(t=this.collection.map?this.collection.map(function(t){return t}):function(){var t,i;t=this.collection,i=[];for(n in t)e.call(t,n)&&(r=t[n],i.push(n));return i}.call(this),null!=t.toArray&&(t=t.toArray()),this.node.className=t.join(" ")):void 0},i.prototype.handleArrayChanged=function(){return this.updateFromCollection()},i}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ValidationError=function(t){function n(t,e){n.__super__.constructor.call(this,{attribute:t,message:e})}return e(n,t),n.accessor("fullMessage",function(){return Batman.t("errors.format",{attribute:Batman.helpers.humanize(this.attribute),message:this.message})}),n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.StorageAdapter=function(t){function r(t){var e;r.__super__.constructor.call(this,{model:t}),e=this.constructor,e.ModelMixin&&Batman.extend(t,e.ModelMixin),e.RecordMixin&&Batman.extend(t.prototype,e.RecordMixin)}return e(r,t),r.StorageError=function(t){function n(t){n.__super__.constructor.apply(this,arguments),this.message=t}return e(n,t),n.prototype.name="StorageError",n}(Error),r.RecordExistsError=function(t){function n(t){n.__super__.constructor.call(this,t||"Can't create this record because it already exists in the store!")}return e(n,t),n.prototype.name="RecordExistsError",n}(r.StorageError),r.NotFoundError=function(t){function n(t){n.__super__.constructor.call(this,t||"Record couldn't be found in storage!")}return e(n,t),n.prototype.name="NotFoundError",n}(r.StorageError),r.NotAllowedError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage operation denied access to the operation!")}return e(n,t),n.prototype.name="NotAllowedError",n}(r.StorageError),r.NotAcceptableError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage operation permitted but the request was malformed!")}return e(n,t),n.prototype.name="NotAcceptableError",n}(r.StorageError),r.UnprocessableRecordError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage adapter could not process the record!")}return e(n,t),n.prototype.name="UnprocessableRecordError",n}(r.StorageError),r.InternalStorageError=function(t){function n(t){n.__super__.constructor.call(this,t||"An error occured during the storage operation!")}return e(n,t),n.prototype.name="InternalStorageError",n}(r.StorageError),r.NotImplementedError=function(t){function n(t){n.__super__.constructor.call(this,t||"This operation is not implemented by the storage adpater!")}return e(n,t),n.prototype.name="NotImplementedError",n}(r.StorageError),r.prototype.isStorageAdapter=!0,r.prototype.storageKey=function(t){var e;return e=(null!=t?t.constructor:void 0)||this.model,e.get("storageKey")||Batman.helpers.pluralize(Batman.helpers.underscore(e.get("resourceName")))},r.prototype.getRecordFromData=function(t,e){var n;return null==e&&(e=this.model),n=new e,n._withoutDirtyTracking(function(){return this.fromJSON(t)}),n},r.skipIfError=function(t){return function(e,n){return null!=e.error?n():t.call(this,e,n)}},r.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(n.call(arguments)))},r.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(n.call(arguments)))},r.prototype._inheritFilters=function(){var t,e,n,r,i,o;if(!(this._batman.check(this)&&this._batman.filters||(r=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}},null==r))){o=[];for(i in r)t=r[i],o.push(function(){var r;r=[];for(n in t)e=t[n],r.push(this._batman.filters[i][n]=e.slice(0));return r}.call(this));return o}},r.prototype._addFilter=function(){var t,e,r,i,o,a,s,u;for(i=arguments[0],r=3<=arguments.length?n.call(arguments,1,a=arguments.length-1):(a=1,[]),t=arguments[a++],this._inheritFilters(),s=0,u=r.length;u>s;s++)e=r[s],(o=this._batman.filters[i])[e]||(o[e]=[]),this._batman.filters[i][e].push(t);return!0},r.prototype.runFilter=function(t,e,n,r){var i,o,a,s,u=this;return this._inheritFilters(),o=this._batman.filters[t].all||[],i=this._batman.filters[t][e]||[],n.action=e,a="before"===t?i.concat(o):o.concat(i),s=function(t){var e;return null!=t&&(n=t),null!=(e=a.shift())?e.call(u,n,s):r.call(u,n)},s()},r.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(n.call(arguments)))},r.prototype.runAfterFilter=function(t,e,n){return this.runFilter("after",t,e,this.exportResult(n))},r.prototype.exportResult=function(t){return function(e){return t(e.error,e.result,e)}},r.prototype._jsonToAttributes=function(t){return JSON.parse(t)},r.prototype.perform=function(t,e,n,r){var i,o,a=this;return n||(n={}),i={options:n,subject:e},o=function(e){return null!=e&&(i=e),a.runAfterFilter(t,i,r)},this.runBeforeFilter(t,i,function(e){return this[t](e,o)}),void 0},r}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice,r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.RestStorage=function(t){function i(){i.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=Batman.extend({},this.defaultRequestOptions)}var o,a,s,u,c;for(e(i,t),i.CommunicationError=function(t){function n(t){n.__super__.constructor.call(this,t||"A communication error has occurred!")}return e(n,t),n.prototype.name="CommunicationError",n}(i.StorageError),i.JSONContentType="application/json",i.PostBodyContentType="application/x-www-form-urlencoded",i.BaseMixin={request:function(t,e,n){return n||(n=e,e={}),e.method||(e.method="GET"),e.action=t,this._doStorageOperation(e.method.toLowerCase(),e,n)}},i.ModelMixin=Batman.extend({},i.BaseMixin,{urlNestsUnder:function(){var t,e,r,i,o;for(e=1<=arguments.length?n.call(arguments,0):[],r={},i=0,o=e.length;o>i;i++)t=e[i],r[t+"_id"]=Batman.helpers.pluralize(t);return this.url=function(e){var n,i,o;n=Batman.helpers.pluralize(this.get("resourceName").toLowerCase());for(t in r)if(o=r[t],i=e.data[t])return delete e.data[t],""+o+"/"+i+"/"+n;return n},this.prototype.url=function(){var e,n,i,o,a;e=Batman.helpers.pluralize(this.constructor.get("resourceName").toLowerCase());for(t in r)if(o=r[t],i=this.get("dirtyKeys").get(t),void 0===i&&(i=this.get(t)),i){a=""+o+"/"+i+"/"+e;break}return a||(a=e),(n=this.get("id"))&&(a+="/"+n),a}}}),i.RecordMixin=Batman.extend({},i.BaseMixin),i.prototype.defaultRequestOptions={type:"json"},i.prototype._implicitActionNames=["create","read","update","destroy","readAll"],i.prototype.serializeAsForm=!0,i.prototype.recordJsonNamespace=function(t){return Batman.helpers.singularize(this.storageKey(t))},i.prototype.collectionJsonNamespace=function(t){return Batman.helpers.pluralize(this.storageKey(t.prototype))},i.prototype._execWithOptions=function(t,e,n,r){return null==r&&(r=t),"function"==typeof t[e]?t[e].call(r,n):t[e]},i.prototype._defaultCollectionUrl=function(t){return""+this.storageKey(t.prototype)},i.prototype._addParams=function(t,e){var n;return!e||!e.action||(n=e.action,r.call(this._implicitActionNames,n)>=0)||(t+="/"+e.action.toLowerCase()),t},i.prototype._addUrlAffixes=function(t,e,n){var r,i;return i=[t,this.urlSuffix(e,n)],"/"!==t.charAt(0)&&(r=this.urlPrefix(e,n),"/"!==r.charAt(r.length-1)&&i.unshift("/"),i.unshift(r)),i.join("")},i.prototype.urlPrefix=function(t,e){return this._execWithOptions(t,"urlPrefix",e.options)||""},i.prototype.urlSuffix=function(t,e){return this._execWithOptions(t,"urlSuffix",e.options)||""},i.prototype.urlForRecord=function(t,e){var n,r,i;if(null!=(i=e.options)?i.recordUrl:void 0)r=this._execWithOptions(e.options,"recordUrl",e.options,t);else if(t.url)r=this._execWithOptions(t,"url",e.options);else if(r=t.constructor.url?this._execWithOptions(t.constructor,"url",e.options):this._defaultCollectionUrl(t.constructor),"create"!==e.action){if(null==(n=t.get("id")))throw new this.constructor.StorageError("Couldn't get/set record primary key on "+e.action+"!");r=r+"/"+n}return this._addUrlAffixes(this._addParams(r,e.options),t,e)},i.prototype.urlForCollection=function(t,e){var n,r;return n=(null!=(r=e.options)?r.collectionUrl:void 0)?this._execWithOptions(e.options,"collectionUrl",e.options,e.options.urlContext):t.url?this._execWithOptions(t,"url",e.options):this._defaultCollectionUrl(t,e.options),this._addUrlAffixes(this._addParams(n,e.options),t,e)},i.prototype.request=function(t,e){var n;return n=Batman.extend(t.options,{autosend:!1,success:function(e){return t.data=e},error:function(e){return t.error=e},loaded:function(){return t.response=t.request.get("response"),e()}}),t.request=new Batman.Request(n),t.request.send()},i.prototype.perform=function(t,e,n,r){return n||(n={}),Batman.extend(n,this.defaultRequestOptions),i.__super__.perform.call(this,t,e,n,r)},i.prototype.before("all",i.skipIfError(function(t,e){if(!t.options.url)try{t.options.url=t.subject.prototype?this.urlForCollection(t.subject,t):this.urlForRecord(t.subject,t)}catch(n){t.error=n}return e()})),i.prototype.before("get","put","post","delete",i.skipIfError(function(t,e){return t.options.method=t.action.toUpperCase(),e()})),i.prototype.before("create","update",i.skipIfError(function(t,e){var n,r,i;return r=t.subject.toJSON(),(i=this.recordJsonNamespace(t.subject))?(n={},n[i]=r):n=r,t.options.data=n,e()})),i.prototype.before("create","update","put","post",i.skipIfError(function(t,e){return this.serializeAsForm?t.options.contentType=this.constructor.PostBodyContentType:null!=t.options.data&&(t.options.data=JSON.stringify(t.options.data),t.options.contentType=this.constructor.JSONContentType),e()})),i.prototype.after("all",i.skipIfError(function(t,e){var n;if(null==t.data)return e();if("string"==typeof t.data){if(t.data.length>0)try{n=this._jsonToAttributes(t.data)}catch(r){return t.error=r,e()}}else"object"==typeof t.data&&(n=t.data);return null!=n&&(t.json=n),e()})),i.prototype.extractFromNamespace=function(t,e){return e&&null!=t[e]?t[e]:t},i.prototype.after("create","read","update",i.skipIfError(function(t,e){var n;return null!=t.json&&(n=this.extractFromNamespace(t.json,this.recordJsonNamespace(t.subject)),t.subject._withoutDirtyTracking(function(){return this.fromJSON(n)})),t.result=t.subject,e()})),i.prototype.after("readAll",i.skipIfError(function(t,e){var n,r;return r=this.collectionJsonNamespace(t.subject),t.recordsAttributes=this.extractFromNamespace(t.json,r),"Array"!==Batman.typeOf(t.recordsAttributes)&&(r=this.recordJsonNamespace(t.subject.prototype),t.recordsAttributes=[this.extractFromNamespace(t.json,r)]),t.result=t.records=function(){var e,r,i,o;
for(i=t.recordsAttributes,o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(this.getRecordFromData(n,t.subject));return o}.call(this),e()})),i.prototype.after("get","put","post","delete",i.skipIfError(function(t,e){var n,r;return null!=t.json&&(n=t.json,r=t.subject.prototype?this.collectionJsonNamespace(t.subject):this.recordJsonNamespace(t.subject),t.result=r&&null!=t.json[r]?t.json[r]:t.json),e()})),i.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},c=["create","read","update","destroy","readAll","get","post","put","delete"],a=function(t){return i.prototype[t]=i.skipIfError(function(e,n){var r;return(r=e.options).method||(r.method=this.constructor.HTTPMethods[t]),this.request(e,n)})},s=0,u=c.length;u>s;s++)o=c[s],a(o);return i.prototype.after("all",function(t,e){return t.error&&(t.error=this._errorFor(t.error,t)),e()}),i._statusCodeErrors={0:i.CommunicationError,403:i.NotAllowedError,404:i.NotFoundError,406:i.NotAcceptableError,409:i.RecordExistsError,422:i.UnprocessableRecordError,500:i.InternalStorageError,501:i.NotImplementedError},i.prototype._errorFor=function(t,e){var n,r;return t instanceof Error||null==t.request?t:((n=this.constructor._statusCodeErrors[t.request.status])&&(r=t.request,t=new n,t.request=r,t.env=e),t)},i}.call(this,Batman.StorageAdapter)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.LocalStorage=function(t){function n(){return"undefined"==typeof window.localStorage?null:(n.__super__.constructor.apply(this,arguments),this.storage=localStorage,void 0)}return e(n,t),n.prototype.storageRegExpForRecord=function(t){return new RegExp("^"+this.storageKey(t)+"(\\d+)$")},n.prototype.nextIdForRecord=function(t){var e,n;return n=this.storageRegExpForRecord(t),e=1,this._forAllStorageEntries(function(t){var r;return(r=n.exec(t))?e=Math.max(e,parseInt(r[1],10)+1):void 0}),e},n.prototype._forAllStorageEntries=function(t){var e,n,r,i;for(e=r=0,i=this.storage.length;i>=0?i>r:r>i;e=i>=0?++r:--r)n=this.storage.key(e),t.call(this,n,this.storage.getItem(n));return!0},n.prototype._storageEntriesMatching=function(t,e){var n,r;return n=this.storageRegExpForRecord(t.prototype),r=[],this._forAllStorageEntries(function(i,o){var a,s;return(s=n.exec(i))&&(a=this._jsonToAttributes(o),a[t.primaryKey]=s[1],this._dataMatches(e,a))?r.push(a):void 0}),r},n.prototype._dataMatches=function(t,e){var n,r,i;r=!0;for(n in t)if(i=t[n],e[n]!==i){r=!1;break}return r},n.prototype.before("read","create","update","destroy",n.skipIfError(function(t,e){var n=this;return t.id="create"===t.action?t.subject.get("id")||t.subject._withoutDirtyTracking(function(){return t.subject.set("id",n.nextIdForRecord(t.subject))}):t.subject.get("id"),null==t.id?t.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+t.action+"!"):t.key=this.storageKey(t.subject)+t.id,e()})),n.prototype.before("create","update",n.skipIfError(function(t,e){return t.recordAttributes=JSON.stringify(t.subject),e()})),n.prototype.after("read",n.skipIfError(function(t,e){if("string"==typeof t.recordAttributes)try{t.recordAttributes=this._jsonToAttributes(t.recordAttributes)}catch(n){return t.error=n,e()}return t.subject._withoutDirtyTracking(function(){return this.fromJSON(t.recordAttributes)}),e()})),n.prototype.after("read","create","update","destroy",n.skipIfError(function(t,e){return t.result=t.subject,e()})),n.prototype.after("readAll",n.skipIfError(function(t,e){var n;return t.result=t.records=function(){var e,r,i,o;for(i=t.recordsAttributes,o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(this.getRecordFromData(n,t.subject));return o}.call(this),e()})),n.prototype.read=n.skipIfError(function(t,e){return t.recordAttributes=this.storage.getItem(t.key),t.recordAttributes||(t.error=new this.constructor.NotFoundError),e()}),n.prototype.create=n.skipIfError(function(t,e){var n,r;return n=t.key,r=t.recordAttributes,this.storage.getItem(n)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(n,r),e()}),n.prototype.update=n.skipIfError(function(t,e){var n,r;return n=t.key,r=t.recordAttributes,this.storage.setItem(n,r),e()}),n.prototype.destroy=n.skipIfError(function(t,e){var n;return n=t.key,this.storage.removeItem(n),e()}),n.prototype.readAll=n.skipIfError(function(t,e){try{arguments[0].recordsAttributes=this._storageEntriesMatching(t.subject,t.options.data)}catch(n){arguments[0].error=n}return e()}),n}(Batman.StorageAdapter)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SessionStorage=function(t){function n(){return"undefined"==typeof window.sessionStorage?null:(n.__super__.constructor.apply(this,arguments),this.storage=sessionStorage,void 0)}return e(n,t),n}(Batman.LocalStorage)}.call(this),function(){Batman.Encoders=new Batman.Object}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ParamsReplacer=function(t){function n(t,e){this.navigator=t,this.params=e}return e(n,t),n.prototype.redirect=function(){return this.navigator.replace(this.toObject())},n.prototype.replace=function(t){return this.params.replace(t),this.redirect()},n.prototype.update=function(t){return this.params.update(t),this.redirect()},n.prototype.clear=function(){return this.params.clear(),this.redirect()},n.prototype.toObject=function(){return this.params.toObject()},n.accessor({get:function(t){return this.params.get(t)},set:function(t,e){var n,r;return n=this.params.get(t),r=this.params.set(t,e),n!==e&&this.redirect(),r},unset:function(t){var e,n;return e=this.params.hasKey(t),n=this.params.unset(t),e&&this.redirect(),n}}),n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ParamsPusher=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.redirect=function(){return this.navigator.push(this.toObject())},n}(Batman.ParamsReplacer)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.NamedRouteQuery=function(t){function n(t,e){var r;null==e&&(e=[]),n.__super__.constructor.call(this,{routeMap:t,args:e});for(r in this.get("routeMap").childrenByName)this[r]=this._queryAccess.bind(this,r)}return e(n,t),n.prototype.isNamedRouteQuery=!0,n.accessor("route",function(){var t,e,n,r,i,o,a;for(o=this.get("routeMap"),e=o.memberRoute,t=o.collectionRoute,a=[e,t],r=0,i=a.length;i>r;r++)if(n=a[r],null!=n&&n.namedArguments.length===this.get("args").length)return n;return t||e}),n.accessor("path",function(){return this.path()}),n.accessor("routeMap","args","cardinality","hashValue",Batman.Property.defaultAccessor),n.accessor({get:function(t){return null!=t?"string"==typeof t?this.nextQueryForName(t):this.nextQueryWithArgument(t):void 0},cache:!1}),n.accessor("withHash",function(){var t=this;return new Batman.Accessible(function(e){return t.withHash(e)})}),n.prototype.withHash=function(t){var e;return e=this.clone(),e.set("hashValue",t),e},n.prototype.nextQueryForName=function(t){var e;return(e=this.get("routeMap").childrenByName[t])?new Batman.NamedRouteQuery(e,this.args):Batman.developer.error("Couldn't find a route for the name "+t+"!")},n.prototype.nextQueryWithArgument=function(t){var e;return e=this.args.slice(0),e.push(t),this.clone(e)},n.prototype.path=function(){var t,e,n,r,i,o,a;for(i={},r=this.get("route.namedArguments"),n=o=0,a=r.length;a>o;n=++o)t=r[n],null!=(e=this.get("args")[n])&&(i[t]=this._toParam(e));return null!=this.get("hashValue")&&(i["#"]=this.get("hashValue")),this.get("route").pathFromParams(i)},n.prototype.toString=function(){return this.path()},n.prototype.clone=function(t){return null==t&&(t=this.args),new Batman.NamedRouteQuery(this.routeMap,t)},n.prototype._toParam=function(t){return t instanceof Batman.AssociationProxy&&(t=t.get("target")),null!=(null!=t?t.toParam:void 0)?t.toParam():t},n.prototype._queryAccess=function(t,e){var n;return n=this.nextQueryForName(t),null!=e&&(n=n.nextQueryWithArgument(e)),n},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Dispatcher=function(t){function n(t,e){n.__super__.constructor.call(this,{app:t,routeMap:e})}var r;return e(n,t),n.canInferRoute=function(t){return t instanceof Batman.Model||t instanceof Batman.AssociationProxy||t.prototype instanceof Batman.Model},n.paramsFromArgument=function(t){var e;return e=function(t){return Batman.helpers.camelize(Batman.helpers.pluralize(t.get("resourceName")),!0)},this.canInferRoute(t)?t instanceof Batman.Model||t instanceof Batman.AssociationProxy?(t.isProxy&&(t=t.get("target")),null!=t?{controller:e(t.constructor),action:"show",id:t.get("id")}:{}):t.prototype instanceof Batman.Model?{controller:e(t),action:"index"}:t:t},r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor("__app",Batman.Property.defaultAccessor),n.accessor(function(t){return this.get("__app."+Batman.helpers.capitalize(t)+"Controller.sharedController")}),n}(Batman.Object),n.accessor("controllers",function(){return new r({__app:this.get("app")})}),n.prototype.routeForParams=function(t){return t=this.constructor.paramsFromArgument(t),this.get("routeMap").routeForParams(t)},n.prototype.pathFromParams=function(t){var e;return"string"==typeof t?t:(t=this.constructor.paramsFromArgument(t),null!=(e=this.routeForParams(t))?e.pathFromParams(t):void 0)},n.prototype.dispatch=function(t){var e,n,r,i,o,a;if(n=this.constructor.paramsFromArgument(t),i=this.routeForParams(n))o=i.pathAndParamsFromArgument(n),r=o[0],t=o[1],this.set("app.currentRoute",i),this.set("app.currentURL",r),this.get("app.currentParams").replace(t||{}),i.dispatch(t);else{if("Object"===Batman.typeOf(t)&&!this.constructor.canInferRoute(t))return this.get("app.currentParams").replace(t);if(this.get("app.currentParams").clear(),e={type:"404",isPrevented:!1,preventDefault:function(){return this.isPrevented=!0}},null!=(a=Batman.currentApp)&&a.fire("error",e),e.isPrevented)return t;if("/404"!==t)return Batman.redirect("/404")}return r},n}.call(this,Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Route=function(t){function n(t,e){var r,i,o,a,s,u,c,l,f,p;for(c=this.constructor.regexps,0!==t.indexOf("/")&&(t="/"+t),a=t.replace(c.escapeRegExp,"\\$&"),u=RegExp("^"+a.replace(c.openOptParam,"(?:").replace(c.closeOptParam,")?").replace(c.namedParam,"([^/]+)").replace(c.splatParam,"(.*?)")+c.queryParam+"$"),c.namedOrSplat.lastIndex=0,o=function(){var t;for(t=[];i=c.namedOrSplat.exec(a);)t.push(i[1]);return t}(),s={templatePath:t,pattern:a,regexp:u,namedArguments:o,baseParams:e},p=this.optionKeys,l=0,f=p.length;f>l;l++)r=p[l],s[r]=e[r],delete e[r];n.__super__.constructor.call(this,s)}return e(n,t),n.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}+?.,\\^$|#\s]/g,openOptParam:/\(/g,closeOptParam:/\)/g},n.prototype.optionKeys=["member","collection"],n.prototype.testKeys=["controller","action"],n.prototype.isRoute=!0,n.prototype.paramsFromPath=function(t){var e,n,r,i,o,a,s,u,c;for(s=new Batman.URI(t),o=this.get("namedArguments"),a=Batman.extend({path:s.path},this.get("baseParams")),r=this.get("regexp").exec(s.path).slice(1),e=u=0,c=r.length;c>u;e=++u)n=r[e],i=o[e],a[i]=n;return Batman.extend(a,s.queryParams)},n.prototype.pathFromParams=function(t){var e,n,r,i,o,a,s,u,c,l,f,p,h,d,g;for(o=Batman.extend({},t),a=this.get("templatePath"),c=this.constructor.regexps,d=this.get("namedArguments"),l=0,p=d.length;p>l;l++)r=d[l],u=RegExp(""+c.namePrefix+r),i=a.replace(u,null!=o[r]?o[r]:""),i!==a&&(delete o[r],a=i);for(a=a.replace(c.openOptParam,"").replace(c.closeOptParam,"").replace(/([^\/])\/+$/,"$1"),g=this.testKeys,f=0,h=g.length;h>f;f++)n=g[f],delete o[n];return o["#"]&&(e=o["#"],delete o["#"]),s=Batman.URI.queryFromParams(o),s&&(a+="?"+s),e&&(a+="#"+e),a},n.prototype.test=function(t){var e,n,r,i,o,a;if("string"==typeof t)n=t;else if(null!=t.path)n=t.path;else for(n=this.pathFromParams(t),a=this.testKeys,i=0,o=a.length;o>i;i++)if(e=a[i],null!=(r=this.get(e))&&t[e]!==r)return!1;return this.get("regexp").test(n)},n.prototype.pathAndParamsFromArgument=function(t){var e,n;return"string"==typeof t?(e=this.paramsFromPath(t),n=t):(e=t,n=this.pathFromParams(t)),[n,e]},n.prototype.dispatch=function(t){return this.test(t)?this.get("callback")(t):!1},n.prototype.callback=function(){throw new Batman.DevelopmentError("Override callback in a Route subclass")},n}(Batman.Object)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ControllerActionRoute=function(e){function r(e,n){this.callback=t(this.callback,this);var i,o,a;n.signature&&(a=n.signature.split("#"),o=a[0],i=a[1],i||(i="index"),n.controller=o,n.action=i,delete n.signature),r.__super__.constructor.call(this,e,n)}return n(r,e),r.prototype.optionKeys=["member","collection","app","controller","action"],r.prototype.callback=function(t){var e;return e=this.get("app.dispatcher.controllers."+this.get("controller")),e.dispatch(this.get("action"),t)},r}(Batman.Route)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.CallbackActionRoute=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.optionKeys=["member","collection","callback","app"],n.prototype.controller=!1,n.prototype.action=!1,n}(Batman.Route)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.Hash=function(t){function r(){this.meta=new this.constructor.Metadata(this),Batman.SimpleHash.apply(this,arguments),r.__super__.constructor.apply(this,arguments)}var i,o,a,s,u,c,l,f;for(e(r,t),r.Metadata=function(t){function n(t){this.hash=t}return e(n,t),Batman.extend(n.prototype,Batman.Enumerable),n.accessor("length",function(){return this.hash.registerAsMutableSource(),this.hash.length}),n.accessor("isEmpty","keys","toArray",function(t){return this.hash.registerAsMutableSource(),this.hash[t]()}),n.prototype.forEach=function(){var t;return(t=this.hash).forEach.apply(t,arguments)},n}(Batman.Object),Batman.extend(r.prototype,Batman.Enumerable),r.prototype.propertyClass=Batman.Property,r.defaultAccessor={get:Batman.SimpleHash.prototype.get,set:r.mutation(function(t,e){var n;return n=Batman.SimpleHash.prototype.set.call(this,t,e),this.fire("itemsWereAdded",t),n}),unset:r.mutation(function(t){var e;return e=Batman.SimpleHash.prototype.unset.call(this,t),null!=e&&this.fire("itemsWereRemoved",t),e}),cache:!1},r.accessor(r.defaultAccessor),r.prototype._preventMutationEvents=function(t){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereRemoved");try{return t.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereRemoved")}},r.prototype.clear=r.mutation(function(){var t,e;return t=this.keys(),this._preventMutationEvents(function(){var t=this;return this.forEach(function(e){return t.unset(e)})}),e=Batman.SimpleHash.prototype.clear.call(this),this.fire.apply(this,["itemsWereRemoved"].concat(n.call(t))),e}),r.prototype.update=r.mutation(function(t){var e;return e=[],this._preventMutationEvents(function(){var n=this;return Batman.forEach(t,function(t,r){return n.hasKey(t)||e.push(t),n.set(t,r)})}),e.length>0?this.fire.apply(this,["itemsWereAdded"].concat(n.call(e))):void 0}),r.prototype.replace=r.mutation(function(t){var e,r;return e=[],r=[],this._preventMutationEvents(function(){var n=this;return this.forEach(function(e){return Batman.objectHasKey(t,e)?void 0:(n.unset(e),r.push(e))}),Batman.forEach(t,function(t,r){return n.hasKey(t)||e.push(t),n.set(t,r)})}),e.length>0&&this.fire.apply(this,["itemsWereAdded"].concat(n.call(e))),r.length>0?this.fire.apply(this,["itemsWereRemoved"].concat(n.call(r))):void 0}),l=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"],a=0,u=l.length;u>a;a++)i=l[a],r.prototype[i]=Batman.SimpleHash.prototype[i];for(f=["hasKey","forEach","isEmpty","keys","toArray","merge","toJSON","toObject"],o=function(t){return r.prototype[t]=function(){return this.registerAsMutableSource(),Batman.SimpleHash.prototype[t].apply(this,arguments)}},s=0,c=f.length;c>s;s++)i=f[s],o(i);return r}.call(this,Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RenderCache=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.keyQueue=[]}return e(n,t),n.prototype.maximumLength=4,n.prototype.viewForOptions=function(t){var e=this;return t.cache===!1||t.viewClass.prototype.cache===!1?this._newViewFromOptions(t):this.getOrSet(t,function(){return e._newViewFromOptions(Batman.extend({},t))})},n.prototype._newViewFromOptions=function(t){return new t.viewClass(t)},n.wrapAccessor(function(t){return{cache:!1,get:function(e){var n;return n=t.get.call(this,e),n&&this._addOrBubbleKey(e),n},set:function(e){var n;return n=t.set.apply(this,arguments),n.set("cached",!0),this._addOrBubbleKey(e),this._evictExpiredKeys(),n},unset:function(e){var n;return n=t.unset.apply(this,arguments),n.set("cached",!1),this._removeKeyFromQueue(e),n}}}),n.prototype.equality=function(t,e){var n;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(n in t)if("view"!==n&&t[n]!==e[n])return!1;return!0},n.prototype.reset=function(){var t,e,n,r,i;for(r=this.keyQueue.slice(0),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(this.unset(t));return i},n.prototype._addOrBubbleKey=function(t){return this._removeKeyFromQueue(t),this.keyQueue.unshift(t)},n.prototype._removeKeyFromQueue=function(t){var e,n,r,i,o;for(o=this.keyQueue,e=r=0,i=o.length;i>r;e=++r)if(n=o[e],this.equality(n,t)){this.keyQueue.splice(e,1);break}return t},n.prototype._evictExpiredKeys=function(){var t,e,n,r,i,o;if(this.length>this.maximumLength)for(t=this.keyQueue.slice(0),e=r=i=this.maximumLength,o=t.length;o>=i?o>r:r>o;e=o>=i?++r:--r)n=t[e],this.get(n).isInDOM()||this.unset(n)},n}(Batman.Hash)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice,i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.Controller=function(e){function o(){this.redirect=t(this.redirect,this),this.handleError=t(this.handleError,this),this.errorHandler=t(this.errorHandler,this),o.__super__.constructor.apply(this,arguments),this._resetActionFrames()}var a;return n(o,e),o.singleton("sharedController"),o.wrapAccessor("routingKey",function(){return{get:function(){return null!=this.routingKey?this.routingKey:(Batman.config.minificationErrors&&Batman.developer.error("Please define `routingKey` on the prototype of "+Batman.functionName(this.constructor)+" in order for your controller to be minification safe."),Batman.functionName(this.constructor).replace(/Controller$/,""))}}}),o.accessor("_renderContext",function(){return Batman.RenderContext.root().descend(this)}),a=function(t,e){return e?"string"==typeof t?t={only:[t]}:(t.only&&"Array"!==Batman.typeOf(t.only)&&(t.only=[t.only]),t.except&&"Array"!==Batman.typeOf(t.except)&&(t.except=[t.except])):(e=t,t={}),t.block=e,t},o.beforeFilter=function(){var t,e,n;return Batman.initializeObject(this),e=a.apply(null,arguments),t=(n=this._batman).beforeFilters||(n.beforeFilters=[]),t.push(e)},o.afterFilter=function(){var t,e,n;return Batman.initializeObject(this),e=a.apply(null,arguments),t=(n=this._batman).afterFilters||(n.afterFilters=[]),t.push(e)},o.afterFilter(function(t){return this.autoScrollToHash&&null!=t["#"]?this.scrollToHash(t["#"]):void 0}),o.catchError=function(){var t,e,n,i,o,a,s,u,c,l;for(n=2<=arguments.length?r.call(arguments,0,s=arguments.length-1):(s=0,[]),o=arguments[s++],Batman.initializeObject(this),(a=this._batman).errorHandlers||(a.errorHandlers=new Batman.SimpleHash),i="Array"===Batman.typeOf(o["with"])?o["with"]:[o["with"]],l=[],u=0,c=n.length;c>u;u++)e=n[u],t=this._batman.errorHandlers.get(e)||[],l.push(this._batman.errorHandlers.set(e,t.concat(i)));return l},o.prototype.errorHandler=function(t){var e,n,r=this;return e=null!=(n=this._actionFrames)?n[this._actionFrames.length-1]:void 0,function(n,i,o){if(!n)return"function"==typeof t?t(i,o):void 0;if((null!=e?!e.error:!0)&&(null!=e&&(e.error=n),!r.handleError(n)))throw n}},o.prototype.handleError=function(t){var e,n,r=this;return e=!1,null!=(n=this.constructor._batman.getAll("errorHandlers"))&&n.forEach(function(n){return n.forEach(function(n,i){var o,a,s,u;if(t instanceof n){for(e=!0,u=[],a=0,s=i.length;s>a;a++)o=i[a],u.push(o.call(r,t));return u}})}),e},o.prototype.renderCache=new Batman.RenderCache,o.prototype.defaultRenderYield="main",o.prototype.autoScrollToHash=!0,o.prototype.dispatch=function(t,e){var n;return null==e&&(e={}),e.controller||(e.controller=this.get("routingKey")),e.action||(e.action=t),e.target||(e.target=this),this._resetActionFrames(),this.set("action",t),this.set("params",e),Batman.DOM.Yield.cycleAll(),this.executeAction(t,e),Batman.DOM.Yield.clearAllStale(),n=this._afterFilterRedirect,delete this._afterFilterRedirect,n?Batman.redirect(n):void 0},o.prototype.executeAction=function(t,e){var n,r,i,o,a,s,u=this;return null==e&&(e=this.get("params")),Batman.developer.assert(this[t],"Error! Controller action "+this.get("routingKey")+"."+t+" couldn't be found!"),i=this._actionFrames[this._actionFrames.length-1],n=new Batman.ControllerActionFrame({parentFrame:i,action:t},function(){var n;return u._afterFilterRedirect||u._runFilters(t,e,"afterFilters"),u._resetActionFrames(),null!=(n=Batman.navigator)?n.redirect=r:void 0}),this._actionFrames.push(n),n.startOperation({internal:!0}),r=null!=(a=Batman.navigator)?a.redirect:void 0,null!=(s=Batman.navigator)&&(s.redirect=this.redirect),this._runFilters(t,e,"beforeFilters"),this._afterFilterRedirect||(o=this[t](e)),n.operationOccurred||this.render(),n.finishOperation(),o},o.prototype.redirect=function(t){var e;return e=this._actionFrames[this._actionFrames.length-1],e?(e.operationOccurred&&Batman.developer.warn("Warning! Trying to redirect but an action has already been taken during "+this.get("routingKey")+"."+(e.action||this.get("action"))),e.startAndFinishOperation(),null!=this._afterFilterRedirect?Batman.developer.warn("Warning! Multiple actions trying to redirect!"):this._afterFilterRedirect=t):("Object"===Batman.typeOf(t)&&(t.controller||(t.controller=this)),Batman.redirect(t))},o.prototype.render=function(t){var e,n,r,i,o;return null==t&&(t={}),(n=null!=(i=this._actionFrames)?i[this._actionFrames.length-1]:void 0)&&n.startOperation(),t===!1?(n.finishOperation(),void 0):(e=(null!=n?n.action:void 0)||this.get("action"),t&&(t.into||(t.into=this.defaultRenderYield)),t.view?(r=t.view,t.view=null):(t.viewClass||(t.viewClass=this._viewClassForAction(e)),t.context||(t.context=this.get("_renderContext")),t.source||(t.source=Batman.helpers.underscore(this.get("routingKey")+"/"+e)),r=this.renderCache.viewForOptions(t)),r&&(null!=(o=Batman.currentApp)&&o.prevent("ready"),r.once("ready",function(){var e;return Batman.DOM.Yield.withName(t.into).replace(r.get("node")),null!=(e=Batman.currentApp)&&e.allowAndFire("ready"),null!=n?n.finishOperation():void 0})),r)},o.prototype.scrollToHash=function(t){return null==t&&(t=this.get("params")["#"]),Batman.DOM.scrollIntoView(t)},o.prototype._resetActionFrames=function(){return this._actionFrames=[]},o.prototype._viewClassForAction=function(t){var e,n;return e=this.get("routingKey").replace("/","_"),(null!=(n=Batman.currentApp)?n[Batman.helpers.camelize(""+e+"_"+t+"_view")]:void 0)||Batman.View},o.prototype._runFilters=function(t,e,n){var r,o,a,s,u;if(n=null!=(u=this.constructor._batman)?u.get(n):void 0)for(a=0,s=n.length;s>a;a++)if(o=n[a],!(o.only&&i.call(o.only,t)<0||o.except&&i.call(o.except,t)>=0)){if(this._afterFilterRedirect)return;r=o.block,"function"==typeof r?r.call(this,e):"function"==typeof this[r]&&this[r](e)}},o}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Set=function(t){function n(){Batman.SimpleSet.apply(this,arguments)}var r,i,o,a,s,u,c,l;for(e(n,t),Batman.extend(n.prototype,Batman.Enumerable),n._applySetAccessors=function(t){var e,n,r,i;n={first:function(){return this.toArray()[0]},last:function(){return this.toArray()[this.length-1]},isEmpty:function(){return this.isEmpty()},toArray:function(){return this.toArray()},length:function(){return this.registerAsMutableSource(),this.length},indexedBy:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.indexedBy(e)})},indexedByUnique:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.indexedByUnique(e)})},sortedBy:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.sortedBy(e)})},sortedByDescending:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.sortedBy(e,"desc")})}},i=[];for(r in n)e=n[r],i.push(t.accessor(r,e));return i},n._applySetAccessors(n),c=["add","remove","clear","replace","indexedBy","indexedByUnique","sortedBy","equality","_indexOfItem"],o=0,s=c.length;s>o;o++)r=c[o],n.prototype[r]=Batman.SimpleSet.prototype[r];for(l=["find","merge","forEach","toArray","isEmpty","has"],i=function(t){return n.prototype[t]=function(){return this.registerAsMutableSource(),Batman.SimpleSet.prototype[t].apply(this,arguments)}},a=0,u=l.length;u>a;a++)r=l[a],i(r);return n.prototype.toJSON=n.prototype.toArray,n}.call(this,Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ErrorsSet=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor(function(t){return this.indexedBy("attribute").get(t)}),n.prototype.add=function(t,e){return n.__super__.add.call(this,new Batman.ValidationError(t,e))},n}(Batman.Set)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.SetProxy=function(t){function r(t){var e=this;this.base=t,r.__super__.constructor.call(this),this.length=this.base.length,this.base.on("itemsWereAdded",function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.set("length",e.base.length),e.fire.apply(e,["itemsWereAdded"].concat(n.call(t)))}),this.base.on("itemsWereRemoved",function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.set("length",e.base.length),e.fire.apply(e,["itemsWereRemoved"].concat(n.call(t)))})}var i,o,a,s,u;for(e(r,t),Batman.extend(r.prototype,Batman.Enumerable),r.prototype.filter=function(t){return this.reduce(function(e,n){return t(n)&&e.add(n),e},new Batman.Set)},r.prototype.replace=function(){var t,e;return t=this.property("length"),t.isolate(),e=this.base.replace.apply(this,arguments),t.expose(),e},Batman.Set._applySetAccessors(r),u=["add","remove","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"],o=function(t){return r.prototype[t]=function(){var e;return(e=this.base)[t].apply(e,arguments)}},a=0,s=u.length;s>a;a++)i=u[a],o(i);return r.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(t,e){return this.length=e}}),r}.call(this,Batman.Object)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.BinarySetOperation=function(e){function i(e,n){this.left=e,this.right=n,this._setup=t(this._setup,this),i.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}return n(i,e),i.prototype._setup=function(t,e){var n=this;return t.on("itemsWereAdded",function(){var i;return i=1<=arguments.length?r.call(arguments,0):[],n._itemsWereAddedToSource.apply(n,[t,e].concat(r.call(i)))}),t.on("itemsWereRemoved",function(){var i;return i=1<=arguments.length?r.call(arguments,0):[],n._itemsWereRemovedFromSource.apply(n,[t,e].concat(r.call(i)))}),this._itemsWereAddedToSource.apply(this,[t,e].concat(r.call(t.toArray())))},i.prototype.merge=function(){var t,e,n,i,o;for(e=1<=arguments.length?r.call(arguments,0):[],t=new Batman.Set,e.unshift(this),i=0,o=e.length;o>i;i++)n=e[i],n.forEach(function(e){return t.add(e)});return t},i.prototype.filter=Batman.SetProxy.prototype.filter,i}(Batman.Set)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.SetUnion=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype._itemsWereAddedToSource=function(){var t,e,r;return r=arguments[0],e=arguments[1],t=3<=arguments.length?n.call(arguments,2):[],this.add.apply(this,t)},r.prototype._itemsWereRemovedFromSource=function(){var t,e,r,i,o;return o=arguments[0],i=arguments[1],e=3<=arguments.length?n.call(arguments,2):[],r=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i.has(t)||o.push(t);return o}(),this.remove.apply(this,r)},r}(Batman.BinarySetOperation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.SetIntersection=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype._itemsWereAddedToSource=function(){var t,e,r,i,o;return o=arguments[0],i=arguments[1],e=3<=arguments.length?n.call(arguments,2):[],r=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i.has(t)&&o.push(t);return o}(),r.length>0?this.add.apply(this,r):void 0},r.prototype._itemsWereRemovedFromSource=function(){var t,e,r;
return r=arguments[0],e=arguments[1],t=3<=arguments.length?n.call(arguments,2):[],this.remove.apply(this,t)},r}(Batman.BinarySetOperation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.SetComplement=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype._itemsWereAddedToSource=function(){var t,e,r,i,o,a;if(a=arguments[0],o=arguments[1],e=3<=arguments.length?n.call(arguments,2):[],a===this.left){if(r=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)||i.push(t);return i}(),r.length>0)return this.add.apply(this,r)}else if(i=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)&&i.push(t);return i}(),i.length>0)return this.remove.apply(this,i)},r.prototype._itemsWereRemovedFromSource=function(){var t,e,r,i,o;return o=arguments[0],i=arguments[1],e=3<=arguments.length?n.call(arguments,2):[],o===this.left?this.remove.apply(this,e):(r=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i.has(t)&&o.push(t);return o}(),r.length>0?this.add.apply(this,r):void 0)},r.prototype._addComplement=function(t,e){var n,r;return r=function(){var r,i,o;for(o=[],r=0,i=t.length;i>r;r++)n=t[r],e.has(n)&&o.push(n);return o}(),r.length>0?this.add.apply(this,r):void 0},r}(Batman.BinarySetOperation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.StateMachine=function(t){function r(t){this.nextEvents=[],this.set("_state",t)}return e(r,t),r.InvalidTransitionError=function(t){this.message=null!=t?t:""},r.InvalidTransitionError.prototype=new Error,r.transitions=function(t){var e,r,i,o,a,s,u,c,l,f,p=this;for(i in t)c=t[i],c.from&&c.to&&(o={},c.from.forEach?c.from.forEach(function(t){return o[t]=c.to}):o[c.from]=c.to,t[i]=o);this.prototype.transitionTable=Batman.extend({},this.prototype.transitionTable,t),a=[],e=function(t){var e;return e="is"+Batman.helpers.capitalize(t),null==p.prototype[e]?(a.push(e),p.prototype[e]=function(){return this.get("state")===t}):void 0},f=this.prototype.transitionTable,l=function(t){return p.prototype[t]=function(){return this.startTransition(t)}};for(i in f)if(u=f[i],!this.prototype[i]){l(i);for(r in u)s=u[r],e(r),e(s)}return a.length&&this.accessor.apply(this,n.call(a).concat([function(t){return this[t]()}])),this},r.accessor("state",function(){return this.get("_state")}),r.prototype.isTransitioning=!1,r.prototype.transitionTable={},r.prototype.onTransition=function(t,e,n){return this.on(""+t+"->"+e,n)},r.prototype.onEnter=function(t,e){return this.on("enter "+t,e)},r.prototype.onExit=function(t,e){return this.on("exit "+t,e)},r.prototype.startTransition=Batman.Property.wrapTrackingPrevention(function(t){var e,n;return this.isTransitioning?(this.nextEvents.push(t),void 0):(n=this.get("state"),(e=this.nextStateForEvent(t))?(this.isTransitioning=!0,this.fire("exit "+n),this.set("_state",e),this.fire(""+n+"->"+e),this.fire("enter "+e),this.fire(t),this.isTransitioning=!1,this.nextEvents.length>0&&this.startTransition(this.nextEvents.shift()),!0):!1)}),r.prototype.canStartTransition=function(t,e){return null==e&&(e=this.get("state")),!!this.nextStateForEvent(t,e)},r.prototype.nextStateForEvent=function(t,e){var n;return null==e&&(e=this.get("state")),null!=(n=this.transitionTable[t])?n[e]:void 0},r}(Batman.Object),Batman.DelegatingStateMachine=function(t){function n(t,e){this.base=e,n.__super__.constructor.call(this,t)}return e(n,t),n.prototype.fire=function(){var t,e;return t=n.__super__.fire.apply(this,arguments),(e=this.base).fire.apply(e,arguments),t},n}(Batman.StateMachine)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.Model=function(t){function r(t){null==t&&(t={}),Batman.developer.assert(this instanceof Batman.Object,"constructors must be called with new"),"Object"===Batman.typeOf(t)?r.__super__.constructor.call(this,t):(r.__super__.constructor.call(this),this.set("id",t))}var i,o,a,s,u,c,l;for(e(r,t),r.storageKey=null,r.primaryKey="id",r.persist=function(){var t,e;return t=arguments[0],e=2<=arguments.length?n.call(arguments,1):[],Batman.initializeObject(this.prototype),t=t.isStorageAdapter?t:new t(this),e.length>0&&Batman.mixin.apply(Batman,[t].concat(n.call(e))),this.prototype._batman.storage=t,t},r.storageAdapter=function(){return Batman.initializeObject(this.prototype),this.prototype._batman.storage},r.encode=function(){var t,e,r,i,o,a,s,u,c;switch(o=2<=arguments.length?n.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],Batman.initializeObject(this.prototype),(a=this.prototype._batman).encoders||(a.encoders=new Batman.SimpleHash),t={},Batman.typeOf(r)){case"String":o.push(r);break;case"Function":t.encode=r;break;default:t=r}for(u=0,c=o.length;c>u;u++)i=o[u],e=Batman.extend({as:i},this.defaultEncoder,t),this.prototype._batman.encoders.set(i,e)},r.defaultEncoder={encode:function(t){return t},decode:function(t){return t}},r.observeAndFire("primaryKey",function(t,e){return this.encode(e,{encode:!1,decode:!1}),this.encode(t,{encode:!1,decode:this.defaultEncoder.decode})}),r.validate=function(){var t,e,r,i,o,a,s,u,c,l,f;if(t=2<=arguments.length?n.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],Batman.initializeObject(this.prototype),o=(a=this.prototype._batman).validators||(a.validators=[]),"function"==typeof r)return o.push({keys:t,callback:r});for(l=Batman.Validators,f=[],u=0,c=l.length;c>u;u++)i=l[u],(e=i.matches(r))?f.push(o.push({keys:t,validator:new i(e)})):f.push(void 0);return f},r.classAccessor("resourceName",{get:function(){return null!=this.resourceName?this.resourceName:(Batman.config.minificationErrors&&Batman.developer.error("Please define "+Batman.functionName(this)+".resourceName in order for your model to be minification safe."),Batman.helpers.underscore(Batman.functionName(this)))}}),r.classAccessor("all",{get:function(){return this._batman.check(this),this.prototype.hasStorage()&&!this._batman.allLoadTriggered&&(this.load(),this._batman.allLoadTriggered=!0),this.get("loaded")},set:function(t,e){return this.set("loaded",e)}}),r.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new Batman.Set)},set:function(t,e){return this._loaded=e}}),r.classAccessor("first",function(){return this.get("all").toArray()[0]}),r.classAccessor("last",function(){var t;return t=this.get("all").toArray(),t[t.length-1]}),r.clear=function(){var t,e;return Batman.initializeObject(this),t=this.get("loaded").clear(),null!=(e=this._batman.get("associations"))&&e.reset(),this._resetPromises(),t},r.find=function(t,e){return this.findWithOptions(t,void 0,e)},r.findWithOptions=function(t,e,n){var r;return null==e&&(e={}),Batman.developer.assert(n,"Must call find with a callback!"),r=new this,r._withoutDirtyTracking(function(){return this.set("id",t)}),r.loadWithOptions(e,n),r},r.load=function(t,e){var n;return"function"==(n=typeof t)||"undefined"===n?(e=t,t={}):t={data:t},this.loadWithOptions(t,e)},r.loadWithOptions=function(t,e){var n=this;return this.fire("loading",t),this._doStorageOperation("readAll",t,function(t,r,i){var o;return null!=t?(n.fire("error",t),"function"==typeof e?e(t,[]):void 0):(o=n._mapIdentities(r),n.fire("loaded",o,i),"function"==typeof e?e(t,o,i):void 0)})},r.create=function(t,e){var n,r;return e||(r=[{},t],t=r[0],e=r[1]),n=new this(t),n.save(e),n},r.findOrCreate=function(t,e){var n,r;return r=new this(t),r.isNew()?r.save(e):(n=this._mapIdentity(r),e(void 0,n)),r},r.createFromJSON=function(t){var e;return e=new this,e._withoutDirtyTracking(function(){return this.fromJSON(t)}),this._mapIdentity(e)},r._mapIdentity=function(t){return this._mapIdentities([t])[0]},r._mapIdentities=function(t){var e,n,r,i,o,a,s,u,c;for(i=[],r=a=0,s=t.length;s>a;r=++a)o=t[r],null!=(n=o.get("id"))&&((e=null!=(u=this.get("loaded.indexedBy.id").get(n))?u.toArray()[0]:void 0)?(e._withoutDirtyTracking(function(){var t;return this.updateAttributes((null!=(t=o.get("attributes"))?t.toObject():void 0)||{})}),t[r]=e):i.push(o));return i.length&&(c=this.get("loaded")).add.apply(c,i),t},r._doStorageOperation=function(t,e,n){var r;return Batman.developer.assert(this.prototype.hasStorage(),"Can't "+t+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),r=this.prototype._batman.get("storage"),r.perform(t,this,e,n)},c=["find","load","create"],o=0,s=c.length;s>o;o++)i=c[o],r[i]=Batman.Property.wrapTrackingPrevention(r[i]);for(r.InstanceLifecycleStateMachine=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.transitions({load:{from:["dirty","clean"],to:"loading"},create:{from:["dirty","clean"],to:"creating"},save:{from:["dirty","clean"],to:"saving"},destroy:{from:["dirty","clean"],to:"destroying"},failedValidation:{from:["saving","creating"],to:"dirty"},loaded:{loading:"clean"},created:{creating:"clean"},saved:{saving:"clean"},destroyed:{destroying:"destroyed"},set:{from:["dirty","clean"],to:"dirty"},error:{from:["saving","creating","loading","destroying"],to:"error"}}),n}(Batman.DelegatingStateMachine),r.accessor("lifecycle",function(){return this.lifecycle||(this.lifecycle=new Batman.Model.InstanceLifecycleStateMachine("clean",this))}),r.accessor("attributes",function(){return this.attributes||(this.attributes=new Batman.Hash)}),r.accessor("dirtyKeys",function(){return this.dirtyKeys||(this.dirtyKeys=new Batman.Hash)}),r.accessor("_dirtiedKeys",function(){return this._dirtiedKeys||(this._dirtiedKeys=new Batman.SimpleSet)}),r.accessor("errors",function(){return this.errors||(this.errors=new Batman.ErrorsSet)}),r.accessor("isNew",function(){return this.isNew()}),r.accessor("isDirty",function(){return this.isDirty()}),r.accessor(r.defaultAccessor={get:function(t){return Batman.getPath(this,["attributes",t])},set:function(t,e){return this._willSet(t)?this.get("attributes").set(t,e):this.get(t)},unset:function(t){return this.get("attributes").unset(t)}}),r.wrapAccessor("id",function(t){return{get:function(){var e;return e=this.constructor.primaryKey,"id"===e?t.get.apply(this,arguments):this.get(e)},set:function(e,n){var r,i;return"string"==typeof n&&null===n.match(/[^0-9]/)&&""+(r=parseInt(n,10))===n&&(n=r),i=this.constructor.primaryKey,"id"===i?(this._willSet(e),t.set.apply(this,arguments)):this.set(i,n)}}}),r.prototype.isNew=function(){return"undefined"==typeof this.get("id")},r.prototype.isDirty=function(){return"dirty"===this.get("lifecycle.state")},r.prototype.updateAttributes=function(t){return this.mixin(t),this},r.prototype.toString=function(){return""+this.constructor.get("resourceName")+": "+this.get("id")},r.prototype.toParam=function(){return this.get("id")},r.prototype.toJSON=function(){var t,e,n=this;return e={},t=this._batman.get("encoders"),t&&!t.isEmpty()&&t.forEach(function(t,r){var i,o;return r.encode&&(o=n.get(t),"undefined"!=typeof o&&(i=r.encode(o,t,e,n),"undefined"!=typeof i))?e[r.as]=i:void 0}),e},r.prototype.fromJSON=function(t){var e,n,r,i,o=this;if(r={},e=this._batman.get("encoders"),e&&!e.isEmpty()&&e.some(function(t,e){return null!=e.decode}))e.forEach(function(e,n){return n.decode&&"undefined"!=typeof t[n.as]?r[e]=n.decode(t[n.as],n.as,t,r,o):void 0});else for(n in t)i=t[n],r[n]=i;return"id"!==this.constructor.primaryKey&&(r.id=t[this.constructor.primaryKey]),Batman.developer["do"](function(){return!e||e.length<=1?Batman.developer.warn("Warning: Model "+Batman.functionName(o.constructor)+" has suspiciously few decoders!"):void 0}),this.mixin(r)},r.prototype.hasStorage=function(){return null!=this._batman.get("storage")},r.prototype.load=function(t,e){var n;return e?t={data:t}:(n=[{},t],t=n[0],e=n[1]),this.loadWithOptions(t,e)},r.prototype.loadWithOptions=function(t,e){var n,r,i,o=this;return r=0!==Object.keys(t).length,"destroying"===(i=this.get("lifecycle.state"))||"destroyed"===i?("function"==typeof e&&e(new Error("Can't load a destroyed record!")),void 0):this.get("lifecycle").load()?(n=[],null!=e&&n.push(e),r||(this._currentLoad=n),this._doStorageOperation("read",t,function(t,i,a){var s,u;for(t?o.get("lifecycle").error():(o.get("lifecycle").loaded(),i=o.constructor._mapIdentity(i)),r||(o._currentLoad=null),s=0,u=n.length;u>s;s++)e=n[s],e(t,i,a)})):"loading"!==this.get("lifecycle.state")||r?"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't load while in state "+this.get("lifecycle.state"))):void 0:null!=e?this._currentLoad.push(e):void 0},r.prototype.save=function(t,e){var n,r,i,o,a,s,u=this;return e||(a=[{},t],t=a[0],e=a[1]),r=this.isNew(),s=r?["create","create","created"]:["save","update","saved"],i=s[0],o=s[1],n=s[2],this.get("lifecycle").startTransition(i)?this.validate(function(r,i){var a;return r||i.length?(u.get("lifecycle").failedValidation(),"function"==typeof e?e(r||i,u):void 0):(a=u.constructor._batman.get("associations"),u._withoutDirtyTracking(function(){var t,e=this;return null!=a?null!=(t=a.getByType("belongsTo"))?t.forEach(function(t){return t.apply(e)}):void 0:void 0}),u._doStorageOperation(o,{data:t},function(t,r,i){return t?t instanceof Batman.ErrorsSet?u.get("lifecycle").failedValidation():u.get("lifecycle").error():(u.get("dirtyKeys").clear(),u.get("_dirtiedKeys").clear(),a&&r._withoutDirtyTracking(function(){var e,n;return null!=(e=a.getByType("hasOne"))&&e.forEach(function(e){return e.apply(t,r)}),null!=(n=a.getByType("hasMany"))?n.forEach(function(e){return e.apply(t,r)}):void 0}),r=u.constructor._mapIdentity(r),u.get("lifecycle").startTransition(n)),"function"==typeof e?e(t,r||u,i):void 0}))}):"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't save while in state "+this.get("lifecycle.state"))):void 0},r.prototype.destroy=function(t,e){var n,r=this;return e||(n=[{},t],t=n[0],e=n[1]),this.get("lifecycle").destroy()?this._doStorageOperation("destroy",{data:t},function(t,n,i){return t?r.get("lifecycle").error():(r.constructor.get("loaded").remove(r),r.get("lifecycle").destroyed()),"function"==typeof e?e(t,n,i):void 0}):"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't destroy while in state "+this.get("lifecycle.state"))):void 0},r.prototype.validate=function(t){var e,n,r,i,o,a,s,u,c,l,f,p;if(r=this.get("errors"),r.clear(),s=this._batman.get("validators")||[],!s||0===s.length)return"function"==typeof t&&t(void 0,r),!0;for(n=s.reduce(function(t,e){return t+e.keys.length},0),i=function(){return 0===--n?"function"==typeof t?t(void 0,r):void 0:void 0},u=0,l=s.length;l>u;u++)for(a=s[u],p=a.keys,c=0,f=p.length;f>c;c++){o=p[c],e=[r,this,o,i];try{a.validator?a.validator.validateEach.apply(a.validator,e):a.callback.apply(a,e)}catch(h){"function"==typeof t&&t(h,r)}}},r.prototype.associationProxy=function(t){var e,n,r;return Batman.initializeObject(this),e=(n=this._batman).associationProxies||(n.associationProxies={}),e[r=t.label]||(e[r]=new t.proxyClass(t,this)),e[t.label]},r.prototype._willSet=function(t){return this._pauseDirtyTracking?!0:this.get("lifecycle").startTransition("set")?(this.get("_dirtiedKeys").has(t)||(this.set("dirtyKeys."+t,this.get(t)),this.get("_dirtiedKeys").add(t)),!0):!1},r.prototype._doStorageOperation=function(t,e,n){var r;return Batman.developer.assert(this.hasStorage(),"Can't "+t+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),r=this._batman.get("storage"),r.perform(t,this,e,function(){return n.apply(null,arguments)})},r.prototype._withoutDirtyTracking=function(t){var e;return this._pauseDirtyTracking=!0,e=t.call(this),this._pauseDirtyTracking=!1,e},l=["load","save","validate","destroy"],a=0,u=l.length;u>a;a++)i=l[a],r.prototype[i]=Batman.Property.wrapTrackingPrevention(r.prototype[i]);return r}.call(this,Batman.Object)}.call(this),function(){var t,e,n,r,i;for(i=Batman.AssociationCurator.availableAssociations,e=function(t){return Batman.Model[t]=function(e,n){var r,i;return Batman.initializeObject(this),r=(i=this._batman).associations||(i.associations=new Batman.AssociationCurator(this)),r.add(new(Batman[""+Batman.helpers.capitalize(t)+"Association"])(this,e,n))}},n=0,r=i.length;r>n;n++)t=i[n],e(t)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Proxy=function(t){function n(t){n.__super__.constructor.call(this),null!=t&&this.set("target",t)}return e(n,t),n.prototype.isProxy=!0,n.accessor("target",Batman.Property.defaultAccessor),n.accessor({get:function(t){var e;return null!=(e=this.get("target"))?e.get(t):void 0},set:function(t,e){var n;return null!=(n=this.get("target"))?n.set(t,e):void 0},unset:function(t){var e;return null!=(e=this.get("target"))?e.unset(t):void 0}}),n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociationProxy=function(t){function n(t,e){this.association=t,this.model=e,n.__super__.constructor.call(this)}return e(n,t),n.prototype.loaded=!1,n.prototype.toJSON=function(){var t;return t=this.get("target"),null!=t?this.get("target").toJSON():void 0},n.prototype.load=function(t){var e=this;return this.fetch(function(n,r){return n||e._setTarget(r),"function"==typeof t?t(n,r):void 0}),this.get("target")},n.prototype.loadFromLocal=function(){var t;if(this._canLoad())return(t=this.fetchFromLocal())&&this._setTarget(t),t},n.prototype.fetch=function(t){var e;return this._canLoad()?(e=this.fetchFromLocal(),e?t(void 0,e):this.fetchFromRemote(t)):t(void 0,void 0)},n.accessor("loaded",Batman.Property.defaultAccessor),n.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(t,e){return e}}),n.prototype._canLoad=function(){return null!=(this.get("foreignValue")||this.get("primaryValue"))},n.prototype._setTarget=function(t){return this.set("target",t),this.set("loaded",!0),this.fire("loaded",t)},n}(Batman.Proxy)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HasOneProxy=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)}),n.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))},n.prototype.fetchFromRemote=function(t){var e;return e={data:{}},e.data[this.association.foreignKey]=this.get("primaryValue"),this.association.options.url&&(e.collectionUrl=this.association.options.url,e.urlContext=this.model),this.association.getRelatedModel().loadWithOptions(e,function(e,n){if(e)throw e;return!n||n.length<=0?t(new Error("Couldn't find related record!"),void 0):t(void 0,n[0])})},n}(Batman.AssociationProxy)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.BelongsToProxy=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)}),n.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))},n.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModel().findWithOptions(this.get("foreignValue"),e,function(e,n){if(e)throw e;return t(void 0,n)})},n}(Batman.AssociationProxy)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicBelongsToProxy=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)}),n.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))},n.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModelForType(this.get("foreignTypeValue")).findWithOptions(this.get("foreignValue"),e,function(e,n){if(e)throw e;return t(void 0,n)})},n}(Batman.BelongsToProxy)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Accessible=function(t){function n(){this.accessor.apply(this,arguments)}return e(n,t),n}(Batman.Object),Batman.TerminalAccessible=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.propertyClass=Batman.Property,n}(Batman.Accessible)}.call(this),function(){Batman.mixins=new Batman.Object}.call(this),function(){Batman.URI=function(){function t(t){var n,r;for(r=p.exec(t),n=14;n--;)this[e[n]]=r[n]||"";this.queryParams=this.constructor.paramsFromQuery(this.query),delete this.authority,delete this.userInfo,delete this.relative,delete this.directory,delete this.file,delete this.query}var e,n,r,i,o,a,s,u,c,l,f,p;return p=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","hash"],t.prototype.queryString=function(){return this.constructor.queryFromParams(this.queryParams)},t.prototype.toString=function(){return[this.protocol?""+this.protocol+":":void 0,this.authority()?"//":void 0,this.authority(),this.relative()].join("")},t.prototype.userInfo=function(){return[this.user,this.password?":"+this.password:void 0].join("")},t.prototype.authority=function(){return[this.userInfo(),this.user||this.password?"@":void 0,this.hostname,this.port?":"+this.port:void 0].join("")},t.prototype.relative=function(){var t;return t=this.queryString(),[this.path,t?"?"+t:void 0,this.hash?"#"+this.hash:void 0].join("")},t.prototype.directory=function(){var t;return t=this.path.split("/"),t.length>1?t.slice(0,t.length-1).join("/")+"/":""},t.prototype.file=function(){var t;return t=this.path.split("/"),t[t.length-1]},t.paramsFromQuery=function(t){var e,n,i,o,s,c;for(n={},c=t.split("&"),o=0,s=c.length;s>o;o++)i=c[o],(e=i.match(a))?u(n,r(e[1]),r(e[2])):u(n,r(i),null);return n},t.decodeQueryComponent=r=function(t){return decodeURIComponent(t.replace(c,"%20"))},s=/^[\[\]]*([^\[\]]+)\]*(.*)/,n=[/^\[\]\[([^\[\]]+)\]$/,/^\[\](.+)$/],c=/\+/g,f=/%20/g,a=/^([^=]*)=(.*)/,u=function(t,e,r){var i,o,a,c,l,f,p,h;if(l=e.match(s)){if(a=l[1],i=l[2],""===i)t[a]=r;else if("[]"===i){if(null==(f=t[a])&&(t[a]=[]),"Array"!==Batman.typeOf(t[a]))throw new Error("expected Array (got "+Batman.typeOf(t[a])+') for param "'+a+'"');t[a].push(r)}else if(l=i.match(n[0])||i.match(n[1])){if(o=l[1],null==(p=t[a])&&(t[a]=[]),"Array"!==Batman.typeOf(t[a]))throw new Error("expected Array (got "+Batman.typeOf(t[a])+') for param "'+a+'"');c=t[a][t[a].length-1],"Object"!==Batman.typeOf(c)||o in c?t[a].push(u({},o,r)):u(c,o,r)}else{if(null==(h=t[a])&&(t[a]={}),"Object"!==Batman.typeOf(t[a]))throw new Error("expected Object (got "+Batman.typeOf(t[a])+') for param "'+a+'"');t[a]=u(t[a],i,r)}return t}},t.queryFromParams=l=function(t,e){var n,r,i,a;if(null==t)return e;if(a=Batman.typeOf(t),null==e&&"Object"!==a)throw new Error("value must be an Object");switch(a){case"Array":return function(){var r,o;if(n=[],0===t.length)n.push(l(null,""+e+"[]"));else for(r=0,o=t.length;o>r;r++)i=t[r],n.push(l(i,""+e+"[]"));return n}().join("&");case"Object":return function(){var n;n=[];for(r in t)i=t[r],n.push(l(i,e?""+e+"["+o(r)+"]":o(r)));return n}().join("&");default:return null!=e?""+e+"="+o(t):o(t)}},t.encodeComponent=i=function(t){return null!=t?encodeURIComponent(t):""},t.encodeQueryComponent=o=function(t){return i(t).replace(f,"+")},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Request=function(t){function n(t){var e,r,i,o;r={};for(i in t)e=t[i],("success"===i||"error"===i||"loading"===i||"loaded"===i)&&(r[i]=e,delete t[i]);n.__super__.constructor.call(this,t);for(i in r)e=r[i],this.on(i,e);(null!=(o=this.get("url"))?o.length:void 0)>0?this.autosend&&this.send():this.observe("url",function(t){return null!=t?this.send():void 0})}var r;return e(n,t),n.objectToFormData=function(t){var e,n,r,i,o,a,s,u;for(r=function(t,e,n){var i,o,a;return null==n&&(n=!1),e instanceof Batman.container.File?[[t,e]]:o=function(){switch(Batman.typeOf(e)){case"Object":return o=function(){var o;o=[];for(i in e)a=e[i],o.push(r(n?i:""+t+"["+i+"]",a));return o}(),o.reduce(function(t,e){return t.concat(e)},[]);case"Array":return e.reduce(function(e,n){return e.concat(r(""+t+"[]",n))},[]);default:return[[t,null!=e?e:""]]}}()},e=new Batman.container.FormData,s=r("",t,!0),o=0,a=s.length;a>o;o++)u=s[o],n=u[0],i=u[1],e.append(n,i);return e},n.dataHasFileUploads=r=function(t){var e,n,i,o,a;if("undefined"!=typeof File&&null!==File&&t instanceof File)return!0;switch(n=Batman.typeOf(t)){case"Object":for(e in t)if(i=t[e],r(i))return!0;break;case"Array":for(o=0,a=t.length;a>o;o++)if(i=t[o],r(i))return!0}return!1},n.wrapAccessor("method",function(t){return{set:function(e,n){return t.set.call(this,e,null!=n?"function"==typeof n.toUpperCase?n.toUpperCase():void 0:void 0)}}}),n.prototype.method="GET",n.prototype.hasFileUploads=function(){return r(this.data)},n.prototype.contentType="application/x-www-form-urlencoded",n.prototype.autosend=!0,n.prototype.send=function(){return Batman.developer.error("Please source a dependency file for a request implementation")},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.SetObserver=function(t){function r(t){var e=this;this.base=t,this._itemObservers=new Batman.SimpleHash,this._setObservers=new Batman.SimpleHash,this._setObservers.set("itemsWereAdded",function(){return e.fire.apply(e,["itemsWereAdded"].concat(n.call(arguments)))}),this._setObservers.set("itemsWereRemoved",function(){return e.fire.apply(e,["itemsWereRemoved"].concat(n.call(arguments)))}),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return e(r,t),r.prototype.observedItemKeys=[],r.prototype.observerForItemAndKey=function(){},r.prototype._getOrSetObserverForItemAndKey=function(t,e){var n=this;return this._itemObservers.getOrSet(t,function(){var r;return r=new Batman.SimpleHash,r.getOrSet(e,function(){return n.observerForItemAndKey(t,e)})})},r.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},r.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},r.prototype.startObservingItems=function(){var t,e,r,i,o;for(e=1<=arguments.length?n.call(arguments,0):[],o=[],r=0,i=e.length;i>r;r++)t=e[r],o.push(this._manageObserversForItem(t,"observe"));return o},r.prototype.stopObservingItems=function(){var t,e,r,i,o;for(e=1<=arguments.length?n.call(arguments,0):[],o=[],r=0,i=e.length;i>r;r++)t=e[r],o.push(this._manageObserversForItem(t,"forget"));return o},r.prototype._manageObserversForItem=function(t,e){var n,r,i,o;if(t.isObservable){for(o=this.observedItemKeys,r=0,i=o.length;i>r;r++)n=o[r],t[e](n,this._getOrSetObserverForItemAndKey(t,n));return"forget"===e?this._itemObservers.unset(t):void 0}},r.prototype._manageItemObservers=function(t){var e=this;return this.base.forEach(function(n){return e._manageObserversForItem(n,t)})},r.prototype._manageSetObservers=function(t){var e=this;if(this.base.isObservable)return this._setObservers.forEach(function(n,r){return e.base.event(n)[t](r)})},r}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SetSort=function(t){function n(t,e,r){var i,o=this;this.key=e,null==r&&(r="asc"),n.__super__.constructor.call(this,t),this.descending="desc"===r.toLowerCase(),this.base.isObservable&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],i=function(){return o._reIndex()},this._setObserver.observerForItemAndKey=function(){return i},this._setObserver.on("itemsWereAdded",i),this._setObserver.on("itemsWereRemoved",i),this.startObserving()),this._reIndex()}return e(n,t),n.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},n.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},n.prototype.toArray=function(){return this.get("_storage")},n.prototype.forEach=function(t,e){var n,r,i,o,a,s;for(a=this.get("_storage"),s=[],r=i=0,o=a.length;o>i;r=++i)n=a[r],s.push(t.call(e,n,r,this));return s},n.prototype.find=function(t){var e,n,r,i;for(this.base.registerAsMutableSource(),i=this.get("_storage"),n=0,r=i.length;r>n;n++)if(e=i[n],t(e))return e},n.prototype.merge=function(t){return this.base.registerAsMutableSource(),function(t,e,n){n.prototype=t.prototype;var r=new n,i=t.apply(r,e),o=typeof i;return"object"==o||"function"==o?i||r:r}(Batman.Set,this._storage,function(){}).merge(t).sortedBy(this.key,this.order)},n.prototype.compare=function(t,e){return t===e?0:void 0===t?1:void 0===e?-1:null===t?1:null===e?-1:t===!1?1:e===!1?-1:t===!0?1:e===!0?-1:t!==t?e!==e?0:1:e!==e?-1:t>e?1:e>t?-1:0},n.prototype._reIndex=function(){var t,e,n=this;return t=this.base.toArray().sort(function(t,e){var r,i,o;return i=Batman.get(t,n.key),"function"==typeof i&&(i=i.call(t)),null!=i&&(i=i.valueOf()),o=Batman.get(e,n.key),"function"==typeof o&&(o=o.call(e)),null!=o&&(o=o.valueOf()),r=n.descending?-1:1,n.compare.call(n,i,o)*r}),null!=(e=this._setObserver)&&e.startObservingItems.apply(e,t),this.set("_storage",t)},n}(Batman.SetProxy)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociationSet=function(t){function n(t,e){var r;this.foreignKeyValue=t,this.association=e,r=new Batman.Set,n.__super__.constructor.call(this,r,"_batmanID")}return e(n,t),n.prototype.loaded=!1,n.prototype.load=function(t){var e=this;return null==this.foreignKeyValue?t(void 0,this):this.association.getRelatedModel().loadWithOptions(this._getLoadOptions(),function(n){return n||e.markAsLoaded(),t(n,e)})},n.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),t
},n.accessor("loaded",Batman.Property.defaultAccessor),n.prototype.markAsLoaded=function(){return this.set("loaded",!0),this.fire("loaded")},n}(Batman.SetSort)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicAssociationSet=function(t){function n(t,e,r){this.foreignKeyValue=t,this.foreignTypeKeyValue=e,this.association=r,n.__super__.constructor.call(this,this.foreignKeyValue,this.association)}return e(n,t),n.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,t.data[this.association.foreignTypeKey]=this.foreignTypeKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),t},n}(Batman.AssociationSet)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.SetIndex=function(t){function r(t,e){var i=this;this.base=t,this.key=e,r.__super__.constructor.call(this),this._storage=new Batman.Hash,this.base.isEventEmitter&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",function(){var t,e,r,o,a;for(e=1<=arguments.length?n.call(arguments,0):[],a=[],r=0,o=e.length;o>r;r++)t=e[r],a.push(i._addItem(t));return a}),this._setObserver.on("itemsWereRemoved",function(){var t,e,r,o,a;for(e=1<=arguments.length?n.call(arguments,0):[],a=[],r=0,o=e.length;o>r;r++)t=e[r],a.push(i._removeItem(t));return a})),this.base.forEach(this._addItem.bind(this)),this.startObserving()}return e(r,t),r.accessor("toArray",function(){return this.toArray()}),Batman.extend(r.prototype,Batman.Enumerable),r.prototype.propertyClass=Batman.Property,r.accessor(function(t){return this._resultSetForKey(t)}),r.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},r.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},r.prototype.observerForItemAndKey=function(t){var e=this;return function(n,r){return e._removeItemFromKey(t,r),e._addItemToKey(t,n)}},r.prototype.forEach=function(t,e){var n=this;return this._storage.forEach(function(r,i){return i.get("length")>0?t.call(e,r,i,n):void 0})},r.prototype.toArray=function(){var t;return t=[],this._storage.forEach(function(e,n){return n.get("length")>0?t.push(e):void 0}),t},r.prototype._addItem=function(t){return this._addItemToKey(t,this._keyForItem(t))},r.prototype._addItemToKey=function(t,e){return this._resultSetForKey(e).add(t)},r.prototype._removeItem=function(t){return this._removeItemFromKey(t,this._keyForItem(t))},r.prototype._removeItemFromKey=function(t,e){return this._resultSetForKey(e).remove(t)},r.prototype._resultSetForKey=function(t){return this._storage.getOrSet(t,function(){return new Batman.Set})},r.prototype._keyForItem=function(t){return Batman.Keypath.forBaseAndKey(t,this.key).getValue()},r}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicAssociationSetIndex=function(t){function n(t,e,r){this.association=t,this.type=e,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),r)}return e(n,t),n.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},n.prototype._addItem=function(t){return this.association.modelType()===t.get(this.association.foreignTypeKey)?n.__super__._addItem.apply(this,arguments):void 0},n.prototype._removeItem=function(t){return this.association.modelType()===t.get(this.association.foreignTypeKey)?n.__super__._removeItem.apply(this,arguments):void 0},n}(Batman.SetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociationSetIndex=function(t){function n(t,e){this.association=t,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),e)}return e(n,t),n.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},n.prototype.forEach=function(t,e){var n=this;return this.association.proxies.forEach(function(r,i){var o;return o=n.association.indexValueForRecord(r),i.get("length")>0?t.call(e,o,i,n):void 0})},n.prototype.toArray=function(){var t;return t=[],this.forEach(function(e){return t.push(e)}),t},n}(Batman.SetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.UniqueSetIndex=function(t){function n(){this._uniqueIndex=new Batman.Hash,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor(function(t){return this._uniqueIndex.get(t)}),n.prototype._addItemToKey=function(t,e){return this._resultSetForKey(e).add(t),this._uniqueIndex.hasKey(e)?void 0:this._uniqueIndex.set(e,t)},n.prototype._removeItemFromKey=function(t,e){var r;return r=this._resultSetForKey(e),n.__super__._removeItemFromKey.apply(this,arguments),r.isEmpty()?this._uniqueIndex.unset(e):this._uniqueIndex.set(e,r.toArray()[0])},n}(Batman.SetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.UniqueAssociationSetIndex=function(t){function n(t,e){this.association=t,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),e)}return e(n,t),n}(Batman.UniqueSetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicUniqueAssociationSetIndex=function(t){function n(t,e,r){this.association=t,this.type=e,n.__super__.constructor.call(this,this.association.getRelatedModelForType(e).get("loaded"),r)}return e(n,t),n}(Batman.UniqueSetIndex)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].slice;Batman.Navigator=function(){function n(e){this.app=e,this.handleCurrentLocation=t(this.handleCurrentLocation,this)}return n.defaultClass=function(){return Batman.config.usePushState&&Batman.PushStateNavigator.isSupported()?Batman.PushStateNavigator:Batman.HashbangNavigator},n.forApp=function(t){return new(this.defaultClass())(t)},n.prototype.start=function(){var t=this;if("undefined"!=typeof window&&!this.started)return this.started=!0,this.startWatching(),Batman.currentApp.prevent("ready"),Batman.setImmediate(function(){return t.started&&Batman.currentApp?(t.handleCurrentLocation(),Batman.currentApp.allowAndFire("ready")):void 0})},n.prototype.stop=function(){return this.stopWatching(),this.started=!1},n.prototype.handleLocation=function(t){var e;return e=this.pathFromLocation(t),e!==this.cachedPath?this.dispatch(e):void 0},n.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},n.prototype.dispatch=function(t){return this.cachedPath=this.app.get("dispatcher").dispatch(t),this._lastRedirect&&(this.cachedPath=this._lastRedirect),this.cachedPath},n.prototype.push=function(t){var e,n,r;return n="function"==typeof(r=this.app.get("dispatcher")).pathFromParams?r.pathFromParams(t):void 0,n&&(this._lastRedirect=n),e=this.dispatch(t),this._lastRedirect&&this._lastRedirect!==e||this.pushState(null,"",e),e},n.prototype.replace=function(t){var e,n,r;return n="function"==typeof(r=this.app.get("dispatcher")).pathFromParams?r.pathFromParams(t):void 0,n&&(this._lastRedirect=n),e=this.dispatch(t),this._lastRedirect&&this._lastRedirect!==e||this.replaceState(null,"",e),e},n.prototype.redirect=n.prototype.push,n.prototype.normalizePath=function(){var t,n,r;return r=1<=arguments.length?e.call(arguments,0):[],r=function(){var e,i,o;for(o=[],t=e=0,i=r.length;i>e;t=++e)n=r[t],o.push((""+n).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return o}(),r.join("")||"/"},n.normalizePath=n.prototype.normalizePath,n}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PushStateNavigator=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.isSupported=function(){var t;return null!=("undefined"!=typeof window&&null!==window?null!=(t=window.history)?t.pushState:void 0:void 0)},n.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"popstate",this.handleCurrentLocation)},n.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"popstate",this.handleCurrentLocation)},n.prototype.pushState=function(t,e,n){return n!==this.pathFromLocation(window.location)?window.history.pushState(t,e,this.linkTo(n)):void 0},n.prototype.replaceState=function(t,e,n){return n!==this.pathFromLocation(window.location)?window.history.replaceState(t,e,this.linkTo(n)):void 0},n.prototype.linkTo=function(t){return this.normalizePath(Batman.config.pathPrefix,t)},n.prototype.pathFromLocation=function(t){var e,n;return e=""+(t.pathname||"")+(t.search||""),n=new RegExp("^"+this.normalizePath(Batman.config.pathPrefix)),this.normalizePath(e.replace(n,""))},n.prototype.handleLocation=function(t){var e,r;return r=this.pathFromLocation(t),"/"===r&&"/"!==(e=Batman.HashbangNavigator.prototype.pathFromLocation(t))?this.replace(e):n.__super__.handleLocation.apply(this,arguments)},n}(Batman.Navigator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HashbangNavigator=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.HASH_PREFIX="#!","undefined"!=typeof window&&null!==window&&"onhashchange"in window?(n.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"hashchange",this.handleCurrentLocation)},n.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"hashchange",this.handleCurrentLocation)}):(n.prototype.startWatching=function(){return this.interval=setInterval(this.handleCurrentLocation,100)},n.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),n.prototype.pushState=function(t,e,n){return window.location.hash=this.linkTo(n)},n.prototype.replaceState=function(t,e,n){var r;return r=window.location,r.replace(""+r.pathname+r.search+this.linkTo(n))},n.prototype.linkTo=function(t){return this.HASH_PREFIX+t},n.prototype.pathFromLocation=function(t){var e;return e=t.hash,(null!=e?e.substr(0,2):void 0)===this.HASH_PREFIX?this.normalizePath(e.substr(2)):"/"},n.prototype.handleLocation=function(t){var e;return Batman.config.usePushState?(e=Batman.PushStateNavigator.prototype.pathFromLocation(t),"/"===e?n.__super__.handleLocation.apply(this,arguments):t.replace(this.normalizePath(""+Batman.config.pathPrefix+this.linkTo(e)))):n.__super__.handleLocation.apply(this,arguments)},n}(Batman.Navigator)}.call(this),function(){Batman.RouteMap=function(){function t(){this.childrenByOrder=[],this.childrenByName={}}return t.prototype.memberRoute=null,t.prototype.collectionRoute=null,t.prototype.routeForParams=function(t){var e,n,r,i;for(i=this.childrenByOrder,n=0,r=i.length;r>n;n++)if(e=i[n],e.test(t))return e;return void 0},t.prototype.addRoute=function(t,e){var n,r,i=this;return this.childrenByOrder.push(e),t.length>0&&(r=t.split(".")).length>0?(n=r.shift(),this.childrenByName[n]||(this.childrenByName[n]=new Batman.RouteMap),this.childrenByName[n].addRoute(r.join("."),e)):e.get("member")?(Batman.developer["do"](function(){return i.memberRoute?Batman.developer.error("Member route with name "+t+" already exists!"):void 0}),this.memberRoute=e):(Batman.developer["do"](function(){return i.collectionRoute?Batman.developer.error("Collection route with name "+t+" already exists!"):void 0}),this.collectionRoute=e),!0},t}()}.call(this),function(){var t=[].slice;Batman.RouteMapBuilder=function(){function e(t,e,n,r){this.app=t,this.routeMap=e,this.parent=n,this.baseOptions=null!=r?r:{},this.parent?(this.rootPath=this.parent._nestingPath(),this.rootName=this.parent._nestingName()):(this.rootPath="",this.rootName="")}return e.BUILDER_FUNCTIONS=["resources","member","collection","route","root"],e.ROUTES={index:{cardinality:"collection",path:function(t){return t},name:function(t){return t}},"new":{cardinality:"collection",path:function(t){return""+t+"/new"},name:function(t){return""+t+".new"}},show:{cardinality:"member",path:function(t){return""+t+"/:id"},name:function(t){return t}},edit:{cardinality:"member",path:function(t){return""+t+"/:id/edit"},name:function(t){return""+t+".edit"}},collection:{cardinality:"collection",path:function(t,e){return""+t+"/"+e},name:function(t,e){return""+t+"."+e}},member:{cardinality:"member",path:function(t,e){return""+t+"/:id/"+e},name:function(t,e){return""+t+"."+e}}},e.prototype.resources=function(){var e,n,r,i,o,a,s,u,c,l,f,p,h,d,g,m,v,y,b,$,x,w,_,E,T,A;if(i=1<=arguments.length?t.call(arguments,0):[],d=function(){var t,e,n;for(n=[],t=0,e=i.length;e>t;t++)r=i[t],"string"==typeof r&&n.push(r);return n}(),"function"==typeof i[i.length-1]&&(a=i.pop()),f="object"==typeof i[i.length-1]?i.pop():{},n={index:!0,"new":!0,show:!0,edit:!0},f.except){for(T=f.except,b=0,w=T.length;w>b;b++)l=T[b],n[l]=!1;delete f.except}else if(f.only){for(l in n)y=n[l],n[l]=!1;for(A=f.only,$=0,_=A.length;_>$;$++)l=A[$],n[l]=!0;delete f.only}for(x=0,E=d.length;E>x;x++){h=d[x],g=Batman.helpers.pluralize(h),u=Batman.helpers.camelize(g,!0),s=this._childBuilder({controller:u}),null!=a&&a.call(s);for(e in n)c=n[e],c&&(v=this.constructor.ROUTES[e],o=v.name(g),p=v.path(g),m=Batman.extend({controller:u,action:e,path:p,as:o},f),s[v.cardinality](e,m))}return!0},e.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(t.call(arguments)))},e.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(t.call(arguments)))},e.prototype.root=function(t,e){return this.route("/",t,e)},e.prototype.route=function(t,e,n,r){return r||("function"==typeof n?(r=n,n=void 0):"function"==typeof e&&(r=e,e=void 0)),n?e&&(n.signature=e):(n="string"==typeof e?{signature:e}:e,n||(n={})),r&&(n.callback=r),n.as||(n.as=this._nameFromPath(t)),n.path=t,this._addRoute(n)},e.prototype._addRoutesWithCardinality=function(){var e,n,r,i,o,a,s,u,c,l;for(e=arguments[0],r=3<=arguments.length?t.call(arguments,1,u=arguments.length-1):(u=1,[]),i=arguments[u++],"string"==typeof i&&(r.push(i),i={}),i=Batman.extend({},this.baseOptions,i),i[e]=!0,s=this.constructor.ROUTES[e],o=Batman.helpers.underscore(i.controller),c=0,l=r.length;l>c;c++)n=r[c],a=Batman.extend({action:n},i),null==a.path&&(a.path=s.path(o,n)),null==a.as&&(a.as=s.name(o,n)),this._addRoute(a);return!0},e.prototype._addRoute=function(t){var e,n,r,i;return null==t&&(t={}),r=this.rootPath+t.path,n=this.rootName+Batman.helpers.camelize(t.as,!0),delete t.as,delete t.path,e=t.callback?Batman.CallbackActionRoute:Batman.ControllerActionRoute,t.app=this.app,i=new e(r,t),this.routeMap.addRoute(n,i)},e.prototype._nameFromPath=function(t){return t=t.replace(Batman.Route.regexps.namedOrSplat,"").replace(/\/+/g,".").replace(/(^\.)|(\.$)/g,"")},e.prototype._nestingPath=function(){var t,e;return this.parent?(t=":"+Batman.helpers.singularize(this.baseOptions.controller)+"Id",e=Batman.helpers.underscore(this.baseOptions.controller),""+this.parent._nestingPath()+e+"/"+t+"/"):""},e.prototype._nestingName=function(){return this.parent?this.parent._nestingName()+this.baseOptions.controller+".":""},e.prototype._childBuilder=function(t){return null==t&&(t={}),new Batman.RouteMapBuilder(this.app,this.routeMap,this,t)},e}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.App=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}var i,o,a,s,u;for(e(r,t),r.classAccessor("currentParams",{get:function(){return new Batman.Hash},"final":!0}),r.classAccessor("paramsManager",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.replacer=new Batman.ParamsReplacer(t,e)},"final":!0}),r.classAccessor("paramsPusher",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.pusher=new Batman.ParamsPusher(t,e)},"final":!0}),r.classAccessor("routes",function(){return new Batman.NamedRouteQuery(this.get("routeMap"))}),r.classAccessor("routeMap",function(){return new Batman.RouteMap}),r.classAccessor("routeMapBuilder",function(){return new Batman.RouteMapBuilder(this,this.get("routeMap"))}),r.classAccessor("dispatcher",function(){return new Batman.Dispatcher(this,this.get("routeMap"))}),r.classAccessor("controllers",function(){return this.get("dispatcher.controllers")}),r.classAccessor("_renderContext",function(){return Batman.RenderContext.base.descend(this)}),r.requirePath="",Batman.developer["do"](function(){var t;return t="Please use whatever means you'd like to load your code before calling App.run.",r.require=function(){var e,r,i,o,a,s,u=this;for(o=arguments[0],i=2<=arguments.length?n.call(arguments,1):[],Batman.developer.deprecated("App.require",t),e=this.requirePath+o,a=0,s=i.length;s>a;a++)r=i[a],this.prevent("run"),o=e+"/"+r+".coffee",new Batman.Request({url:o,type:"html",success:function(t){return CoffeeScript.eval(t),u.allow("run"),u.isPrevented("run")||u.fire("loaded"),u.wantsToRun?u.run():void 0}});return this},r.controller=function(){var e;return e=1<=arguments.length?n.call(arguments,0):[],Batman.developer.deprecated("App.controller",t),e=e.map(function(t){return t+"_controller"}),this.require.apply(this,["controllers"].concat(n.call(e)))},r.model=function(){return Batman.developer.deprecated("App.model",t),this.require.apply(this,["models"].concat(n.call(arguments)))},r.view=function(){return Batman.developer.deprecated("App.view",t),this.require.apply(this,["views"].concat(n.call(arguments)))}}),r.layout=void 0,r.shouldAllowEvent={},u=Batman.RouteMapBuilder.BUILDER_FUNCTIONS,o=function(t){return r[t]=function(){var e;return(e=this.get("routeMapBuilder"))[t].apply(e,arguments)}},a=0,s=u.length;s>a;a++)i=u[a],o(i);return r.event("ready").oneShot=!0,r.event("run").oneShot=!0,r.run=function(){var t,e,n=this;if(Batman.currentApp){if(Batman.currentApp===this)return;Batman.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,Batman.currentApp=this,Batman.App.set("current",this),null==this.get("dispatcher")&&(this.set("dispatcher",new Batman.Dispatcher(this,this.get("routeMap"))),this.set("controllers",this.get("dispatcher.controllers"))),null==this.get("navigator")&&(this.set("navigator",Batman.Navigator.forApp(this)),this.on("run",function(){return Batman.navigator=n.get("navigator"),Object.keys(n.get("dispatcher").routeMap).length>0?Batman.navigator.start():void 0})),this.observe("layout",function(t){return null!=t?t.on("ready",function(){return n.fire("ready")}):void 0}),t=this.get("layout"),t?"string"==typeof t&&(e=this[Batman.helpers.camelize(t)+"View"]):null!==t&&(e=Batman.View),e&&(t=this.set("layout",new e({context:this,node:document}))),this.hasRun=!0,this.fire("run"),this)},r.event("ready").oneShot=!0,r.event("stop").oneShot=!0,r.stop=function(){var t;return null!=(t=this.navigator)&&t.stop(),Batman.navigator=null,this.hasRun=!1,this.fire("stop"),this},r}.call(this,Batman.Object)}.call(this),function(){Batman.Association=function(){function t(t,e,n){var r,i,o,a;this.model=t,this.label=e,null==n&&(n={}),r={namespace:Batman.currentApp,name:Batman.helpers.camelize(Batman.helpers.singularize(this.label))},this.options=Batman.extend(r,this.defaultOptions,n),this.options.nestUrl&&(null==this.model.urlNestsUnder&&Batman.developer.error("You must persist the the model "+this.model.constructor.name+" to use the url helpers on an association"),this.model.urlNestsUnder(Batman.helpers.underscore(this.getRelatedModel().get("resourceName")))),null!=this.options.extend&&Batman.extend(this,this.options.extend),i={encode:this.options.saveInline?this.encoder():!1,decode:this.decoder()},this.model.encode(this.label,i),a=this,o=function(){return a.getAccessor.call(this,a,this.model,this.label)},this.model.accessor(this.label,{get:o,set:t.defaultAccessor.set,unset:t.defaultAccessor.unset})}return t.prototype.associationType="",t.prototype.isPolymorphic=!1,t.prototype.defaultOptions={saveInline:!0,autoload:!0,nestUrl:!1},t.prototype.getRelatedModel=function(){var t,e,n;return n=this.options.namespace||Batman.currentApp,t=this.options.name,e=null!=n?n[t]:void 0,Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" hasn't loaded yet.")}),e},t.prototype.getFromAttributes=function(t){return t.get("attributes."+this.label)},t.prototype.setIntoAttributes=function(t,e){return t.get("attributes").set(this.label,e)},t.prototype.inverse=function(){var t,e,n=this;return(e=this.getRelatedModel()._batman.get("associations"))?this.options.inverseOf?e.getByLabel(this.options.inverseOf):(t=null,e.forEach(function(e,r){return r.getRelatedModel()===n.model?t=r:void 0}),t):void 0},t.prototype.reset=function(){return delete this.index,!0},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PluralAssociation=function(t){function n(){n.__super__.constructor.apply(this,arguments),this._resetSetHashes()}return e(n,t),n.prototype.proxyClass=Batman.AssociationSet,n.prototype.isSingular=!1,n.prototype.setForRecord=function(t){var e,n,r=this;return n=this.indexValueForRecord(t),e=this.setIndex(),Batman.Property.withoutTracking(function(){return r._setsByRecord.getOrSet(t,function(){var t,e;return null!=n&&(t=r._setsByValue.get(n),null!=t)?t:(e=r.proxyClassInstanceForKey(n),null!=n&&r._setsByValue.set(n,e),e)})}),null!=n?e.get(n):this._setsByRecord.get(t)},n.prototype.setForKey=Batman.Property.wrapTrackingPrevention(function(t){var e,n=this;return e=void 0,this._setsByRecord.forEach(function(r,i){return null==e?n.indexValueForRecord(r)===t?e=i:void 0:void 0}),null!=e?(e.foreignKeyValue=t,e):this._setsByValue.getOrSet(t,function(){return n.proxyClassInstanceForKey(t)})}),n.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this)},n.prototype.getAccessor=function(t){var e,n,r=this;if(t.getRelatedModel())return(n=t.getFromAttributes(this))?n:(e=t.setForRecord(this),t.setIntoAttributes(this,e),Batman.Property.withoutTracking(function(){return!t.options.autoload||r.isNew()||e.loaded?void 0:e.load(function(t){if(t)throw t})}),e)},n.prototype.parentSetIndex=function(){return this.parentIndex||(this.parentIndex=this.model.get("loaded").indexedByUnique(this.primaryKey)),this.parentIndex},n.prototype.setIndex=function(){return this.index||(this.index=new Batman.AssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},n.prototype.indexValueForRecord=function(t){return t.get(this.primaryKey)},n.prototype.reset=function(){return n.__super__.reset.apply(this,arguments),this._resetSetHashes()},n.prototype._resetSetHashes=function(){return this._setsByRecord=new Batman.SimpleHash,this._setsByValue=new Batman.SimpleHash},n}(Batman.Association)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HasManyAssociation=function(t){function n(t,e,r){return(null!=r?r.as:void 0)?function(t,e,n){n.prototype=t.prototype;var r=new n,i=t.apply(r,e),o=typeof i;return"object"==o||"function"==o?i||r:r}(Batman.PolymorphicHasManyAssociation,arguments,function(){}):(n.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(t.get("resourceName"))+"_id",void 0)}return e(n,t),n.prototype.associationType="hasMany",n.prototype.indexRelatedModelOn="foreignKey",n.prototype.apply=function(t,e){var n,r,i=this;return t||((n=this.getFromAttributes(e))&&n.forEach(function(t){return t.set(i.foreignKey,e.get(i.primaryKey))}),e.set(this.label,r=this.setForRecord(e)),"creating"!==e.lifecycle.get("state"))?void 0:r.markAsLoaded()},n.prototype.encoder=function(){var t;return t=this,function(e,n,r,i){var o;return null!=e&&(o=[],e.forEach(function(e){var n;return n=e.toJSON(),(!t.inverse()||t.inverse().options.encodeForeignKey)&&(n[t.foreignKey]=i.get(t.primaryKey)),o.push(n)})),o}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,i,o){var a,s,u,c,l,f,p,h,d;if(f=t.getRelatedModel()){for(s=t.getFromAttributes(o)||t.setForRecord(o),c=s.filter(function(t){return t.isNew()}).toArray(),h=0,d=e.length;d>h;h++)u=e[h],l=new f,l._withoutDirtyTracking(function(){return this.fromJSON(u)}),a=f.get("loaded").indexedByUnique("id").get(l.get("id")),null!=a?(a._withoutDirtyTracking(function(){return this.fromJSON(u)}),l=a):c.length>0&&(p=c.shift(),p._withoutDirtyTracking(function(){return this.fromJSON(u)}),l=p),l=f._mapIdentity(l),s.add(l),t.options.inverseOf&&l.set(t.options.inverseOf,o);s.markAsLoaded()}else Batman.developer.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!");return s}},n}(Batman.PluralAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicHasManyAssociation=function(t){function n(t,e,r){r.inverseOf=this.foreignLabel=r.as,delete r.as,r.foreignKey||(r.foreignKey=""+this.foreignLabel+"_id"),n.__super__.constructor.call(this,t,e,r),this.foreignTypeKey=r.foreignTypeKey||""+this.foreignLabel+"_type",this.model.encode(this.foreignTypeKey)}return e(n,t),n.prototype.proxyClass=Batman.PolymorphicAssociationSet,n.prototype.isPolymorphic=!0,n.prototype.apply=function(t,e){var r,i=this;return t||(r=this.getFromAttributes(e))&&(n.__super__.apply.apply(this,arguments),r.forEach(function(t){return t.set(i.foreignTypeKey,i.modelType())})),!0},n.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this.modelType(),this)},n.prototype.getRelatedModelForType=function(t){var e,n;return n=this.options.namespace||Batman.currentApp,t?(e=null!=n?n[t]:void 0,e||(e=null!=n?n[Batman.helpers.camelize(t)]:void 0)):e=this.getRelatedModel(),Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" for polymorphic association not found.")}),e},n.prototype.modelType=function(){return this.model.get("resourceName")},n.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new Batman.PolymorphicAssociationSetIndex(this,this.modelType(),this[this.indexRelatedModelOn])),this.typeIndex},n.prototype.encoder=function(){var t;return t=this,function(e,n,r,i){var o;return null!=e&&(o=[],e.forEach(function(e){var n;return n=e.toJSON(),n[t.foreignKey]=i.get(t.primaryKey),n[t.foreignTypeKey]=t.modelType(),o.push(n)})),o}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,i,o){var a,s,u,c,l,f,p,h,d,g,m;if(f=t.getRelatedModel()){for(s=t.getFromAttributes(o)||t.setForRecord(o),c=s.filter(function(t){return t.isNew()}).toArray(),g=0,m=e.length;m>g;g++)u=e[g],d=u[t.options.foreignTypeKey],h=t.getRelatedModelForType(d),l=new h,l._withoutDirtyTracking(function(){return this.fromJSON(u)}),a=f.get("loaded").indexedByUnique("id").get(l.get("id")),null!=a?(a._withoutDirtyTracking(function(){return this.fromJSON(u)}),l=a):c.length>0&&(p=c.shift(),p._withoutDirtyTracking(function(){return this.fromJSON(u)}),l=p),l=f._mapIdentity(l),s.add(l),t.options.inverseOf&&l.set(t.options.inverseOf,o);s.markAsLoaded()}else Batman.developer.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!");return s}},n}(Batman.HasManyAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SingularAssociation=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.isSingular=!0,n.prototype.getAccessor=function(t){var e,n,r,i,o;return(i=t.getFromAttributes(this))?i:t.getRelatedModel()?(n=this.associationProxy(t),r=!1,e=this,null==(o=n._loadSetter)&&(n._loadSetter=n.once("loaded",function(n){return e._withoutDirtyTracking(function(){return this.set(t.label,n)})})),Batman.Property.withoutTracking(function(){return n.get("loaded")})||(t.options.autoload?Batman.Property.withoutTracking(function(){return n.load()}):r=n.loadFromLocal()),r||n):void 0},n.prototype.setIndex=function(){return this.index||(this.index=new Batman.UniqueAssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},n}(Batman.Association)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HasOneAssociation=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(this.model.get("resourceName"))+"_id"}return e(n,t),n.prototype.associationType="hasOne",n.prototype.proxyClass=Batman.HasOneProxy,n.prototype.indexRelatedModelOn="foreignKey",n.prototype.apply=function(t,e){var n;return(n=this.getFromAttributes(e))?n.set(this.foreignKey,e.get(this.primaryKey)):void 0},n.prototype.encoder=function(){var t;return t=this,function(e,n,r,i){var o;if(t.options.saveInline)return(o=e.toJSON())&&(o[t.foreignKey]=i.get(t.primaryKey)),o}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,i,o){var a,s;if(e)return s=t.getRelatedModel(),a=s.createFromJSON(e),t.options.inverseOf&&a.set(t.options.inverseOf,o),a}},n}(Batman.SingularAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.BelongsToAssociation=function(t){function n(t,e,r){return(null!=r?r.polymorphic:void 0)?(delete r.polymorphic,function(t,e,n){n.prototype=t.prototype;var r=new n,i=t.apply(r,e),o=typeof i;return"object"==o||"function"==o?i||r:r}(Batman.PolymorphicBelongsToAssociation,arguments,function(){})):(n.__super__.constructor.apply(this,arguments),this.foreignKey=this.options.foreignKey||""+this.label+"_id",this.primaryKey=this.options.primaryKey||"id",this.options.encodeForeignKey&&this.model.encode(this.foreignKey),void 0)}return e(n,t),n.prototype.associationType="belongsTo",n.prototype.proxyClass=Batman.BelongsToProxy,n.prototype.indexRelatedModelOn="primaryKey",n.prototype.defaultOptions={saveInline:!1,autoload:!0,encodeForeignKey:!0},n.prototype.encoder=function(){return function(t){return t.toJSON()
}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,i,o){var a,s,u;return u=t.getRelatedModel(),s=u.createFromJSON(e),t.options.inverseOf&&(a=t.inverse())&&(a instanceof Batman.HasManyAssociation?o.set(t.foreignKey,s.get(t.primaryKey)):s.set(a.label,o)),o.set(t.label,s),s}},n.prototype.apply=function(t){var e,n;return(n=t.get(this.label))&&(e=n.get(this.primaryKey),void 0!==e)?t.set(this.foreignKey,e):void 0},n}(Batman.SingularAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicBelongsToAssociation=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.foreignTypeKey=this.options.foreignTypeKey||""+this.label+"_type",this.options.encodeForeignTypeKey&&this.model.encode(this.foreignTypeKey),this.typeIndicies={}}return e(n,t),n.prototype.isPolymorphic=!0,n.prototype.proxyClass=Batman.PolymorphicBelongsToProxy,n.prototype.defaultOptions=Batman.mixin({},Batman.BelongsToAssociation.prototype.defaultOptions,{encodeForeignTypeKey:!0}),n.prototype.getRelatedModel=!1,n.prototype.setIndex=!1,n.prototype.inverse=!1,n.prototype.apply=function(t){var e,r;return n.__super__.apply.apply(this,arguments),(r=t.get(this.label))?(e=r instanceof Batman.PolymorphicBelongsToProxy?r.get("foreignTypeValue"):r.constructor.get("resourceName"),t.set(this.foreignTypeKey,e)):void 0},n.prototype.getAccessor=function(t){var e,n;return(n=t.getFromAttributes(this))?n:t.getRelatedModelForType(this.get(t.foreignTypeKey))?(e=this.associationProxy(t),Batman.Property.withoutTracking(function(){return!e.get("loaded")&&t.options.autoload?e.load():void 0}),e):void 0},n.prototype.url=function(t){var e,n,r,i,o,a,s,u;return a=null!=(s=t.data)?s[this.foreignTypeKey]:void 0,a&&(i=this.inverseForType(a))?(o=Batman.helpers.pluralize(a).toLowerCase(),r=null!=(u=t.data)?u[this.foreignKey]:void 0,n=i.isSingular?"singularize":"pluralize",e=Batman.helpers[n](i.label),"/"+o+"/"+r+"/"+e):void 0},n.prototype.getRelatedModelForType=function(t){var e,n;return n=this.options.namespace||Batman.currentApp,t&&(e=null!=n?n[t]:void 0,e||(e=null!=n?n[Batman.helpers.camelize(t)]:void 0)),Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" for polymorphic association not found.")}),e},n.prototype.setIndexForType=function(t){var e;return(e=this.typeIndicies)[t]||(e[t]=new Batman.PolymorphicUniqueAssociationSetIndex(this,t,this.primaryKey)),this.typeIndicies[t]},n.prototype.inverseForType=function(t){var e,n,r,i=this;return(n=null!=(r=this.getRelatedModelForType(t))?r._batman.get("associations"):void 0)?this.options.inverseOf?n.getByLabel(this.options.inverseOf):(e=null,n.forEach(function(t,n){return n.getRelatedModel()===i.model?e=n:void 0}),e):void 0},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,i,o){var a,s,u,c;return a=r[t.foreignTypeKey]||o.get(t.foreignTypeKey),c=t.getRelatedModelForType(a),u=c.createFromJSON(e),t.options.inverseOf&&(s=t.inverseForType(a))&&(s instanceof Batman.PolymorphicHasManyAssociation?(o.set(t.foreignKey,u.get(t.primaryKey)),o.set(t.foreignTypeKey,a)):u.set(s.label,o)),o.set(t.label,u),u}},n}(Batman.BelongsToAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.Validator=function(t){function r(){var t,e;e=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],this.options=e,r.__super__.constructor.apply(this,t)}return e(r,t),r.triggers=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],null!=this._triggers?this._triggers.concat(t):this._triggers=t},r.options=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],null!=this._options?this._options.concat(t):this._options=t},r.matches=function(t){var e,n,r,i,o,a;n={},r=!1;for(e in t)i=t[e],~(null!=(o=this._options)?o.indexOf(e):void 0)&&(n[e]=i),~(null!=(a=this._triggers)?a.indexOf(e):void 0)&&(n[e]=i,r=!0);return r?n:void 0},r.prototype.validate=function(){return Batman.developer.error("You must override validate in Batman.Validator subclasses.")},r.prototype.format=function(t,e,n){return Batman.t("errors.messages."+e,n)},r.prototype.handleBlank=function(t){return this.options.allowBlank&&!Batman.PresenceValidator.prototype.isPresent(t)?!0:void 0},r}(Batman.Object)}.call(this),function(){Batman.Validators=[],Batman.extend(Batman.translate.messages,{errors:{format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",equal_to:"must be equal to %{count}",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",not_matching:"is not valid",invalid_association:"is not valid"}}})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RegExpValidator=function(t){function n(t){var e;this.regexp=null!=(e=t.regexp)?e:t.pattern,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("regexp","pattern"),n.options("allowBlank"),n.prototype.validateEach=function(t,e,n,r){var i;return i=e.get(n),this.handleBlank(i)?r():(null!=i&&""!==i&&this.regexp.test(i)||t.add(n,this.format(n,"not_matching")),r())},n}(Batman.Validator),Batman.Validators.push(Batman.RegExpValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PresenceValidator=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("presence"),n.prototype.validateEach=function(t,e,n,r){var i;return i=e.get(n),this.isPresent(i)||t.add(n,this.format(n,"blank")),r()},n.prototype.isPresent=function(t){return null!=t&&""!==t},n}(Batman.Validator),Batman.Validators.push(Batman.PresenceValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.NumericValidator=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("numeric","greaterThan","greaterThanOrEqualTo","equalTo","lessThan","lessThanOrEqualTo"),n.options("allowBlank"),n.prototype.validateEach=function(t,e,n,r){var i,o;return i=this.options,o=e.get(n),this.handleBlank(o)?r():(null==o||!this.isNumeric(o)&&!this.canCoerceToNumeric(o)?t.add(n,this.format(n,"not_numeric")):(i.greaterThan&&o<=i.greaterThan&&t.add(n,this.format(n,"greater_than",{count:i.greaterThan})),i.greaterThanOrEqualTo&&o<i.greaterThanOrEqualTo&&t.add(n,this.format(n,"greater_than_or_equal_to",{count:i.greaterThanOrEqualTo})),i.equalTo&&o!==i.equalTo&&t.add(n,this.format(n,"equal_to",{count:i.equalTo})),i.lessThan&&o>=i.lessThan&&t.add(n,this.format(n,"less_than",{count:i.lessThan})),i.lessThanOrEqualTo&&o>i.lessThanOrEqualTo&&t.add(n,this.format(n,"less_than_or_equal_to",{count:i.lessThanOrEqualTo}))),r())},n.prototype.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},n.prototype.canCoerceToNumeric=function(t){return t-0==t&&t.length>0},n}(Batman.Validator),Batman.Validators.push(Batman.NumericValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.LengthValidator=function(t){function n(t){var e;(e=t.lengthIn||t.lengthWithin)&&(t.minLength=e[0],t.maxLength=e[1]||-1,delete t.lengthWithin,delete t.lengthIn),n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("minLength","maxLength","length","lengthWithin","lengthIn"),n.options("allowBlank"),n.prototype.validateEach=function(t,e,n,r){var i,o;return i=this.options,o=e.get(n),""!==o&&this.handleBlank(o)?r():(null==o&&(o=[]),i.minLength&&o.length<i.minLength&&t.add(n,this.format(n,"too_short",{count:i.minLength})),i.maxLength&&o.length>i.maxLength&&t.add(n,this.format(n,"too_long",{count:i.maxLength})),i.length&&o.length!==i.length&&t.add(n,this.format(n,"wrong_length",{count:i.length})),r())},n}(Batman.Validator),Batman.Validators.push(Batman.LengthValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociatedValidator=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("associated"),n.prototype.validateEach=function(t,e,n,r){var i,o,a,s=this;return a=e.get(n),null!=a?(a instanceof Batman.AssociationProxy&&(a="function"==typeof a.get?a.get("target"):void 0),o=1,i=function(e,i){return i.length>0&&t.add(n,s.format(n,"invalid_association")),0===--o?r():void 0},null!=(null!=a?a.forEach:void 0)?a.forEach(function(t){return o+=1,t.validate(i)}):null!=(null!=a?a.validate:void 0)&&(o+=1,a.validate(i)),i(null,[])):r()},n}(Batman.Validator),Batman.Validators.push(Batman.AssociatedValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ControllerActionFrame=function(t){function n(t,e){n.__super__.constructor.call(this,t),this.once("complete",e)}return e(n,t),n.prototype.operationOccurred=!1,n.prototype.remainingOperations=0,n.prototype.event("complete").oneShot=!0,n.prototype.startOperation=function(t){return null==t&&(t={}),t.internal||(this.operationOccurred=!0),this._changeOperationsCounter(1),!0},n.prototype.finishOperation=function(){return this._changeOperationsCounter(-1),!0},n.prototype.startAndFinishOperation=function(t){return this.startOperation(t),this.finishOperation(t),!0},n.prototype._changeOperationsCounter=function(t){var e;this.remainingOperations+=t,0===this.remainingOperations&&this.fire("complete"),null!=(e=this.parentFrame)&&e._changeOperationsCounter(t)},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.InsertionBinding=function(t){function n(t){var e=this;this.invert=t.invert,this.placeholderNode=document.createComment("detached node "+this.get("_batmanID")),n.__super__.constructor.apply(this,arguments),Batman.DOM.onParseExit(this.node,function(){return e.bind(),null!=e.placeholderNode?Batman.DOM.trackBinding(e,e.placeholderNode):void 0})}return e(n,t),n.prototype.isTwoWay=!1,n.prototype.bindImmediately=!1,n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){var e;if(e=this.placeholderNode.parentNode||this.node.parentNode,!!t==!this.invert){if(null==this.node.parentNode)return Batman.DOM.insertBefore(e,this.node,this.placeholderNode),e.removeChild(this.placeholderNode)}else if(null!=this.node.parentNode)return e.insertBefore(this.placeholderNode,this.node),Batman.DOM.removeNode(this.node)},n.prototype.die=function(){var t,e,r;if(!this.dead)return e=this.node,r=this.placeholderNode,t=this.get("filteredValue"),n.__super__.die.apply(this,arguments),!!t==!this.invert?Batman.DOM.destroyNode(r):Batman.DOM.destroyNode(e)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t;t=function(t){var e;for(e in t)return!1;return!0},Batman.extend(Batman,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){var t;try{return t=document.createElement("div"),delete t.test}catch(e){return Batman.canDeleteExpando=!1}}(),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?Batman.cache[e[Batman.expando]]:e[Batman.expando],!!e&&!t(e)},data:function(t,e,n,r){var i,o,a,s,u,c;if(Batman.acceptData(t)&&(s=Batman.expando,o="string"==typeof e,i=Batman.cache,a=t[Batman.expando],!(!a||r&&a&&i[a]&&!i[a][s])||!o||void 0!==n))return a||(3!==t.nodeType?t[Batman.expando]=a=++Batman.uuid:a=Batman.expando),i[a]||(i[a]={}),("object"==typeof e||"function"==typeof e)&&(r?i[a][s]=Batman.extend(i[a][s],e):i[a]=Batman.extend(i[a],e)),c=i[a],r&&(c[s]||(c[s]={}),c=c[s]),void 0!==n&&(c[e]=n),u=o?c[e]:c},removeData:function(e,n,r){var i,o,a,s,u,c;if(Batman.acceptData(e)&&(s=Batman.expando,u=e.nodeType,i=Batman.cache,o=e[Batman.expando],i[o]&&!(n&&(c=r?i[o][s]:i[o],c&&(delete c[n],!t(c)))||r&&(delete i[o][s],!t(i[o])))))return a=i[o][s],Batman.canDeleteExpando||!i.setInterval?delete i[o]:i[o]=null,a?(i[o]={},i[o][s]=a):Batman.canDeleteExpando?delete e[Batman.expando]:e.removeAttribute?e.removeAttribute(Batman.expando):e[Batman.expando]=null},_data:function(t,e,n){return Batman.data(t,e,n,!0)},acceptData:function(t){var e;return t.nodeName&&(e=Batman.noData[t.nodeName.toLowerCase()])?!(e===!0||t.getAttribute("classid")!==e):!0}})}.call(this),function(){var t,e,n=[].slice;t=function(t){return function(e){return null==e?void 0:t.apply(this,arguments)}},e=function(t,e){return t||e},Batman.Filters={raw:t(function(t,e){return e.escapeValue=!1,t}),get:t(function(t,e){return null!=t.get?t.get(e):t[e]}),equals:t(function(t,e){return t===e}),and:function(t,e){return t&&e},or:function(t,e){return t||e},not:function(t){return!t},trim:t(function(t){return t.trim()}),matches:t(function(t,e){return-1!==t.indexOf(e)}),truncate:t(function(t,e,n,r){return null==n&&(n="..."),r||(r=n,n="..."),t.length>e&&(t=t.substr(0,e-n.length)+n),t}),"default":function(t,e){return null!=t&&""!==t?t:e},prepend:function(t,e){return(null!=e?e:"")+(null!=t?t:"")},append:function(t,e){return(null!=t?t:"")+(null!=e?e:"")},replace:t(function(t,e,n,r,i){return i||(i=r,r=void 0),void 0===r?t.replace(e,n):t.replace(e,n,r)}),downcase:t(function(t){return t.toLowerCase()}),upcase:t(function(t){return t.toUpperCase()}),pluralize:t(function(t,e,n,r){return r||(r=n,n=!0,r||(r=e,e=void 0)),null!=e?Batman.helpers.pluralize(e,t,void 0,n):Batman.helpers.pluralize(t)}),humanize:t(function(t){return Batman.helpers.humanize(t)}),join:t(function(t,e,n){return null==e&&(e=""),n||(n=e,e=""),t.join(e)}),sort:t(function(t){return t.sort()}),map:t(function(t,e){return t.map(function(t){return Batman.get(t,e)})}),has:function(t,e){return null==t?!1:Batman.contains(t,e)},first:t(function(t){return t[0]}),meta:t(function(t,e){return Batman.developer.assert(t.meta,"Error, value doesn't have a meta to filter on!"),t.meta.get(e)}),interpolate:function(t,e,n){var r,i,o;if(n||(n=e,e=void 0),t){o={};for(r in e)i=e[r],o[r]=this.get(i),null==o[r]&&(Batman.developer.warn("Warning! Undefined interpolation key "+r+" for interpolation",t),o[r]="");return Batman.helpers.interpolate(t,o)}},withArguments:function(){var t,e,r,i;return e=arguments[0],r=3<=arguments.length?n.call(arguments,1,i=arguments.length-1):(i=1,[]),t=arguments[i++],e?function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.call.apply(e,[this].concat(n.call(r),n.call(t)))}:void 0},routeToAction:t(function(t,e){var n;return n=Batman.Dispatcher.paramsFromArgument(t),n.action=e,n}),escape:t(Batman.escapeHTML)},function(){var e,n,r,i,o;for(i=["capitalize","singularize","underscore","camelize"],o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(Batman.Filters[e]=t(Batman.helpers[e]));return o}(),Batman.developer.addFilters()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RenderContext=function(){function t(t,e){this.object=t,this.parent=e}var n;return t.deProxy=function(t){return null!=t&&t.isContextProxy?t.get("proxiedObject"):t},t.root=function(){var t;return null!=Batman.currentApp&&(t=Batman.currentApp.get("_renderContext")),null!=t?t:t=this.base},t.prototype.windowWrapper={window:Batman.container},t.prototype.findKey=function(t){var e,n,r;for(e=t.split(".")[0].split("|")[0].trim(),n=this;n;){if(r=Batman.get(n.object,e),"undefined"!=typeof r)return r=Batman.get(n.object,t),[r,n.object].map(this.constructor.deProxy);n=n.parent}return[Batman.get(this.windowWrapper,t),this.windowWrapper]},t.prototype.get=function(t){return this.findKey(t)[0]},t.prototype.contextForKey=function(t){return this.findKey(t)[1]},t.prototype.descend=function(t,e){var n;return e&&(n=t,t=new Batman.Object,t[e]=n),new this.constructor(t,this)},t.prototype.descendWithDefinition=function(t){var e;return e=new n(t),this.descend(e,t.attr)},t.prototype.chain=function(){var t,e;for(e=[],t=this;t;)e.push(t.object),t=t.parent;return e},t.ContextProxy=n=function(t){function n(t){this.binding=new Batman.DOM.AbstractBinding(t)}return e(n,t),n.prototype.isContextProxy=!0,n.accessor("proxiedObject",function(){return this.binding.get("filteredValue")}),n.accessor({get:function(t){return this.get("proxiedObject."+t)},set:function(t,e){return this.set("proxiedObject."+t,e)},unset:function(t){return this.unset("proxiedObject."+t)}}),n}(Batman.Object),t}.call(this),Batman.RenderContext.base=new Batman.RenderContext(Batman.RenderContext.prototype.windowWrapper)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ViewStore=function(t){function n(){n.__super__.constructor.apply(this,arguments),this._viewContents={},this._requestedPaths=new Batman.SimpleSet}return e(n,t),n.prototype.propertyClass=Batman.Property,n.prototype.fetchView=function(t){var e=this;return new Batman.Request({url:Batman.Navigator.normalizePath(Batman.config.viewPrefix,""+t+".html"),type:"html",success:function(n){return e.set(t,n)},error:function(){throw new Error("Could not load view from "+t)}})},n.accessor({"final":!0,get:function(t){var e;if("/"!==t.charAt(0))return this.get("/"+t);if(this._viewContents[t])return this._viewContents[t];if(!this._requestedPaths.has(t)){if(e=this._sourceFromDOM(t))return e;if(!Batman.config.fetchRemoteViews)throw new Error("Couldn't find view source for '"+t+"'!");this.fetchView(t)}},set:function(t,e){return"/"!==t.charAt(0)?this.set("/"+t,e):(this._requestedPaths.add(t),this._viewContents[t]=e)}}),n.prototype.prefetch=function(t){return this.get(t),!0},n.prototype._sourceFromDOM=function(t){var e,n;return n=t.slice(1),(e=Batman.DOM.querySelector(document,"[data-defineview*='"+n+"']"))?(Batman.setImmediate(function(){var t;return null!=(t=e.parentNode)?t.removeChild(e):void 0}),Batman.DOM.defineView(t,e)):void 0},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.View=function(t){function r(t){var e,n=this;null==t&&(t={}),e=t.context,e?e instanceof Batman.RenderContext||(e=Batman.RenderContext.root().descend(e)):e=Batman.RenderContext.root(),t.context=e.descend(this),r.__super__.constructor.call(this,t),Batman.Property.withoutTracking(function(){return n.observeAndFire("readyToRender",function(t){return t?n.render():void 0})})}return e(r,t),r.YieldStorage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.wrapAccessor(function(t){return{get:function(e){var n;return n=t.get.call(this,e),null==n&&(n=this.set(e,[])),n}}}),n}(Batman.Hash),r.store=new Batman.ViewStore,r.option=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],this.accessor.apply(this,n.call(t).concat([{get:function(t){var e;return null!=(e=this.get("argumentBindings."+t))?e.get("filteredValue"):void 0},set:function(t,e){var n;return null!=(n=this.get("argumentBindings."+t))?n.set("filteredValue",e):void 0},unset:function(t){var e;return null!=(e=this.get("argumentBindings."+t))?e.unset("filteredValue"):void 0}}]))},r.prototype.isView=!0,r.prototype.cache=!0,r.prototype._rendered=!1,r.prototype.node=null,r.prototype.event("ready").oneShot=!0,r.accessor("argumentBindings",function(){var t=this;return new Batman.TerminalAccessible(function(e){var n,r,i,o,a,s;if((a=t.get("node"))&&(r=t.get("context"))&&(o=a.getAttribute(("data-view-"+e).toLowerCase()),null!=o))return n="_argumentBinding"+e,null!=(s=t[n])&&s.die(),i=new Batman.DOM.ReaderBindingDefinition(a,o,r),t[n]=new Batman.DOM.ViewArgumentBinding(i)})}),r.accessor("html",{get:function(){var t;if(this.html&&this.html.length>0)return this.html;if(t=this.get("source"))return t=Batman.Navigator.normalizePath(t),this.html=this.constructor.store.get(t)},set:function(t,e){return this.html=e}}),r.accessor("node",{get:function(){var t;if(null==this.node){if(t=this.get("html"),!(t&&t.length>0))return;this.node=document.createElement("div"),this._setNodeOwner(this.node),Batman.DOM.setInnerHTML(this.node,t)}return this.node},set:function(t,e){var n,r=this;return this.node=e,this._setNodeOwner(e),n=function(t){return null!=t?(Batman.DOM.setInnerHTML(r.node,t),r.forget("html",n)):void 0},this.observeAndFire("html",n),e}}),r.accessor("yields",function(){return new this.constructor.YieldStorage}),r.accessor("fetched?",function(){return null!=this.get("source")}),r.accessor("readyToRender",function(){var t;return this.get("node")&&(this.get("fetched?")?(null!=(t=this.get("html"))?t.length:void 0)>0:!0)}),r.prototype.render=function(){var t,e=this;if(!this._rendered)return this._rendered=!0,this._renderer=new Batman.Renderer(t=this.get("node"),this.get("context"),this),this._renderer.once("rendered",function(){return e.fire("ready",t)})},r.prototype.isInDOM=function(){var t;return(t=this.get("node"))?null!=t.parentNode||this.get("yields").some(function(e,n){var r,i;for(r=0,i=n.length;i>r;r++)if(t=n[r].node,null!=t.parentNode)return!0;return!1}):!1},r.prototype.die=function(){var t;return this.fire("destroy",this.node),this.forget(),null!=(t=this._batman.properties)&&t.forEach(function(t,e){return e.die()}),this.get("yields").forEach(function(t,e){var n,r,i,o;for(o=[],r=0,i=e.length;i>r;r++)n=e[r].node,o.push(Batman.DOM.didDestroyNode(n));return o})},r.prototype.applyYields=function(){return this.get("yields").forEach(function(t,e){var n,r,i,o,a,s,u;for(i=Batman.DOM.Yield.withName(t),u=[],o=0,a=e.length;a>o;o++)s=e[o],r=s.node,n=s.action,u.push(i[n](r));return u})},r.prototype.retractYields=function(){return this.get("yields").forEach(function(t,e){var n,r,i,o,a;for(a=[],r=0,i=e.length;i>r;r++)n=e[r].node,a.push(null!=(o=n.parentNode)?o.removeChild(n):void 0);return a})},r.prototype.pushYieldAction=function(t,e,n){return this._setNodeYielder(n),this.get("yields").get(t).push({node:n,action:e})},r.prototype._setNodeOwner=function(t){return Batman._data(t,"view",this)},r.prototype._setNodeYielder=function(t){return Batman._data(t,"yielder",this)},r.prototype.on("ready",function(){return"function"==typeof this.ready?this.ready.apply(this,arguments):void 0}),r.prototype.on("appear",function(){return"function"==typeof this.viewDidAppear?this.viewDidAppear.apply(this,arguments):void 0}),r.prototype.on("disappear",function(){return"function"==typeof this.viewDidDisappear?this.viewDidDisappear.apply(this,arguments):void 0}),r.prototype.on("beforeAppear",function(){return"function"==typeof this.viewWillAppear?this.viewWillAppear.apply(this,arguments):void 0}),r.prototype.on("beforeDisappear",function(){return"function"==typeof this.viewWillDisappear?this.viewWillDisappear.apply(this,arguments):void 0}),r}.call(this,Batman.Object)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.DOM.Yield=t=function(t){function e(){this.cycle()}return n(e,t),e.yields={},e.queued=function(t){return function(){var e,n,i=this;return e=1<=arguments.length?r.call(arguments,0):[],null!=this.containerNode?t.apply(this,e):n=this.observe("containerNode",function(){var r;return r=t.apply(i,e),i.forget("containerNode",n),r})}},e.reset=function(){return this.yields={}},e.withName=function(t){var e;return(e=this.yields)[t]||(e[t]=new this({name:t})),this.yields[t]},e.forEach=function(t){var e,n,r;r=this.yields;for(e in r)n=r[e],t(n)},e.clearAll=function(){return this.forEach(function(t){return t.clear()})},e.cycleAll=function(){return this.forEach(function(t){return t.cycle()})},e.clearAllStale=function(){return this.forEach(function(t){return t.clearStale()})},e.prototype.cycle=function(){return this.currentVersionNodes=[]},e.prototype.clear=e.queued(function(){var t,e,n,r,i;for(this.cycle(),r=function(){var e,n,r,i;for(r=this.containerNode.childNodes,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t);return i}.call(this),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(Batman.DOM.removeOrDestroyNode(t));return i}),e.prototype.clearStale=e.queued(function(){var t,e,n,r,i;for(r=function(){var e,n,r,i;for(r=this.containerNode.childNodes,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t);return i}.call(this),i=[],e=0,n=r.length;n>e;e++)t=r[e],~this.currentVersionNodes.indexOf(t)||i.push(Batman.DOM.removeOrDestroyNode(t));return i}),e.prototype.append=e.queued(function(t){return this.currentVersionNodes.push(t),Batman.DOM.appendChild(this.containerNode,t,!0)}),e.prototype.replace=e.queued(function(t){return this.clear(),this.append(t)}),e}(Batman.Object)}.call(this),function(){}.call(this),/*!
  * Reqwest! A general purpose XHR connection manager
  * (c) Dustin Diaz 2011
  * https://github.com/ded/reqwest
  * license MIT
  */
!function(t,e){"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(t,e):this[t]=e()}("reqwest",function(){function handleReadyState(t,e,n){return function(){t&&4==t[readyState]&&(twoHundo.test(t.status)?e(t):n(t))}}function setHeaders(t,e){var n,r=e.headers||{};r.Accept=r.Accept||defaultHeaders.accept[e.type]||defaultHeaders.accept["*"],e.crossOrigin||r[requestedWith]||(r[requestedWith]=defaultHeaders.requestedWith),r[contentType]||(r[contentType]=e.contentType||defaultHeaders.contentType);for(n in r)r.hasOwnProperty(n)&&t.setRequestHeader(n,r[n])}function generalCallback(t){lastValue=t}function urlappend(t,e){return t+(/\?/.test(t)?"&":"?")+e}function handleJsonp(t,e,n,r){var i=uniqid++,o=t.jsonpCallback||"callback",a=t.jsonpCallbackName||"reqwest_"+i,s=new RegExp("((^|\\?|&)"+o+")=([^&]+)"),u=r.match(s),c=doc.createElement("script"),l=0;u?"?"===u[3]?r=r.replace(s,"$1="+a):a=u[3]:r=urlappend(r,o+"="+a),win[a]=generalCallback,c.type="text/javascript",c.src=r,c.async=!0,"undefined"!=typeof c.onreadystatechange&&(c.event="onclick",c.htmlFor=c.id="_reqwest_"+i),c.onload=c.onreadystatechange=function(){return c[readyState]&&"complete"!==c[readyState]&&"loaded"!==c[readyState]||l?!1:(c.onload=c.onreadystatechange=null,c.onclick&&c.onclick(),t.success&&t.success(lastValue),lastValue=void 0,head.removeChild(c),l=1,void 0)},head.appendChild(c)}function getRequest(t,e,n){var r,i=(t.method||"GET").toUpperCase(),o="string"==typeof t?t:t.url,a=t.processData!==!1&&t.data&&"string"!=typeof t.data?reqwest.toQueryString(t.data):t.data||null;return"jsonp"!=t.type&&"GET"!=i||!a||(o=urlappend(o,a),a=null),"jsonp"==t.type?handleJsonp(t,e,n,o):(r=xhr(),r.open(i,o,!0),setHeaders(r,t),r.onreadystatechange=handleReadyState(r,e,n),t.before&&t.before(r),r.send(a),r)}function Reqwest(t,e){this.o=t,this.fn=e,init.apply(this,arguments)}function setType(t){var e=t.match(/\.(json|jsonp|html|xml)(\?|$)/);return e?e[1]:"js"}function init(o,fn){function complete(t){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(t)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(t,e,n){o.error&&o.error(t,e,n),complete(t)}this.url="string"==typeof o?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(t,e){return new Reqwest(t,e)}function normalize(t){return t?t.replace(/\r?\n/g,"\r\n"):""}function serial(t,e){var n=t.name,r=t.tagName.toLowerCase(),i=function(t){t&&!t.disabled&&e(n,normalize(t.attributes.value&&t.attributes.value.specified?t.value:t.text))};if(!t.disabled&&n)switch(r){case"input":if(!/reset|button|image|file/i.test(t.type)){var o=/checkbox/i.test(t.type),a=/radio/i.test(t.type),s=t.value;(!(o||a)||t.checked)&&e(n,normalize(o&&""===s?"on":s))}break;case"textarea":e(n,normalize(t.value));break;case"select":if("select-one"===t.type.toLowerCase())i(t.selectedIndex>=0?t.options[t.selectedIndex]:null);else for(var u=0;t.length&&u<t.length;u++)t.options[u].selected&&i(t.options[u])}}function eachFormElement(){var t,e,n,r=this,i=function(t,e){for(var i=0;i<e.length;i++){var o=t[byTag](e[i]);for(n=0;n<o.length;n++)serial(o[n],r)}};for(e=0;e<arguments.length;e++)t=arguments[e],/input|select|textarea/i.test(t.tagName)&&serial(t,r),i(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var t={};return eachFormElement.apply(function(e,n){e in t?(t[e]&&!isArray(t[e])&&(t[e]=[t[e]]),t[e].push(n)):t[e]=n},arguments),t}var context=this,win=window,doc=document,old=context.reqwest,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var t=[];return eachFormElement.apply(function(e,n){t.push({name:e,value:n})},arguments),t},reqwest.serialize=function(){if(0===arguments.length)return"";var t,e,n=Array.prototype.slice.call(arguments,0);return t=n.pop(),t&&t.nodeType&&n.push(t)&&(t=null),t&&(t=t.type),e="map"==t?serializeHash:"array"==t?reqwest.serializeArray:serializeQueryString,e.apply(null,n)},reqwest.toQueryString=function(t){var e,n="",r=encodeURIComponent,i=function(t,e){n+=r(t)+"="+r(e)+"&"};if(isArray(t))for(e=0;t&&e<t.length;e++)i(t[e].name,t[e].value);else for(var o in t)if(Object.hasOwnProperty.call(t,o)){var a=t[o];if(isArray(a))for(e=0;e<a.length;e++)i(o,a[e]);else i(o,t[o])}return n.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(t,e){return t&&(t.type&&(t.method=t.type)&&delete t.type,t.dataType&&(t.type=t.dataType),t.jsonpCallback&&(t.jsonpCallbackName=t.jsonpCallback)&&delete t.jsonpCallback,t.jsonp&&(t.jsonpCallback=t.jsonp)),new Reqwest(t,e)},reqwest}),function(){var t,e;Batman.extend(Batman.DOM,{querySelectorAll:null!=("undefined"!=typeof window&&null!==window?null!=(t=window.document)?t.querySelectorAll:void 0:void 0)?function(t,e){return t.querySelectorAll(e)}:function(){return Batman.developer.error("Please include either jQuery or a querySelectorAll polyfill, or set Batman.DOM.querySelectorAll to return an empty array.")},querySelector:null!=("undefined"!=typeof window&&null!==window?null!=(e=window.document)?e.querySelector:void 0:void 0)?function(t,e){return t.querySelector(e)}:function(){return Batman.developer.error("Please include either jQuery or a querySelector polyfill, or set Batman.DOM.querySelector to an empty function.")},setInnerHTML:function(t,e){var n,r,i,o,a,s,u;for(r=function(){var e,r,i,o;for(i=t.childNodes,o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(n);return o}(),o=0,s=r.length;s>o;o++)n=r[o],Batman.DOM.willRemoveNode(n);for(i=t.innerHTML=e,a=0,u=r.length;u>a;a++)n=r[a],Batman.DOM.didRemoveNode(n);return i},removeNode:function(t){var e;return Batman.DOM.willRemoveNode(t),null!=(e=t.parentNode)&&e.removeChild(t),Batman.DOM.didRemoveNode(t)},destroyNode:function(t){return Batman.DOM.willDestroyNode(t),Batman.DOM.removeNode(t),Batman.DOM.didDestroyNode(t)},appendChild:function(t,e){return Batman.DOM.willInsertNode(e),t.appendChild(e),Batman.DOM.didInsertNode(e)}})}.call(this),function(){var t;Batman.Request.prototype._parseResponseHeaders=function(t){var e;return e=t.getAllResponseHeaders().split("\n").reduce(function(t,e){var n,r,i;return(r=e.match(/([^:]*):\s*(.*)/))&&(n=r[1],i=r[2],t[n]=i),t},{})},Batman.Request.prototype.send=function(t){var e,n,r,i=this;return null==t&&(t=this.get("data")),this.fire("loading"),e={url:this.get("url"),method:this.get("method"),type:this.get("type"),headers:this.get("headers"),success:function(t){return i.mixin({xhr:n,response:t,status:"undefined"!=typeof n&&null!==n?n.status:void 0,responseHeaders:i._parseResponseHeaders(n)}),i.fire("success",t)},error:function(t){return i.mixin({xhr:t,response:t.responseText||t.content,status:t.status,responseHeaders:i._parseResponseHeaders(t)}),t.request=i,i.fire("error",t)},complete:function(){return i.fire("loaded")}},"PUT"===(r=e.method)||"POST"===r?this.hasFileUploads()?e.data=this.constructor.objectToFormData(t):(e.contentType=this.get("contentType"),e.data=Batman.URI.queryFromParams(t)):e.data=t,n=reqwest(e).request},t=["Webkit","Moz","O","ms",""],Batman.mixins.animation={initialize:function(){var e,n,r;for(n=0,r=t.length;r>n;n++)e=t[n],this.style[""+e+"Transform"]="scale(1, 1)",this.style.opacity=1,this.style[""+e+"TransitionProperty"]=""+(e?"-"+e.toLowerCase()+"-":"")+"transform, opacity",this.style[""+e+"TransitionDuration"]="0.8s, 0.55s",this.style[""+e+"TransformOrigin"]="left top";return this},show:function(e){var n,r,i,o=this;return n=function(){var e,n,r;for(o.style.opacity=1,n=0,r=t.length;r>n;n++)e=t[n],o.style[""+e+"Transform"]="scale(1, 1)";return o},e?(null!=(r=e.append)&&r.appendChild(this),null!=(i=e.before)&&i.parentNode.insertBefore(this,e.before),setTimeout(n,0)):n(),this},hide:function(e){var n,r,i,o=this;for(this.style.opacity=0,r=0,i=t.length;i>r;r++)n=t[r],this.style[""+n+"Transform"]="scale(0, 0)";return e&&setTimeout(function(){var t;return null!=(t=o.parentNode)?t.removeChild(o):void 0},600),this}}}.call(this),function(){}.call(this),function(){var t,e,n,r,i,o={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=function(t){function n(){return e=n.__super__.constructor.apply(this,arguments)}return a(n,t),n.root("todos#index",{as:"all"}),n.route("/completed","todos#completed"),n.route("/active","todos#active"),n}(Batman.App),t.TodosController=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.set("newTodo",new t.Todo({completed:!1}))}return a(n,e),n.prototype.routingKey="todos",n.prototype.index=function(){return this.set("currentTodoSet","all")},n.prototype.completed=function(){return this.set("currentTodoSet","completed"),this.render({source:"todos/index"})},n.prototype.active=function(){return this.set("currentTodoSet","active"),this.render({source:"todos/index"})},n}(Batman.Controller),t.TodosIndexView=function(e){function r(){return n=r.__super__.constructor.apply(this,arguments)}return a(r,e),r.prototype.createTodo=function(e,n){var r,i;return n.preventDefault(),i=e[0].value,i?(r=new t.Todo({title:i,completed:!1}),r.save(function(t){return t?void 0:e[0].value=null})):void 0},r.prototype.destroyTodo=function(t,e,n){var r;return r=n.get("todo"),r.destroy(function(t){if(t)throw t})},r.prototype.toggleAll=function(e){return t.Todo.get("all").forEach(function(t){return t.set("completed",!!e.checked)})},r.prototype.clearCompleted=function(){return t.Todo.get("completed").forEach(function(t){return t.destroy(function(t){if(t)throw t})})},r.prototype.toggleEditing=function(t,e,n){var r,i,o;return o=n.get("todo"),r=o.set("editing",!o.get("editing")),r?(i=document.getElementById("todo-input-"+o.get("id")),i.focus()):void 0},r.prototype.disableEditingOnEnter=function(t,e){return Batman.DOM.events.isEnter(e)?t.blur():void 0},r}(Batman.View),t.TodosActiveView=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return a(e,t),e}(t.TodosIndexView),t.TodosCompletedView=function(t){function e(){return i=e.__super__.constructor.apply(this,arguments)}return a(e,t),e}(t.TodosIndexView),t.Todo=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.observe("completed",function(){return this.save()}),this.observe("editing",function(t){return t===!1?this.get("title").length>0?(this.set("title",this.get("title").trim()),this.save()):this.destroy():void 0})}return a(e,t),e.persist(Batman.LocalStorage),e.storageKey="todos-batman",e.encode("title","completed"),e.validate("title",{presence:!0}),e.classAccessor("active",function(){return this.get("all").filter(function(t){return!t.get("completed")})}),e.classAccessor("completed",function(){return this.get("all").filter(function(t){return t.get("completed")})}),e}(Batman.Model),this.Alfred=t}.call(this),Alfred.run();