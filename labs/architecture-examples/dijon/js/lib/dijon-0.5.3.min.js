/*! dijon - v0.5.3 - 2012-04-23
* /
* Copyright (c) 2012 Camille Reynders (http://www.creynders.be/); Licensed MIT */
(function(a){"use strict";var b={VERSION:"0.5.3"};b.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},b.System.prototype={_createAndSetupInstance:function(a,b){var c=new b;return this.injectInto(c,a),c},_retrieveFromCacheOrCreate:function(a,b){typeof b=="undefined"&&(b=!1);var c;if(!this._mappings.hasOwnProperty(a))throw new Error(1e3);var d=this._mappings[a];return!b&&d.isSingleton?(d.object==null&&(d.object=this._createAndSetupInstance(a,d.clazz)),c=d.object):d.clazz?c=this._createAndSetupInstance(a,d.clazz):c=d.object,c},mapOutlet:function(a,b,c){if(typeof a=="undefined")throw new Error(1010);return b=b||"global",c=c||a,this._outlets.hasOwnProperty(b)||(this._outlets[b]={}),this._outlets[b][c]=a,this},getObject:function(a){if(typeof a=="undefined")throw new Error(1020);return this._retrieveFromCacheOrCreate(a)},mapValue:function(a,b){if(typeof a=="undefined")throw new Error(1030);return this._mappings[a]={clazz:null,object:b,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this.hasMapping(a)&&this.injectInto(b,a),this},hasMapping:function(a){if(typeof a=="undefined")throw new Error(1040);return this._mappings.hasOwnProperty(a)},mapClass:function(a,b){if(typeof a=="undefined")throw new Error(1050);if(typeof b=="undefined")throw new Error(1051);return this._mappings[a]={clazz:b,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(a),this},mapSingleton:function(a,b){if(typeof a=="undefined")throw new Error(1060);if(typeof b=="undefined")throw new Error(1061);return this._mappings[a]={clazz:b,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this},instantiate:function(a){if(typeof a=="undefined")throw new Error(1070);return this._retrieveFromCacheOrCreate(a,!0)},injectInto:function(a,b){if(typeof a=="undefined")throw new Error(1080);if(typeof a=="object"){var c=[];this._outlets.hasOwnProperty("global")&&c.push(this._outlets.global),typeof b!="undefined"&&this._outlets.hasOwnProperty(b)&&c.push(this._outlets[b]);for(var d in c){var e=c[d];for(var f in e){var g=e[f];if(!this.strictInjections||f in a)a[f]=this.getObject(g)}}"setup"in a&&a.setup.call(a)}return this},unmap:function(a){if(typeof a=="undefined")throw new Error(1090);return delete this._mappings[a],this},unmapOutlet:function(a,b){if(typeof a=="undefined")throw new Error(1100);if(typeof b=="undefined")throw new Error(1101);return delete this._outlets[a][b],this},mapHandler:function(a,b,c,d,e){if(typeof a=="undefined")throw new Error(1110);return b=b||"global",c=c||a,typeof d=="undefined"&&(d=!1),typeof e=="undefined"&&(e=!1),this._handlers.hasOwnProperty(a)||(this._handlers[a]={}),this._handlers[a].hasOwnProperty(b)||(this._handlers[a][b]=[]),this._handlers[a][b].push({handler:c,oneShot:d,passEvent:e}),this},unmapHandler:function(a,b,c){if(typeof a=="undefined")throw new Error(1120);b=b||"global",c=c||a;if(this._handlers.hasOwnProperty(a)&&this._handlers[a].hasOwnProperty(b)){var d=this._handlers[a][b];for(var e in d){var f=d[e];if(f.handler===c){d.splice(e,1);break}}}return this},notify:function(a){if(typeof a=="undefined")throw new Error(1130);var b=Array.prototype.slice.call(arguments),c=b.slice(1);if(this._handlers.hasOwnProperty(a)){var d=this._handlers[a];for(var e in d){var f=d[e],g;e!=="global"&&(g=this.getObject(e));var h=[],i,j;for(i=0,j=f.length;i<j;i++){var k,l=f[i];g&&typeof l.handler=="string"?k=g[l.handler]:k=l.handler,l.oneShot&&h.unshift(i),l.passEvent?k.apply(g,b):k.apply(g,c)}for(i=0,j=h.length;i<j;i++)f.splice(h[i],1)}}return this}},a.dijon=b})(this)
